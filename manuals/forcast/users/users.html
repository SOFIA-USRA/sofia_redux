<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>FORCAST Redux User’s Manual &#8212; sofia_redux v1.3.4.dev38+g92ea2f4</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    
    <script src="../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../../_static/documentation_options.js?v=6aa39468"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <link rel="icon" href="../../../_static/redux.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="HAWC+ DRP User’s Manual" href="../../hawc/users/users.html" />
    <link rel="prev" title="FLITECAM Redux User’s Manual" href="../../flitecam/users/users.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://irsa.ipac.caltech.edu/Missions/sofia.html"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="../../hawc/users/users.html" title="HAWC+ DRP User’s Manual">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="../../flitecam/users/users.html" title="FLITECAM Redux User’s Manual">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../../../index.html">sofia_redux v1.3.4.dev38+g92ea2f4</a>
	 &#187;
      </li>
      <li><a href="../../../sofia_redux/index.html" accesskey="U">SOFIA Redux</a> &#187;</li>
      
      <li>FORCAST Redux User’s Manual</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="forcast-redux-user-s-manual">
<h1>FORCAST Redux User’s Manual<a class="headerlink" href="#forcast-redux-user-s-manual" title="Link to this heading">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>The SI Pipeline Users Manual (OP10) is intended for use by both SOFIA
Science Center staff during routine data processing and analysis, and
also as a reference for General Investigators (GIs) and archive users to
understand how the data in which they are interested was processed. This
manual is intended to provide all the needed information to execute the
SI Level 2 Pipeline, flux calibrate the results, and assess the data
quality of the resulting products. It will also provide a description of
the algorithms used by the pipeline and both the final and intermediate
data products.</p>
<p>A description of the current pipeline capabilities, testing results,
known issues, and installation procedures are documented in the SI
Pipeline Software Version Description Document (SVDD, SW06, DOCREF). The
overall Verification and Validation (V&amp;V) approach can be found in the
Data Processing System V&amp;V Plan (SV01-2232). Both documents can be
obtained from the SOFIA document library in Windchill.</p>
<p>This manual applies to FORCAST Redux version 2.7.0.</p>
</section>
<section id="si-observing-modes-supported">
<h2>SI Observing Modes Supported<a class="headerlink" href="#si-observing-modes-supported" title="Link to this heading">¶</a></h2>
<section id="forcast-observing-techniques">
<h3>FORCAST observing techniques<a class="headerlink" href="#forcast-observing-techniques" title="Link to this heading">¶</a></h3>
<p>Because the sky is so bright in the mid-infrared (MIR) relative to
astronomical sources, the way in which observations are made in the MIR
is considerably different from the more familiar way they are made in
the optical. Any raw image of a region in the MIR is overwhelmed by the
background sky emission. The situation is similar to trying to observe
in the optical during the day: the bright daylight sky swamps the
detector and makes it impossible to see astronomical sources in the raw
images.</p>
<p>In order to remove the background from the MIR image and detect the
faint astronomical sources, observations of another region (free of
sources) are made and the two images are subtracted. However, the MIR is
highly variable, both spatially and temporally. It
would take far too long (on the order of seconds) to reposition a large
telescope to observe this sky background region: by the time the
telescope had moved and settled at the new location, the sky background
level would have changed so much that the subtraction of the two images
would be useless. In order to avoid this problem, the secondary mirror
of the telescope (which is considerably smaller than the primary mirror)
is tilted, rather than moving the entire telescope. This allows
observers to look at two different sky positions very quickly (on the
order of a few to ten times per second), because tilting the secondary
by an angle <span class="math notranslate nohighlight">\(\theta\)</span> moves the center of the field imaged
by the detector by <span class="math notranslate nohighlight">\(\theta\)</span>
on the sky. Tilting the secondary between two positions is known as
“chopping”. FORCAST observations are typically made with a chopping
frequency of 4 Hz. That is, every 0.25 sec, the secondary is moved
between the two observing positions.</p>
<p>Chopping can be done either symmetrically or asymmetrically. Symmetric
chopping means that the secondary mirror is tilted symmetrically about
the telescope optical axis (also known as the boresight) in the two chop
positions. The distance between the two chop positions is known as the
chop throw. The distance between the boresight and either chop position
is known as the chop amplitude and is equal to half the chop throw
(see <a class="reference internal" href="#symmetric-chop"><span class="std std-numref">Fig. 67</span></a>).</p>
<figure class="align-default" id="symmetric-chop">
<img alt="Sky position for symmetric chop. Telescope position in the middle, chop 1 to the left, chop 2 to the right." src="../../../_images/sym_chop.png" />
<figcaption>
<p><span class="caption-number">Fig. 67 </span><span class="caption-text">Symmetric Chop</span><a class="headerlink" href="#symmetric-chop" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Asymmetric chopping means that the secondary is aligned with the
telescope boresight in one position, but is tilted away from the
boresight in the chop position. The chop amplitude is equal to the chop
throw in this case (see <a class="reference internal" href="#asymmetric-chop"><span class="std std-numref">Fig. 68</span></a>).</p>
<figure class="align-default" id="asymmetric-chop">
<img alt="Sky positions for asymmetric chop. Boresight co-located with chop 1 on the left, chop 2 to the right." src="../../../_images/asym_chop.png" />
<figcaption>
<p><span class="caption-number">Fig. 68 </span><span class="caption-text">Asymmetric Chop</span><a class="headerlink" href="#asymmetric-chop" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Unfortunately, moving the secondary mirror causes the telescope to be
slightly misaligned, which introduces optical distortions (notably the
optical aberration known as coma) and additional background emission
from the telescope (considerably smaller than the sky emission but
present nonetheless) in the images. The optical distortions can be
minimized by tilting the secondary only tiny fractions of a degree. The
additional telescopic background can be removed by moving the entire
telescope to a new position and then chopping the secondary again
between two positions. Subtracting the two chop images at this new
telescope position will remove the sky emission but leave the additional
telescopic background due to the misalignment; subtracting the result
from the chop-subtracted image at the first telescope position will then
remove the background. Since the process of moving to a new position is
needed to remove the additional background from the telescope, not the
sky, it can be done on a much longer timescale. The variation in the
telescopic backgrounds occurs on timescales on the order of tens of
seconds to minutes, much slower than the variation in the sky emission.</p>
<p>This movement of the entire telescope, on a much longer timescale than
chopping, is known as nodding. The two nod positions are usually
referred to as nod A and nod B. The distance between the two nod
positions is known as the nod throw or the nod amplitude. For FORCAST
observations, nods are done every 5 to 30 seconds. The chop-subtracted
images at nod position B are then subtracted from the chop-subtracted
images at nod position A. The result will be an image of the region,
without the sky background emission or the additional emission resulting
from tilting the secondary during the chopping process. The sequence of
chopping in one telescope position, nodding, and chopping again in a
second position is known as a chop/nod cycle.</p>
<p>Again, because the MIR sky is so bright, deep images of a region cannot
be obtained (as they are in the optical) by simply observing the region
for a long time with the detector collecting photons continuously. As
stated above, the observations require chopping and nodding at fairly
frequent intervals. Hence, deep observations are made by “stacking” a
series of chop/nod images. Furthermore, MIR detectors are not perfect,
and often have bad pixels or flaws. In order to avoid these defects on
the arrays, and prevent them from marring the final images, observers
employ a technique known as “dithering.” Dithering entails moving the
position of the telescope slightly with respect to the center of the
region observed each time a new chop/nod cycle is begun, or after
several chop/nod cycles. When the images are processed, the observed
region will appear in a slightly different place on the detector. This
means that the bad pixels do not appear in the same place relative to
the observed region. The individual images can then be registered and
averaged or median-combined, a process that will eliminate (in theory)
the bad pixels from the final image.</p>
</section>
<section id="available-chopping-modes">
<h3>Available chopping modes<a class="headerlink" href="#available-chopping-modes" title="Link to this heading">¶</a></h3>
<section id="symmetric-chopping-modes-c2n-and-c2nd">
<h4>Symmetric chopping modes: C2N and C2ND<a class="headerlink" href="#symmetric-chopping-modes-c2n-and-c2nd" title="Link to this heading">¶</a></h4>
<p>FORCAST acquires astronomical observations in two symmetric chopping
modes: two-position chopping with no nodding (C2) and two-position
chopping with nodding (C2N). Dithering can be implemented for either
mode; two-position chopping with nodding and dithering is referred to as
C2ND. The most common observing methods used are C2N and C2ND. C2ND is
conceptually very similar to the C2N mode: the only difference is a slight
movement of the telescope position after each chop/nod cycle.</p>
<p>FORCAST can make two types of C2N observations: Nod Match Chop (NMC) and
Nod Perpendicular to Chop (NPC). The positions of the telescope
boresight, the two chop positions, and the two nod positions for these
observing types are shown below (<a class="reference internal" href="#nmc"><span class="std std-numref">Fig. 69</span></a> through <a class="reference internal" href="#npc-nas"><span class="std std-numref">Fig. 74</span></a>).</p>
<section id="c2n-nod-match-chop-nmc">
<h5>C2N: Nod Match Chop (NMC)<a class="headerlink" href="#c2n-nod-match-chop-nmc" title="Link to this heading">¶</a></h5>
<p>In the NMC mode, the telescope is pointed at a position half of the chop
throw distance away from the object to be observed, and the secondary
chops between two positions, one of which is centered on the object. The
nod throw has the same magnitude as the chop throw, and is in a
direction exactly 180 degrees from that of the chop direction. The final
image is generated by subtracting the images obtained for the two chop
positions at nod A and those at nod B, and then subtracting the results.
This will produce three images of the star, one positive and two
negative, with the positive being twice as bright as the negatives.</p>
<figure class="align-default" id="nmc">
<img alt="Sky positions for NMC.  Nod throw is centered on the source; chop throw is centered on the boresight." src="../../../_images/nmc.png" />
<figcaption>
<p><span class="caption-number">Fig. 69 </span><span class="caption-text">Nod Match Chop mode</span><a class="headerlink" href="#nmc" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>For grism observations, the chop and nod angles can be set relative to
the sky or the array (slit). There are two special angles
when using the array coordinate system: parallel to (along; <a class="reference internal" href="#nmc-para"><span class="std std-numref">Fig. 70</span></a>), and
orthogonal (perpendicular; <a class="reference internal" href="#nmc-perp"><span class="std std-numref">Fig. 71</span></a>) to the slit. Dithers should be done along the slit.</p>
<figure class="align-default" id="nmc-para">
<img alt="Sky positions for NMC parallel mode. Chop and nod throw fall along a single line, aligned with the slit." src="../../../_images/nmc_spec_parallel.png" />
<figcaption>
<p><span class="caption-number">Fig. 70 </span><span class="caption-text">Nod Match Chop Parallel to Slit</span><a class="headerlink" href="#nmc-para" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="nmc-perp">
<a class="reference internal image-reference" href="../../../_images/nmc_spec_perp.png"><img alt="Sky positions for NMC perpendicular. Chop/nod throw are parallel to each other, perpendicular to the slit." src="../../../_images/nmc_spec_perp.png" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 71 </span><span class="caption-text">Nod Match Chop Perpendicular to Slit</span><a class="headerlink" href="#nmc-perp" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="c2n-nod-perpendicular-to-chop-npc">
<h5>C2N: Nod Perpendicular to Chop (NPC)<a class="headerlink" href="#c2n-nod-perpendicular-to-chop-npc" title="Link to this heading">¶</a></h5>
<p>In the NPC mode, the telescope is offset by half the nod throw from the
target in a direction perpendicular to the chop direction, and the
secondary chops between two positions. The nod throw usually (but not
necessarily) has the same magnitude as the chop, but it is in a
direction perpendicular to the chop direction. The final image is
generated by subtracting the images obtained for the two chop positions
at nod A and those at nod B, and then subtracting the results. This will
produce four images of the star in a rectangular pattern, with the image
values alternating positive and negative.</p>
<figure class="align-default" id="npc">
<img alt="Sky positions for NPC mode.  Nod throw and chop throw centered on the source, perpendicular to each other." src="../../../_images/npc.png" />
<figcaption>
<p><span class="caption-number">Fig. 72 </span><span class="caption-text">Nod Perpendicular to Chop mode</span><a class="headerlink" href="#npc" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>For grism observations, there are two types of NPC observations: Chop
Along Slit and Nod Along Slit.  For Chop Along Slit
(<a class="reference internal" href="#npc-cas"><span class="std std-numref">Fig. 73</span></a>), the telescope is pointed at the object and the
secondary chops between two positions on either side of the
object. The chop throw is oriented such that both positions are
aligned with the angle of the slit on the sky.  For Nod Along Slit,
(<a class="reference internal" href="#npc-nas"><span class="std std-numref">Fig. 74</span></a>) the telescope is pointed at a position half of the
chop throw distance away from the object to be observed, and the
secondary chops between two positions, one of which is centered on the
object. The nod throw is oriented such that both nod positions are
aligned with the angle of the slit on the sky.</p>
<figure class="align-default" id="npc-cas">
<a class="reference internal image-reference" href="../../../_images/c2n_chop_along_slit.png"><img alt="Sky positions for NPC-CAS mode. Chop throw is along the slit; nod throw is perpendicular to it." src="../../../_images/c2n_chop_along_slit.png" style="width: 500px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 73 </span><span class="caption-text">Nod Perpendicular to Chop, Chop Along Slit</span><a class="headerlink" href="#npc-cas" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="npc-nas">
<a class="reference internal image-reference" href="../../../_images/c2n_nod_along_slit.png"><img alt="Sky positions for NPC-NAS mode. Nod throw is along the slit; chop throw is perpendicular to it." src="../../../_images/c2n_nod_along_slit.png" style="width: 500px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 74 </span><span class="caption-text">Nod Perpendicular to Chop, Nod Along Slit</span><a class="headerlink" href="#npc-nas" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="asymmetrical-chopping-modes-c2nc2-and-nxcac">
<h4>Asymmetrical chopping modes: C2NC2 and NXCAC<a class="headerlink" href="#asymmetrical-chopping-modes-c2nc2-and-nxcac" title="Link to this heading">¶</a></h4>
<p>FORCAST also has an asymmetrical chop mode, known as C2NC2. In this
mode, the telescope is first pointed at the target (position A). In this
first position, the secondary is aligned with the boresight for one
observation and then is tilted some amount (often 180-480 arcseconds)
for the second (asymmetrically chopped) observation. This is an
asymmetric C2 mode observation. The telescope is then slewed some
distance from the target, to a sky region without sources (position
B), and the asymmetric chop pattern is repeated. The time between slews
is typically 30 seconds.</p>
<figure class="align-default" id="c2nc2">
<img alt="Sky positions for C2NC2 mode.  Chop throws at source and sky positions, connected by a telescope slew." src="../../../_images/c2nc2.png" />
<figcaption>
<p><span class="caption-number">Fig. 75 </span><span class="caption-text">C2NC2 mode</span><a class="headerlink" href="#c2nc2" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>There is an additional asymmetric mode chopping mode, called NXCAC
(nod not related to chop/asymmetrical chop; <a class="reference internal" href="#nxcac"><span class="std std-numref">Fig. 76</span></a>).
This mode replaces the C2NC2 mode when the GI wants to use an asymmetrical
chop for a grism observation.
This mode is taken with an ABBA nod pattern, like the C2N mode
(not ABA, like C2NC2). The nods
are packaged together, so data from this mode will reduce just like the
C2N mode. The reason for adding this mode stems from the need to define
our large chops and nods in ERF (equatorial reference frame), and dither
in SIRF (science instrument reference frame) along the slit.</p>
<figure class="align-default" id="nxcac">
<a class="reference internal image-reference" href="../../../_images/nxcac_spec.png"><img alt="Sky positions for NXCAC mode. Chop throws at source and sky positions, perpendicular to the slit." src="../../../_images/nxcac_spec.png" style="width: 500px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 76 </span><span class="caption-text">NXCAC mode</span><a class="headerlink" href="#nxcac" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="spectral-imaging-mode-slitscan">
<h4>Spectral imaging mode: SLITSCAN<a class="headerlink" href="#spectral-imaging-mode-slitscan" title="Link to this heading">¶</a></h4>
<p>Similar to the C2ND mode for imaging, the SLITSCAN mode for grism
observations allows a combination of chopping and nodding with
telescope moves to place the spectral extraction slit at different
locations in the sky.</p>
<p>In slit-scan observations, a chop/nod cycle is taken at a series of
positions, moving the slit slowly across an extended target after
each cycle.  In this mode, the different telescope positions may be used to
generate both extracted spectra at each position and a spatial/spectral
cube that combines all the observations together into a spectral map
of the source.</p>
</section>
</section>
</section>
<section id="algorithm-description">
<h2>Algorithm Description<a class="headerlink" href="#algorithm-description" title="Link to this heading">¶</a></h2>
<section id="overview-of-data-reduction-steps">
<h3>Overview of data reduction steps<a class="headerlink" href="#overview-of-data-reduction-steps" title="Link to this heading">¶</a></h3>
<p>This section will describe, in general terms, the major algorithms that
the FORCAST Redux pipeline uses to reduce a FORCAST observation.</p>
<p>The pipeline applies a number of corrections to each input file, regardless of
the chop/nod mode used to take the data. The initial steps used for
imaging and grism modes are nearly identical; points where the results
or the procedure differ for either mode are noted in the descriptions
below. After preprocessing, individual images or spectra of a source
must be combined to produce the final data product. This procedure depends
strongly on the instrument configuration and chop/nod mode.</p>
<p>See <a class="reference internal" href="#flowchart-img"><span class="std std-numref">Fig. 77</span></a> and <a class="reference internal" href="#flowchart-grism"><span class="std std-numref">Fig. 78</span></a> for
flowcharts of the processing steps used by the imaging and grism pipelines.</p>
<figure class="align-default" id="flowchart-img">
<a class="reference internal image-reference" href="../../../_images/flowchart_img.png"><img alt="Flowchart of processing steps for imaging data with cartoon versions of each step." src="../../../_images/flowchart_img.png" style="height: 800px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 77 </span><span class="caption-text">Processing steps for imaging data.</span><a class="headerlink" href="#flowchart-img" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="flowchart-grism">
<a class="reference internal image-reference" href="../../../_images/flowchart_grism.png"><img alt="Flowchart of processing steps for grism data with cartoon versions of each step." src="../../../_images/flowchart_grism.png" style="height: 800px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 78 </span><span class="caption-text">Processing steps for grism data.</span><a class="headerlink" href="#flowchart-grism" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="reduction-algorithms">
<h3>Reduction algorithms<a class="headerlink" href="#reduction-algorithms" title="Link to this heading">¶</a></h3>
<p>The following subsections detail each of the data reduction pipeline
steps:</p>
<ul class="simple">
<li><p>Steps common to imaging and spectroscopy modes</p>
<ul>
<li><p>Identify/clean bad pixels</p></li>
<li><p>Correct droop effect</p></li>
<li><p>Correct for detector nonlinearity</p></li>
<li><p>Subtract background (stack chops/nods)</p></li>
<li><p>Remove jailbars (correct for crosstalk)</p></li>
</ul>
</li>
<li><p>Imaging-specific steps</p>
<ul>
<li><p>Correct for optical distortion</p></li>
<li><p>Merge chopped/nodded images</p></li>
<li><p>Register images</p></li>
<li><p>Correct for atmospheric transmission (telluric correct)</p></li>
<li><p>Coadd multiple observations</p></li>
<li><p>Calibrate flux</p></li>
</ul>
</li>
<li><p>Spectroscopy-specific steps</p>
<ul>
<li><p>Stack common dithers</p></li>
<li><p>Rectify spectral image</p></li>
<li><p>Identify apertures</p></li>
<li><p>Extract spectra</p></li>
<li><p>Merge apertures</p></li>
<li><p>Calibrate flux and correct for atmospheric transmission</p></li>
<li><p>Combine multiple observations, or generate response spectra</p></li>
</ul>
</li>
</ul>
<section id="steps-common-to-imaging-and-spectroscopy-modes">
<h4>Steps common to imaging and spectroscopy modes<a class="headerlink" href="#steps-common-to-imaging-and-spectroscopy-modes" title="Link to this heading">¶</a></h4>
<section id="identify-bad-pixels">
<h5>Identify bad pixels<a class="headerlink" href="#identify-bad-pixels" title="Link to this heading">¶</a></h5>
<p>Bad pixels in the FORCAST arrays take the form of hot pixels (with
extreme dark current) or pixels with very different response (usually
much lower) than the surrounding pixels. The pipeline minimizes the
effects of bad pixels by using a bad pixel mask to identify their
locations and then replacing the bad pixels with NaN values.  Optionally,
the bad pixels may instead be interpolated over, using nearby good values
as input.</p>
<p>The bad pixel map for both FORCAST channels is currently produced
manually, independent of the pipeline. The mask is a 256x256 image with
pixel value = 0 for bad pixels and pixel value = 1 otherwise.</p>
</section>
<section id="correct-droop-effect">
<h5>Correct droop effect<a class="headerlink" href="#correct-droop-effect" title="Link to this heading">¶</a></h5>
<p>The FORCAST arrays and readout electronics exhibit a linear response
offset caused by the presence of a signal on the array. This effect is
called ‘droop’ since the result is a reduced signal. Droop results in
each pixel having a reduced signal that is proportional to the total
signal in the 15 other pixels in the row read from the multiplexer
simultaneously with that pixel. The effect, illustrated in <a class="reference internal" href="#droop"><span class="std std-numref">Fig. 79</span></a>, is
an image with periodic spurious sources spread across the array rows. The
droop correction removes the droop offset by multiplying each pixel by a
value derived from the sum of every 16th pixel in the same row all
multiplied by an empirically determined offset fraction: droopfrac =
0.0035. This value is a configurable parameter, as some data may require
a smaller droop fraction to avoid over-correction of the effect.
Over-correction may look like an elongated smear along the horizontal
axis, near a bright source (see <a class="reference internal" href="#droop-overcor"><span class="std std-numref">Fig. 80</span></a>). Note that while droop
correction typically removes the effect near the source, there may be
lingering artifacts in other areas of the image if the source was very
bright, as in <a class="reference internal" href="#droop"><span class="std std-numref">Fig. 79</span></a>.</p>
<figure class="align-default" id="droop">
<img alt="Left: bright source with irregular negative blob and ringing artifacts. Right: corrected image with no blob." src="../../../_images/droop.png" />
<figcaption>
<p><span class="caption-number">Fig. 79 </span><span class="caption-text">Background-subtracted FORCAST images of a bright star with droop
effect (left) and with the droop correction applied (right).</span><a class="headerlink" href="#droop" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="droop-overcor">
<img alt="Droop effect after over-correction. Contours show an elongated PSF on the left side of the source." src="../../../_images/droop_overcor.png" />
<figcaption>
<p><span class="caption-number">Fig. 80 </span><span class="caption-text">Overcorrected droop effect, appearing as an elongated smear on
the bright central source.</span><a class="headerlink" href="#droop-overcor" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="correct-for-detector-nonlinearity">
<h5>Correct for detector nonlinearity<a class="headerlink" href="#correct-for-detector-nonlinearity" title="Link to this heading">¶</a></h5>
<p>In principle, the response of each of the pixels in the FORCAST detector
arrays should be linear with incident flux. In practice, the degree to
which the detector is linear depends on the level of charge in the wells
relative to the saturation level. Empirical tests optimizing
signal-to-noise indicate that signal levels in the neighborhood of 60%
of full well for a given detector capacitance in the FORCAST arrays have
minimal departures from linear response and optimal signal-to-noise. For
a given background level we can keep signal levels near optimal by
adjusting the detector readout frame rate and detector capacitance.
Since keeping signals near 60% of saturation level is not always
possible or practical, we have measured response curves (response in
analog-to-digital units (ADU) as a function of well depth for varying
background levels) that yield linearity correction factors. These
multiplicative correction factors linearize the response for a much
larger range of well depths (about 15% - 90% of saturation). The linearity
correction is applied globally to FORCAST images prior to background
subtraction. The pipeline first calculates the background level for a
sub-image, and then uses this level to calculate the linearity
correction factor. The pipeline then applies the correction factor to
the entire image.</p>
</section>
<section id="subtract-background-stack-chops-nods">
<h5>Subtract background (stack chops/nods)<a class="headerlink" href="#subtract-background-stack-chops-nods" title="Link to this heading">¶</a></h5>
<p>Background subtraction is accomplished by subtracting chopped image
pairs and then subtracting nodded image pairs.</p>
<p>For C2N/NPC imaging mode
with chop/nod on-chip (i.e. chop throws smaller than the FORCAST field
of view), the four chop/nod images in the raw data file are reduced to a
single stacked image frame with a pattern of four background-subtracted
images of the source, two positive and two negative. For chop/nod larger than the
FORCAST field of view the raw files are reduced to a single frame with
one background-subtracted image of the source.</p>
<p>For the C2N/NPC
spectroscopic mode, either the chop or the nod is always off the slit,
so there will be two traces in the subtracted image: one positive and
one negative. If the chop or nod throw is larger than the field of view,
there will be a single trace in the image.</p>
<p>In the case of the C2N/NMC mode for either imaging or spectroscopy, the
nod direction is the same as the chop direction with the same throw so
that the subtracted image frame contains three background-subtracted
images of the source. The central image or trace is positive and the two
outlying images are negative. If the chop/nod throw is larger than the
FORCAST field of view, there will be a single image or trace in the
image.</p>
<figure class="align-default" id="stack">
<img alt="Background subtraction stages: raw frames, chop corrected images, and chop-nod corrected image." src="../../../_images/stack.png" />
<figcaption>
<p><span class="caption-number">Fig. 81 </span><span class="caption-text">Images at two stages of background subtraction in imaging NMC mode:
raw frames (upper row), chop-subtracted (middle row),
chop/nod-subtracted (lower row). Four raw frames produce a single
stacked image.</span><a class="headerlink" href="#stack" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>C2NC2 raw data sets for imaging or spectroscopy consist of a set of 5
FITS files, each with 4 image planes containing the chop pairs for both
the on-source position (position A) and the blank sky position (position
B). The four planes can be reduced in the same manner as any C2N image
by first subtracting chopped image pairs for both and then subtracting
nodded image pairs. The nod sequence for C2NC2 is
<span class="math notranslate nohighlight">\(A_1 B_1 A_2 A_3 B_2 A_4 A_5 B_3\)</span>, where the
off-source B nods are shared between some of the files
(shared B beams shown in bold):</p>
<blockquote>
<div><p>File 1 = <span class="math notranslate nohighlight">\(A_1 \boldsymbol{B_1}\)</span></p>
<p>File 2 = <span class="math notranslate nohighlight">\(\boldsymbol{B_1} A_2\)</span></p>
<p>File 3 = <span class="math notranslate nohighlight">\(A_3 \boldsymbol{B_2}\)</span></p>
<p>File 4 = <span class="math notranslate nohighlight">\(\boldsymbol{B_2} A_4\)</span></p>
<p>File 5 = <span class="math notranslate nohighlight">\(A_5 \boldsymbol{B_3}\)</span></p>
</div></blockquote>
<p>The last step in the stack pipeline step is to convert pixel
data from analog-to-digital units (ADU) per frame to mega-electrons per
second (Me/s) using the gain and frame rate used for the
observation.</p>
<p>At this point, the background in the chop/nod-subtracted stack should be
zero, but if there is a slight mismatch between the background levels in
the individual frames, there may still remain some small residual
background level. After stacking, the pipeline estimates this residual
background by taking the mode or median of the image data in a central section of
the image, and then subtracts this level from the stacked image.  This
correction is typically not applied for grism data, as the spectroscopic
pipeline has other methods for removing residual background.</p>
</section>
<section id="remove-jailbars-correct-for-crosstalk">
<h5>Remove jailbars (correct for crosstalk)<a class="headerlink" href="#remove-jailbars-correct-for-crosstalk" title="Link to this heading">¶</a></h5>
<p>The FORCAST array readout circuitry has a residual, or latent, signal
that persists when pixels have high contrast relative to the surrounding
pixels. This can occur for bad pixels or for bright point sources. This
residual is present not only in the affected pixels, but is correlated
between all pixels read by the same one of sixteen multiplexer channels.
This results in a linear pattern of bars, spaced by 16 pixels, known as
“jailbars” in the background-subtracted (stacked) images
(see <a class="reference internal" href="#jailbar"><span class="std std-numref">Fig. 82</span></a>). Jailbars can interfere with subsequent efforts to
register multiple images since the pattern can dominate the cross-correlation
algorithm sometimes used in image registration. The jailbars can also
interfere with photometry in images and with spectral flux in
spectroscopy frames.</p>
<p>The pipeline attempts to remove jailbar patterns from the
background-subtracted images by replacing pixel values by the median
value of pixels in that row that are read by the same multiplexer
channel (i.e. every 16th pixel in that row starting with the pixel being
corrected). The jailbar pattern is located by subtracting a
1-dimensional (along rows) median filtered image from the raw image.</p>
<figure class="align-default" id="jailbar">
<img alt="Images with regular vertical striping due to the jailbar effect." src="../../../_images/jailbar.png" />
<figcaption>
<p><span class="caption-number">Fig. 82 </span><span class="caption-text">Crosstalk correction for a bright point source (left), and
faint source (right). Images on the top are before correction; images
on the bottom are after correction.</span><a class="headerlink" href="#jailbar" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="imaging-specific-steps">
<h4>Imaging-specific steps<a class="headerlink" href="#imaging-specific-steps" title="Link to this heading">¶</a></h4>
<section id="correct-for-optical-distortion">
<h5>Correct for optical distortion<a class="headerlink" href="#correct-for-optical-distortion" title="Link to this heading">¶</a></h5>
<p>The FORCAST optical system introduces anamorphic magnification and
barrel distortion in the images. The distortion correction uses pixel
coordinate offsets for a grid of pinholes imaged in the lab and a 2D
polynomial warping function to resample the 256x256 pixels to an
undistorted grid. The resulting image is 262x247 pixels with image scale
of 0.768”/pixel for a corrected field of view of 3.4x3.2 arcminutes.
Pixels outside of the detector area are set to NaN to distinguish them
from real data values.</p>
</section>
<section id="merge-chopped-nodded-images">
<h5>Merge chopped/nodded images<a class="headerlink" href="#merge-chopped-nodded-images" title="Link to this heading">¶</a></h5>
<p>The stack step of the pipeline in imaging mode may produce images with
multiple positive and negative source images, depending on the chop/nod
mode used for data acquisition. These positive and negative sources may
be merged by copying, shifting, and re-combining the image in order to
increase the signal-to-noise of the observation. The final image is then
rotated by the nominal sky angle, so that North is up and East
is left in the final image (see <a class="reference internal" href="#merge"><span class="std std-numref">Fig. 83</span></a>).</p>
<p>The merge pipeline step makes a number of copies of the stacked image,
shifts them by the chop and nod throws used in data acquisition, and
adds or subtracts them (depending on whether the image is a positive or
negative background-subtracted image). The pipeline can use two
different methods for registration in the merge process: chop/nod offset
data from the FITS header, or centroid of the brightest point source in
the stacked images.</p>
<p>The default for flux standards is to use centroiding, as it is usually
the most precise method. If merging is desired for science images that
do not contain a bright, compact source, the header data method is
usually the most reliable. After the shifting and adding, the final
merged image consists of a positive image of the source surrounded by a
number of positive and negative residual source images left over from
the merging process. The central image is the source to use for science.</p>
<p>For the NPC imaging mode with chop/nod amplitude smaller than the field
of view, the stack step produces a single stacked image frame with a
pattern of four background-subtracted images of the source, two of them
negative. The merge step makes four copies of the stacked frame, then
shifts each using the selected algorithm. It adds or subtracts each
copy, depending on whether the source is positive or negative.</p>
<p>For the NMC imaging mode with chop/nod amplitude smaller than the field
of view, the stacked image contains three background-subtracted sources,
two negative, and one positive (see <a class="reference internal" href="#stack"><span class="std std-numref">Fig. 81</span></a>). The positive source has
double the flux of the negative ones, since the source falls in the same
place on the detector for two of the chop/nod positions. The merge step
for this mode makes three copies of the image, shifts the two negative
sources on top of the positive one, and then subtracts them
(see <a class="reference internal" href="#merge"><span class="std std-numref">Fig. 83</span></a>). Pixels with no data are set to NaN.</p>
<figure class="align-default" id="merge">
<img alt="After merging, 1 central positive source, 2 negative sources, and 2 fainter positive sources to the sides." src="../../../_images/merge.png" />
<figcaption>
<p><span class="caption-number">Fig. 83 </span><span class="caption-text">The NMC observation of <a class="reference internal" href="#stack"><span class="std std-numref">Fig. 81</span></a>, after merging. Only the
central source should be used for science; the other images are
artifacts of the stacking and merging procedure. Note that the merged
image is rotated to place North up and East left.</span><a class="headerlink" href="#merge" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>While performing the merge, the locations of overlap for the shifted
images are recorded. For NPC mode, the final merged image is normalized
by dividing by the number of overlapping images at each pixel. For NMC
mode, because the source is doubled in the stacking step, the final
merged image is divided by the number of overlapping images, plus one.
In the nominal case, if all positive and negative sources were found and
coadded, the signal in the central source, in either mode, should now be
the average of four observations of the source. If the chop or nod was
relatively wide, however, and one or more of the extra sources were not
found on the array, then the central source may be an average of fewer
observations.</p>
<p>For either NPC or NMC imaging modes, with chop/nod amplitude greater
than half of the array, there is no merging to be done, as the extra
sources are off the detector. However, for NMC mode, the data is still
divided by 2 to account for the doubled central source. For C2NC2 mode,
the chops and telescope moves-to-sky are always larger than the FORCAST
field of view; merging is never required for this mode. It may also be
desirable to skip the merging stage for crowded fields-of-view and extended
sources, as the merge artifacts may be confused with real sources.</p>
<p>In all imaging cases, whether or not the shifting-and-adding is performed,
the merged image is rotated by the sky angle at the end of the merge step.</p>
</section>
<section id="register-images">
<h5>Register images<a class="headerlink" href="#register-images" title="Link to this heading">¶</a></h5>
<p>In order to combine multiple imaging observations of the same source,
each image must be registered to a reference image, so that the pixels
from each image correspond to the same location on the sky.</p>
<p>The registration information is typically encoded in the world coordinate
system (WCS) embedded in each FITS file header.  For most observations,
the WCS is sufficiently accurate that no change is required in the registration
step.  However, if the WCS is faulty, it may be corrected in the registration
step, using centroiding or cross-correlation between images to identify common
sources, or using header information about the dither offsets used.  In this
case,the first image is taken as the reference image, and calculated offsets
are applied to the WCS header keywords (CRPIX1 and CRPIX2) in all
subsequent images. <a class="footnote-reference brackets" href="#fn-register" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fn-register" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Earlier versions of this pipeline applied registration to the images
themselves, rather than to the WCS in the FITS header, interpolating
them into the same spatial grid.  As of v2.0.0, registration affects
only the CRPIX1 and CRPIX2 keywords in the header.</p>
</aside>
</aside>
</section>
<section id="correct-for-atmospheric-transmission">
<h5>Correct for atmospheric transmission<a class="headerlink" href="#correct-for-atmospheric-transmission" title="Link to this heading">¶</a></h5>
<p>For accurate flux calibration, the pipeline must first correct for the
atmospheric opacity at the time of the observation. In order to combine
images taken in different atmospheric conditions, or at different
altitudes or zenith angles, the pipeline corrects the flux in each
individual registered file for the estimated atmospheric transmission
during the observations, based on the altitude and zenith angle at the
time when the observations were obtained, relative to that computed for
a reference altitude (41,000 feet) and reference zenith angle (45
degrees), for which the instrumental response has been calculated. The
atmospheric transmission values are derived from the ATRAN code
provided to the SOFIA program by Steve Lord. The pipeline applies the
telluric correction factor directly to the flux in the image, and
records it in the header keyword TELCORR.</p>
<p>After telluric correction, the pipeline performs aperture photometry on
all observations that are marked as flux
standards (FITS keyword OBSTYPE = STANDARD_FLUX). The brightest source
in the field is fit with a Moffat profile to determine its centroid, and
then its flux is measured, using an aperture of 12 pixels and a
background region of 15-25 pixels. The aperture flux and error, as well
as the fit characteristics, are recorded in the FITS header, to be used
in the flux calibration process.</p>
</section>
<section id="coadd-multiple-observations">
<h5>Coadd multiple observations<a class="headerlink" href="#coadd-multiple-observations" title="Link to this heading">¶</a></h5>
<p>After registration and scaling, the pipeline coadds multiple
observations of the same source with the same instrument configuration
and observation mode. Each image is projected into the coordinate system
of the first image, using its WCS to transform input coordinates into output
coordinates.  An additional offset may be applied for non-sidereal targets
in order to correct for the motion of the target across the sky, provided
that the target position is recorded in the FITS headers (TGTRA and TGTDEC).
The projection is performed with a bilinear interpolation, then individual
images are mean- or median-combined, with optional error weighting and robust
outlier rejection.</p>
<p>For flux standards, photometry calculations are repeated on the coadded
image, in the same way they were performed on the individual images.</p>
</section>
<section id="calibrate-flux">
<h5>Calibrate flux<a class="headerlink" href="#calibrate-flux" title="Link to this heading">¶</a></h5>
<p>For the imaging mode, flux calibration factors are typically calculated from
all standards observed within a flight series. These calibration factors are
applied directly to the flux images to produce an image calibrated to
physical units. The final Level 3 product has image units of Jy per pixel.
<a class="footnote-reference brackets" href="#fn-flux" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p>
<p>See the flux calibration section, below, for more information.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fn-flux" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Earlier versions of this pipeline did not produce a final
calibrated file. Prior to v1.1.0, the final Level 3 products had image
units of Me/sec, with the flux calibration factor (Me/sec/Jy) recorded
in the FITS header keyword, CALFCTR. To convert these products to
Jy/pixel, divide the flux image by the CALFCTR value.</p>
</aside>
</aside>
</section>
<section id="mosaic">
<h5>Mosaic<a class="headerlink" href="#mosaic" title="Link to this heading">¶</a></h5>
<p>In some cases, it may be useful to stack together separate calibrated
observations of the same target. In order to create a deeper image of a
faint target, for example, observations taken across multiple flights
may be combined together. Large maps may also be generated by taking
separate observations, and stitching together the results. In these
cases, the pipeline may register these files and coadd them, using the
same methods as in the initial registration and coadd steps. The output
product is a LEVEL_4 mosaic.</p>
</section>
</section>
<section id="spectroscopy-specific-steps">
<h4>Spectroscopy-specific steps<a class="headerlink" href="#spectroscopy-specific-steps" title="Link to this heading">¶</a></h4>
<section id="stack-common-dithers">
<h5>Stack common dithers<a class="headerlink" href="#stack-common-dithers" title="Link to this heading">¶</a></h5>
<p>For very faint spectra, a second stacking step may be optionally performed.
This step identifies spectra at common dither positions and mean- or
median-combines them in order to increase signal-to-noise.  This step
may be applied if spectra are too faint to automatically identify appropriate
apertures.</p>
</section>
<section id="rectify-spectral-image">
<span id="rectify-image"></span><h5>Rectify spectral image<a class="headerlink" href="#rectify-spectral-image" title="Link to this heading">¶</a></h5>
<p>For the spectroscopic mode, spatial and spectral distortions are
corrected for by defining calibration images that assign a wavelength
coordinate (in <span class="math notranslate nohighlight">\(\mu m\)</span>) and a spatial coordinate (in <em>arcsec</em>) to each
detector pixel, for each grism available.  Each 2D spectral image in
an observation is resampled into a rectified spatial-spectral grid, using
these coordinates to define the output grid.
If appropriate calibration data is available, the output from this step is an
image in which wavelength values are constant along the columns, and spatial
values are constant along the rows, correcting for any curvature in the
spectral trace (<a class="reference internal" href="#forcast-rectified"><span class="std std-numref">Fig. 84</span></a>).</p>
<p>These calibration maps are generated from identifications of sky emission
and telluric absorption lines and a polynomial fit to centroids of those
features in pixel space for each row (i.e. along the dispersion direction).
The derivation of a wavelength calibration is an interactive process, but
application of the derived wavelength calibration is an automatic part
of the data reduction pipeline. The default wavelength calibration is
expected to be good to within approximately one pixel in the output
spectrum.</p>
<p>For some observational cycles, sufficient calibration data may not be available,
resulting in some residual spectral curvature, or minor wavelength calibration
inaccuracies.  The spectral curvature can be compensated for, in sources
with strong continuum emission, by tracing the continuum center during
spectral extraction (see next section).  For other sources, a wider
aperture may be set, at the cost of decreased signal-to-noise.</p>
<p>For NMC observations, the central spectrum is doubled in flux after stacking,
as for imaging NMC modes.  After the rectified image is generated, it is
divided by 2 for NMC mode data, in order to normalize the flux value.
<a class="footnote-reference brackets" href="#fn-rectify" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a></p>
<p>Additionally, a correction that accounts
for spatial variations in the instrumental throughput may be applied to the
rectified image. This “slit correction function” is a function of the position
of the science target spectrum along the slit relative to that used for
the standard stars.  The slit function image is produced in a separate
calibration process, from observations of sources taken at varying places
on the slit.</p>
<figure class="align-default" id="forcast-rectified">
<img alt="Central positive trace and two negative traces.  Left: spatial curvature.  Right: straigter trace." src="../../../_images/rectified.png" />
<figcaption>
<p><span class="caption-number">Fig. 84 </span><span class="caption-text">A NMC spectral image, before (left) and after (right) rectification. The
black spots indicate bad pixels, identified with NaN values.  Bad pixel
influence grows during the resampling process in rectification.</span><a class="headerlink" href="#forcast-rectified" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fn-rectify" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>Earlier versions of this pipeline deferred this normalization to later
steps.  In pipeline versions prior to v1.4.0, the ‘rectimg’ product
(*RIM*.fits) was not normalized for NMC data: it should be divided
by 2 before being used for spectral extractions.</p>
</aside>
</aside>
</section>
<section id="set-apertures">
<span id="identify-apertures"></span><h5>Identify apertures<a class="headerlink" href="#set-apertures" title="Link to this heading">¶</a></h5>
<p>In order to aid in spectral extraction, the pipeline constructs a smoothed
model of the relative intensity of the target spectrum at each spatial
position, for each wavelength. This spatial profile is used to compute
the weights in optimal extraction or to fix bad pixels in standard
extraction (see next section). Also, the pipeline uses the median profile,
collapsed along the wavelength axis, to define the extraction
parameters.</p>
<p>To construct the spatial profile, the pipeline first subtracts the median
signal from each column in the rectified spectral image to remove the residual
background.  The intensity in this image in column <em>i</em> and row <em>j</em> is given by</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(O_{ij} = f_{i}P_{ij}\)</span></p>
</div></blockquote>
<p>where <span class="math notranslate nohighlight">\(f_i\)</span> is the total intensity of the spectrum at
wavelength <em>i</em>, and <span class="math notranslate nohighlight">\(P_{ij}\)</span> is the spatial profile at column <em>i</em>
and row <em>j</em>. To get the spatial profile <span class="math notranslate nohighlight">\(P_{ij}\)</span>, we must
approximate the intensity <span class="math notranslate nohighlight">\(f_i\)</span>. To do so, the pipeline computes a
median over the wavelength dimension (columns) of the order image to get a
first-order approximation of the median spatial profile at each row
<span class="math notranslate nohighlight">\(P_j\)</span>. Assuming that</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(O_{ij} \approx c_{i}P_{j}\)</span>,</p>
</div></blockquote>
<p>the pipeline uses a linear least-squares algorithm to fit <span class="math notranslate nohighlight">\(P_j\)</span> to
<span class="math notranslate nohighlight">\(O_{ij}\)</span> and thereby determine the coefficients <span class="math notranslate nohighlight">\(c_i\)</span>. These
coefficients are then used as the first-order approximation to <span class="math notranslate nohighlight">\(f_i\)</span>:
the resampled order image <span class="math notranslate nohighlight">\(O_{ij}\)</span> is divided by <span class="math notranslate nohighlight">\(f_i\)</span> to derive
<span class="math notranslate nohighlight">\(P_{ij}\)</span>.  The pipeline then fits a low-order polynomial along the
columns at each spatial point <em>s</em> in order to smooth the profile and
thereby increase its signal-to-noise. The coefficients of these fits can
then be used to determine the value of <span class="math notranslate nohighlight">\(P_{ij}\)</span> at any column <em>i</em> and
spatial point <em>j</em> (see <a class="reference internal" href="#forcast-profile"><span class="std std-numref">Fig. 85</span></a>, left). The median of <span class="math notranslate nohighlight">\(P_{ij}\)</span>
along the wavelength axis generates the median spatial profile, <span class="math notranslate nohighlight">\(P_j\)</span>
(see <a class="reference internal" href="#forcast-profile"><span class="std std-numref">Fig. 85</span></a>, right).</p>
<figure class="align-default" id="forcast-profile">
<img alt="Left: 3D surface in slit position vs. wavelength vs. flux.  Right: 1D plot of slit position vs. flux." src="../../../_images/profile.png" />
<figcaption>
<p><span class="caption-number">Fig. 85 </span><span class="caption-text">Spatial model and median spatial profile, for the image in
<a class="reference internal" href="#forcast-rectified"><span class="std std-numref">Fig. 84</span></a>.  The spatial model image here
is rotated for comparison with the profile plot: the y-axis is
along the bottom of the surface plot; the x-axis is along the left.</span><a class="headerlink" href="#forcast-profile" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The pipeline then uses the median spatial profile to identify extraction
apertures for the source. The aperture centers can be identified
automatically by iteratively finding local maxima in the absolute value
of the spatial profile, or can be specified directly by the user.  By
default, a single aperture is expected and defined by the pipeline,
but additional apertures may also be defined (e.g. for NMC or NPC
spectra with chopping or nodding on-slit, as in <a class="reference internal" href="#forcast-rectified"><span class="std std-numref">Fig. 84</span></a>).</p>
<p>The true position of the aperture center may vary somewhat
with wavelength, as a result of small optical effects or atmospheric
dispersion. To account for this variation, the pipeline attempts to
trace the spectrum across the array. It fits a Gaussian in the spatial
direction, centered at the specified position, at regular intervals in
wavelength. The centers of these fits are themselves fitted with a
low-order polynomial; the coefficients of these fits give the trace
coefficients that identify the center of the spectral aperture at each
wavelength. For extended sources, the continuum cannot generally be
directly traced. Instead, the pipeline fixes the aperture center to a
single spatial value.</p>
<p>Besides the aperture centers, the pipeline also specifies a PSF radius,
corresponding to the distance from the center at which the flux from the
source falls to zero. This value is automatically determined from the
width of a Gaussian fit to the peak in the median spatial profile, as</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(R_{psf} = 2.15 \cdot \text{FWHM}\)</span>.</p>
</div></blockquote>
<p>For optimal extraction, the pipeline also identifies a smaller aperture
radius, to be used as the integration region:</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(R_{ap} = 0.7 \cdot \text{FWHM}\)</span>.</p>
</div></blockquote>
<p>This value should give close to optimal signal-to-noise for a Moffat or
Gaussian profile.  The pipeline also attempts to specify background regions
outside of any extraction apertures, for fitting and removing the residual
sky signal.  All aperture parameters may be optionally overridden by the
pipeline user.</p>
</section>
<section id="spectral-extraction-and-merging">
<h5>Spectral extraction and merging<a class="headerlink" href="#spectral-extraction-and-merging" title="Link to this heading">¶</a></h5>
<p>The spectral extraction algorithms used by the pipeline offer two
different extraction methods, depending on the nature of the target
source. For point sources, the pipeline uses an optimal extraction
algorithm, described at length in the Spextool paper (see the
<a class="reference internal" href="#forcast-resources"><span class="std std-ref">Other Resources</span></a> section, below, for a reference).
For extended sources, the pipeline uses a standard summing extraction.</p>
<p>In either method, before extracting a spectrum, the pipeline first uses
any identified background regions to find the residual sky background
level. For each column in the 2D image, it fits a low-order
polynomial to the values in the specified regions, as a function of
slit position. This polynomial determines the wavelength-dependent
sky level (<span class="math notranslate nohighlight">\(B_{ij}\)</span>) to be subtracted from the spectrum
(<span class="math notranslate nohighlight">\(D_{ij}\)</span>).</p>
<p>The standard extraction method uses values from the spatial profile image
(<span class="math notranslate nohighlight">\(P_{ij}\)</span>) to replace bad pixels and outliers, then sums the flux
from all pixels contained within the PSF radius. The flux at column
<em>i</em> is then:</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(f_{i,\text{sum}} = \sum_{j=j_1}^{j_2}(D_{ij} - B_{ij})\)</span></p>
</div></blockquote>
<p>where <span class="math notranslate nohighlight">\(j_1\)</span> and <span class="math notranslate nohighlight">\(j_2\)</span> are the upper and lower limits of the extraction
aperture (in pixels):</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(j_1 = t_i - R_{PSF}\)</span></p>
<p><span class="math notranslate nohighlight">\(j_2 = t_i + R_{PSF}\)</span></p>
</div></blockquote>
<p>given the aperture trace center (<span class="math notranslate nohighlight">\(t_i\)</span>) at
that column. This extraction method is the only algorithm available
for extended sources.</p>
<p>Point sources may occasionally benefit from using standard extraction,
but optimal extraction generally produces higher signal-to-noise ratios
for these targets. This method works by weighting each pixel in the
extraction aperture by how much of the target’s flux it contains.
The pipeline first normalizes the spatial profile by the sum of the spatial
profile within the PSF radius defined by the user:</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(P_{ij}^{'} = P_{ij} \Big/ \sum_{j=j_1}^{j_2}P_{ij}\)</span>.</p>
</div></blockquote>
<p><span class="math notranslate nohighlight">\(P_{ij}^{'}\)</span> now represents the fraction of the total flux from
the target that is contained within pixel <em>(i,j)</em>, so that
<span class="math notranslate nohighlight">\((D_{ij} - B_{ij}) / P_{ij}^{'}\)</span> is a set of <em>j</em> independent
estimates of the total flux at column <em>i</em>. The pipeline does a weighted
average of these estimates, where the weight depends on the pixel’s
variance and the normalized profile value. Then, the flux at column <em>i</em> is:</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(f_{i,\text{opt}} = \frac{\sum_{j=j_3}^{j_4}{M_{ij}P_{ij}^{'}(D_{ij} - B_{ij}) \big/ (V_{D_{ij}} + V_{B_{ij}})}}{\sum_{j=j_3}^{j_4}{M_{ij}{P_{ij}^{'}}^{2} \big/ (V_{D_{ij}} + V_{B_{ij}})}}\)</span></p>
</div></blockquote>
<p>where <span class="math notranslate nohighlight">\(M_{ij}\)</span> is a bad pixel mask and <span class="math notranslate nohighlight">\(j_3\)</span>
and <span class="math notranslate nohighlight">\(j_4\)</span> are the upper and lower limits given by the aperture radius:</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(j_3 = t_i - R_{ap}\)</span></p>
<p><span class="math notranslate nohighlight">\(j_4 = t_i + R_{ap}\)</span></p>
</div></blockquote>
<p>Note that bad pixels are simply ignored, and outliers will have little
effect on the average because of the weighting scheme.</p>
<p>After extraction, spectra from separate apertures (e.g. for NMC mode,
with chopping on-slit) may be merged together to increase the
signal-to-noise of the final product. The default combination statistic
is a robust weighted mean.</p>
</section>
<section id="calibrate-flux-and-correct-for-atmospheric-transmission">
<span id="spectral-calibration"></span><h5>Calibrate flux and correct for atmospheric transmission<a class="headerlink" href="#calibrate-flux-and-correct-for-atmospheric-transmission" title="Link to this heading">¶</a></h5>
<p>Extracted spectra are corrected individually for instrumental
response and atmospheric transmission, a process that yields a
flux-calibrated spectrum in units of Jy per pixel. See the
section on flux calibration, below, for more detailed information.</p>
<p>The rectified spectral images are also corrected for atmospheric transmission,
and calibrated to physical units in the same manner.  Each row of the image
is divided by the same correction as the 1D extracted spectrum.  This image
is suitable for custom extractions of extended fields: a sum over any number of
rows in the image produces a flux-calibrated spectrum of that region,
in the same units as the spectrum produced directly by the pipeline.</p>
<p>Note that the FITS header for the primary extension for this product
(PRODTYPE = ‘calibrated_spectrum’) <a class="footnote-reference brackets" href="#fn-calrectimg" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>
contains a full spatial and spectral WCS that can be used to identify
the coordinates of any spectra so extracted.  The primary WCS identifies
the spatial direction as arcseconds up the slit, but a secondary WCS
with key = ‘A’ identifies the RA, Dec, and wavelength of every pixel
in the image.  Either can be extracted and used for pixel identification
with standard WCS manipulation packages, such as the
<a class="reference external" href="http://docs.astropy.org/en/stable/wcs/">astropy WCS package</a>.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fn-calrectimg" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">4</a><span class="fn-bracket">]</span></span>
<p>In early versions of the pipeline (before v1.4.0), the calibrated
rectified image was not produced.  For versions 1.4.0 to 1.5.0, the
product type was PRODTYPE = ‘calrectimg’, and it contained only the
calibrated image.  For version 2.0.0 and higher, the product type is
‘calibrated_spectrum’, and the calibrated image and associated WCS are
contained in the primary extension.  Subsequent extensions also contain
the calibrated extracted spectra and reference atmospheric transmission
and response spectra.</p>
</aside>
</aside>
<p>After telluric correction, it is possible to apply a correction to the
calibrated wavelengths for the motion of the Earth relative to the solar
system barycenter at the time of the observation.  For FORCAST resolutions,
we expect this wavelength shift to be a small fraction of a pixel, well within
the wavelength calibration error, so we do not directly apply it to the data.
The shift (as <span class="math notranslate nohighlight">\(d\lambda / \lambda\)</span>) is calculated and stored in the
header in the BARYSHFT keyword.  An additional wavelength correction to the
local standard of rest (LSR) from the barycentric velocity is also stored in
the header, in the LSRSHFT keyword.</p>
</section>
<section id="combine-multiple-observations">
<h5>Combine multiple observations<a class="headerlink" href="#combine-multiple-observations" title="Link to this heading">¶</a></h5>
<p>The final pipeline step for most grism observation modes is
coaddition of multiple spectra of the same
source with the same instrument configuration and observation mode. The
individual extracted 1D spectra are combined with a robust weighted
mean, by default.  The 2D spectral images are also coadded, using the same
algorithm as for imaging coaddition, and the spatial/spectral WCS to project
the data into a common coordinate system.</p>
<p>Reductions of flux standards have an alternate final product
(see <a class="reference internal" href="#response"><span class="std std-ref">Response spectra</span></a>, below).  Slit-scan observations also
produce an alternate final product instead of directly coadding
spectra (see <a class="reference internal" href="#speccube"><span class="std std-ref">Spectral cubes</span></a>, below).</p>
</section>
<section id="response-spectra">
<span id="response"></span><h5>Response spectra<a class="headerlink" href="#response-spectra" title="Link to this heading">¶</a></h5>
<p>The final product of pipeline processing of telluric standards is not a
calibrated, combined spectrum, but rather an instrumental response
spectrum that may be used to calibrate science target spectra.  These
response spectra are generated from individual observations of
calibration sources by dividing the observed spectra by a model of the
source multiplied by an atmospheric model.  The resulting response
curves may then be combined with other response spectra from a flight
series to generate a master instrument response spectrum that is used in
calibrating science spectra.  See the flux calibration section, below,
for more information.</p>
</section>
<section id="spectral-cubes">
<span id="speccube"></span><h5>Spectral cubes<a class="headerlink" href="#spectral-cubes" title="Link to this heading">¶</a></h5>
<p>For slit-scan observations, the calibrated, rectified images produced
at the flux calibration step are resampled together into a
spatial/spectral cube.</p>
<p>Since the pipeline rectifies all images onto
the same wavelength grid, each column in the image corresponds to the same
wavelength in all rectified images from the same grism. The pipeline
uses the WCS in the headers to assign a spatial position to each pixel in
each input image, then steps through the wavelength values, resampling the
spatial values into a common grid.</p>
<p>The resampling algorithm proceeds as follows.  At each wavelength value,
the algorithm loops over the output spatial grid, finding values within
a local fitting window.  Values within the window are
fit with a low-order polynomial surface fit.  These fits are weighted
by the error on the flux, as propagated by the pipeline, and by
a Gaussian function of the distance from the data point to the grid
location.  The output flux at each pixel is the value of the surface
polynomial, evaluated at the grid location.  The associated error
value is the error on the fit.  Grid locations for which there was
insufficient input data are set to NaN.  An exposure map cube indicating
the number of observations input at each pixel is also generated and
attached to the output FITS file.</p>
</section>
</section>
</section>
<section id="uncertainties">
<h3>Uncertainties<a class="headerlink" href="#uncertainties" title="Link to this heading">¶</a></h3>
<p>The pipeline calculates the expected uncertainties for raw FORCAST data as an
error image associated with the flux data.  FORCAST raw data is
recorded in units of ADU per coadded frame. The
variance associated with the <em>(i,j)</em>th pixel in this raw data is
calculated as:</p>
<div class="math notranslate nohighlight">
\[V_{ij} = \frac{N_{ij} \beta_g}{\text{FR} \cdot t \cdot g} + \frac{\text{RN}^2}{\text{FR} \cdot t \cdot g^2}\]</div>
<p>where <span class="math notranslate nohighlight">\(N\)</span> is the raw ADU per frame in each pixel, <span class="math notranslate nohighlight">\(\beta_g\)</span> is the
excess noise factor, <span class="math notranslate nohighlight">\(FR\)</span> is the frame rate, <span class="math notranslate nohighlight">\(t\)</span> is the integration
time, <span class="math notranslate nohighlight">\(g\)</span> is the gain, and <span class="math notranslate nohighlight">\(RN\)</span> is the read noise in electrons. The
first term corresponds to the Poisson noise, and the second to the read
noise. Since FORCAST data are expected to be background-limited, the
Poisson noise term should dominate the read noise term.  The error image
is the square root of <span class="math notranslate nohighlight">\(V_{ij}\)</span> for all pixels.</p>
<p>For all image processing steps and spectroscopy steps involving spectral images,
the pipeline propagates this calculated error image alongside the flux in
the standard manner. The error image is written to disk as an extra
extension in all FITS files produced at intermediate steps. <a class="footnote-reference brackets" href="#fn-variance" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a></p>
<p>The variance for the standard spectroscopic extraction is a simple sum of the
variances in each pixel within the aperture. For the optimal extraction
algorithm, the variance on the <em>i</em>th pixel in the extracted spectrum
is calculated as:</p>
<div class="math notranslate nohighlight">
\[V_{i} = \sum_{j=j_3}^{j_4} \frac{M_{ij}}{{P_{ij}^{'}}^2 V_{ij}}\]</div>
<p>where <span class="math notranslate nohighlight">\(P_{ij}^{'}\)</span> is the scaled spatial profile, <span class="math notranslate nohighlight">\(M_{ij}\)</span> is
a bad pixel mask, <span class="math notranslate nohighlight">\(V_{ij}\)</span> is the variance at each background-subtracted
pixel, and the sum is over all spatial pixels <span class="math notranslate nohighlight">\(j\)</span> within the aperture
radius. This equation comes from the Spextool paper, describing optimal
extraction.  The error spectrum for 1D spectra is the square root of the
variance.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fn-variance" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">5</a><span class="fn-bracket">]</span></span>
<p>In pipeline versions prior to v2.0.0, the error was stored as a variance
image, as a second plane in the primary FITS image extension. In versions
2.0.0 and later, each FITS image extension has a distinct scientific
meaning: flux and error images are stored as 2D data arrays, in separate
extensions.  Refer to the BUNIT keyword for the physical units of the
data stored in each extension.</p>
</aside>
</aside>
</section>
<section id="other-resources">
<span id="forcast-resources"></span><h3>Other Resources<a class="headerlink" href="#other-resources" title="Link to this heading">¶</a></h3>
<p>For more information about the pipeline software architecture and
implementation, see the FORCAST Redux Developer’s Manual.</p>
<p>For more information on the spectroscopic reduction algorithms
used in the pipeline, see the Spextool papers:</p>
<p><a class="reference external" href="http://irtfweb.ifa.hawaii.edu/~spex/Spextool.pdf">Spextool: A Spectral Extraction Package for SpeX, a 0.8-5.5 micron
Cross-Dispersed
Spectrograph</a></p>
<p>Michael C. Cushing, William D. Vacca and John T. Rayner
(2004, PASP 116,
362).</p>
<p><a class="reference external" href="http://irtfweb.ifa.hawaii.edu/~spex/Telluric.pdf">A Method of Correcting Near-Infrared Spectra for Telluric
Absorption</a></p>
<p>William D. Vacca, Michael C. Cushing and John T. Rayner
(2003, PASP 115,
389).</p>
<p><a class="reference external" href="http://irtfweb.ifa.hawaii.edu/~spex/Nonlinearity.pdf">Nonlinearity Corrections and Statistical Uncertainties Associated
with Near-Infrared
Arrays</a></p>
<p>William D. Vacca, Michael C. Cushing and John T. Rayner
(2004, PASP 116,
352).</p>
</section>
</section>
<section id="flux-calibration">
<h2>Flux calibration<a class="headerlink" href="#flux-calibration" title="Link to this heading">¶</a></h2>
<section id="imaging-flux-calibration">
<h3>Imaging Flux Calibration<a class="headerlink" href="#imaging-flux-calibration" title="Link to this heading">¶</a></h3>
<p>The reduction process, up through image coaddition, generates Level 2
images with data values in units of mega-electrons per second (Me/s).
After Level 2 imaging products are generated, the pipeline derives the
flux calibration factors (in units of Me/s/Jy) and applies them to each
image. The calibration factors are derived for each FORCAST filter
configuration (filter and dichroic) from observations of calibrator
stars.</p>
<p>After the calibration factors have been derived, the coadded flux
is divided by the appropriate factor to produce the Level 3 calibrated
data file, with flux in units of Jy/pixel.  The value used is stored in
the FITS keyword CALFCTR.</p>
<section id="reduction-steps">
<h4>Reduction steps<a class="headerlink" href="#reduction-steps" title="Link to this heading">¶</a></h4>
<p>The calibration is carried out in several steps. The first step consists
of measuring the photometry of all the standard stars for a specific
mission or flight series, after the images have been corrected for the
atmospheric transmission relative to that for a reference altitude and
zenith angle <a class="footnote-reference brackets" href="#fn-atran" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a>. The pipeline performs aperture photometry on the
reduced Level 2 images of the standard stars after the registration
stage using a photometric aperture radius of 12 pixels (about 9.2” for
FORCAST). The telluric-corrected photometry of the standard star is
related to the measured photometry of the star via</p>
<div class="math notranslate nohighlight">
\[N_{e}^{std,corr} = N_{e}^{std} \frac{R_{\lambda}^{ref}}{R_{\lambda}^{std}}\]</div>
<p>where the ratio <span class="math notranslate nohighlight">\(R_{\lambda}^{ref} / R_{\lambda}^{std}\)</span>
accounts for differences in system response (atmospheric transmission)
between the actual observations and those for the reference altitude of
41000 feet and a telescope elevation of 45<span class="math notranslate nohighlight">\(^\circ\)</span>. Similarly, for the science
target, we have</p>
<div class="math notranslate nohighlight">
\[N_{e}^{obj,corr} = N_{e}^{obj} \frac{R_{\lambda}^{ref}}{R_{\lambda}^{obj}}\]</div>
<p>Calibration factors (in Me/s/Jy) for each filter are then derived from
the measured photometry (in Me/s) and the known fluxes of the standards
(in Jy) in each filter. These predicted fluxes were computed by
multiplying a model stellar spectrum by the overall filter + instrument
+ telescope + atmosphere (at the reference altitude and zenith angle)
response curve and integrating over the filter passband to compute the
mean flux in the band. The adopted filter throughput curves are those
provided by the vendor or measured by the FORCAST team, modified to
remove regions (around 6-7 microns and 15 microns) where the values were
contaminated by noise. The instrument throughput is calculated by
multiplying the transmission curves of the entrance window, dichroic,
internal blockers, and mirrors, and the detector quantum efficiency. The
telescope throughput value is assumed to be constant (85%) across the
entire FORCAST wavelength range.</p>
<p>For most of the standard stars, the adopted stellar models were obtained
from the <em>Herschel</em> calibration group and consist of high-resolution
theoretical spectra, generated from the MARCS models (Gustafsson et al.
1975, Plez et al. 1992), scaled to match absolutely calibrated
observational fluxes (Dehaes et al. 2011). For <span class="math notranslate nohighlight">\(\beta\)</span> UMi, the model
was scaled by a factor of 1.18 in agreement with the results of the <em>Herschel</em>
calibration group (J. Blommaert, private communication; the newer
version of the model from the <em>Herschel</em> group has incorporated this
factor).</p>
<p>The calibration factor, <em>C</em>, is computed from</p>
<div class="math notranslate nohighlight">
\[C = \frac{N_e^{std,corr}}{F_{\nu}^{nom,std}(\lambda_{ref})} = \frac{N_e^{std,corr}}{\langle F_{\nu}^{std} \rangle} \frac{\lambda^2_{piv}}{\langle \lambda \rangle \lambda_{ref}}\]</div>
<p>with an uncertainty given by</p>
<div class="math notranslate nohighlight">
\[\bigg( \frac{\sigma_C}{C} \bigg)^2 = \bigg( \frac{\sigma_{N_e^{std}}}{N_e^{std}} \bigg)^2 + \bigg( \frac{\sigma_{\langle F_{\nu}^{std} \rangle}}{\langle F_{\nu}^{std} \rangle} \bigg)^2 .\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\lambda_{piv}\)</span> is the pivot wavelength of the filter, and <span class="math notranslate nohighlight">\(\langle \lambda \rangle\)</span> is
the mean wavelength of the filter. The calibration factor refers to a
nominal flat spectrum source at the reference
wavelength <span class="math notranslate nohighlight">\(\lambda_{ref}\)</span>.</p>
<p>The calibration factors derived from each standard for each filter are
then averaged. The pipeline inserts this value and its associated
uncertainty into the headers of the Level 2 data files for the flux
standards, and uses the value to produce calibrated flux standards.
The final step involves examining the calibration values and
ensuring that the values are consistent. Outlier values may come from
bad observations of a standard star; these values are removed to produce
a robust average of the calibration factor across the flight series. The
resulting average values are then used to calibrate the observations of
the science targets.</p>
<p>Using the telluric-corrected photometry of the standard,
<span class="math notranslate nohighlight">\(N_e^{std,corr}\)</span> (in Me/s), and the predicted mean fluxes
of the standards in each filter, <span class="math notranslate nohighlight">\(\langle F_{\nu}^{std} \rangle\)</span>
(in Jy), the flux of a target object is given by</p>
<div class="math notranslate nohighlight">
\[F_{\nu}^{nom,obj}(\lambda_{ref}) = \frac{N_e^{obj,corr}}{C}\]</div>
<p>where <span class="math notranslate nohighlight">\(N_e^{obj,corr}\)</span> is the telluric-corrected count
rate in Me/s detected from the source, <span class="math notranslate nohighlight">\(C\)</span> is the
calibration factor (Me/s/Jy), and
<span class="math notranslate nohighlight">\(F_{\nu}^{nom,obj}(\lambda_{ref})\)</span> is the flux in Jy of a
nominal, flat spectrum source (for which <span class="math notranslate nohighlight">\(F_{\nu} \sim \nu^{-1}\)</span>)
at a reference wavelength <span class="math notranslate nohighlight">\(\lambda_{ref}\)</span>.</p>
<p>The values of <span class="math notranslate nohighlight">\(C\)</span>, <span class="math notranslate nohighlight">\(\sigma_C\)</span>, and <span class="math notranslate nohighlight">\(\lambda_{ref}\)</span> are written into
the headers of the calibrated (PROCSTAT=LEVEL_3 ) data as the keywords CALFCTR, ERRCALF, and
LAMREF, respectively. The reference wavelength <span class="math notranslate nohighlight">\(\lambda_{ref}\)</span> for these
observations was taken to be the mean wavelengths of the filters,
<span class="math notranslate nohighlight">\(\langle \lambda \rangle\)</span>.</p>
<p>Note that <span class="math notranslate nohighlight">\(\sigma_C\)</span>, as stored in the ERRCALF value,
is derived from the standard deviation of the calibration factors
across multiple flights.  These values are typically on the order of
about 6% (see Herter et al. 2013).  There is an additional systematic
uncertainty on the stellar models, which is on the order of
5-10% (Dehaes et al. 2011).</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fn-atran" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">6</a><span class="fn-bracket">]</span></span>
<p>The atmospheric transmission in each filter has been computed using
the ATRAN code (Lord 1992) for a range of observatory altitudes
(corresponding to a range of overhead precipitable water vapor
values) and telescope elevations. The ratio of the transmission at
each altitude and zenith angle relative to that at the reference
altitude (41000 feet) and zenith angle (45 degrees) has been
calculated for each filter and fit with a low order polynomial. The
ratio appropriate for the altitude and zenith angle of each
observation is calculated and applied to each image.</p>
</aside>
</aside>
</section>
<section id="color-corrections">
<h4>Color corrections<a class="headerlink" href="#color-corrections" title="Link to this heading">¶</a></h4>
<p>An observer often wishes to determine the true flux of an object at the
reference wavelength, <span class="math notranslate nohighlight">\(F_{\nu}^{obj}(\lambda_{ref})\)</span>, rather
than the flux of an equivalent nominal, flat spectrum source. To do
this, we define a color correction <em>K</em> such that</p>
<div class="math notranslate nohighlight">
\[K = \frac{F_{\nu}^{nom,obj}(\lambda_{ref})}{F_{\nu}^{obj}(\lambda_{ref})}\]</div>
<p>where <span class="math notranslate nohighlight">\(F_{\nu}^{nom,obj}(\lambda_{ref})\)</span> is the flux density
obtained by measurement on a data product. Divide the measured
values by <em>K</em> to obtain the “true” flux density. In terms of the
wavelengths defined above,</p>
<div class="math notranslate nohighlight">
\[K = \frac{\langle \lambda \rangle \lambda_{ref}}{\lambda_{piv}^2}\frac{\langle F_{\nu}^{obj} \rangle}{F_{\nu}^{obj}(\lambda_{ref})} .\]</div>
<p>For most filters and spectral shapes, the color corrections are small
(&lt;10%). Tables listing <em>K</em> values and filter wavelengths are available
from the <a class="reference external" href="https://irsa.ipac.caltech.edu/data/SOFIA/docs/data/data-processing/">SOFIA website</a>.</p>
</section>
</section>
<section id="spectrophotometric-flux-calibration">
<h3>Spectrophotometric Flux Calibration<a class="headerlink" href="#spectrophotometric-flux-calibration" title="Link to this heading">¶</a></h3>
<p>The common approach to characterizing atmospheric transmission for
ground-based infrared spectroscopy is to obtain, for every science
target, similar observations of a spectroscopic standard source with as
close a match as possible in both airmass and time. Such an approach is
not practical for airborne observations, as it imposes too heavy a
burden on flight planning and lowers the efficiency of science
observations. Therefore, we employ a calibration plan that incorporates
a few observations of a calibration star per flight and a model of the
atmospheric absorption for the approximate altitude and airmass (and
precipitable water vapor, if known) at which the science objects were
observed.</p>
<p>Instrumental response curves are generated from the extracted spectra of
calibrator targets. For the G063 and G111 grisms, the calibrator targets
comprise the set of standard stars and the associated stellar models
provided by the <em>Herschel</em> Calibration program and used for the FORCAST
photometric calibration. For the G227 and G329 grisms, the calibrator
targets consist of bright asteroids. Blackbodies are fit to the
calibrated broadband photometric observations of the asteroids and these
serve as models of the intrinsic asteroid spectra. In either case, the
extracted spectra are corrected for telluric absorption using the ATRAN
models corresponding to the altitude and zenith angle of the calibrator
observations, smoothed to the nominal resolution for the grism/slit
combination, and sampled at the observed spectral binning. The
telluric-corrected spectra are then divided by the appropriate models to
generate response curves (with units of Me/s/Jy at each wavelength) for
the various grism+slit+channel combinations. The response curves
derived from the various calibrators for each instrumental combination
are then combined and smoothed to generate a set of master instrumental
response curves. The statistical uncertainties on these response curves
are on the order of 5-10%.</p>
<p>Spectra of science targets are first divided by the appropriate
instrumental response curve, a process that yields spectra in physical
units of Jy at each wavelength.</p>
<p>Telluric correction of FORCAST grism data for a science target is
currently carried out in a multi-step process:</p>
<ol class="arabic">
<li><p>Telluric absorption models have been computed, using ATRAN, for the
entire set of FORCAST grism passbands for every 1000 feet of altitude
between 35K and 45K feet, for every 5 degrees of zenith angle between
30 and 70 degrees, and for a set of precipitable water vapor (PWV)
values between 1 and 50 microns. These values span the allowed ranges
of zenith angle, typical range of observing altitudes, and the
expected range of PWV values for SOFIA observations. The spectra have
been smoothed to the nominal resolution for the grism and slit
combination and are resampled to the observed spectral binning.</p></li>
<li><p>If the spectrum of the science target has a signal-to-noise ratio
greater than 10, the
best estimate of the telluric absorption spectrum is derived in the
following manner: under the assumption that the intrinsic
low-resolution MIR spectrum of most targets can be well-represented
by a smooth, low-order polynomial, the telluric spectrum that
minimizes <span class="math notranslate nohighlight">\(\chi^2\)</span> defined as</p>
<div class="math notranslate nohighlight">
\[\chi_j^2 = \sum\limits_i^n \Big( F_i^{obs} - P_i T_i \big(\text{PWV}_j \big) \Big)^2 \big/ \sigma_i^2\]</div>
<p>is determined. Here <span class="math notranslate nohighlight">\(F_i^{obs}\)</span> is the
response-corrected spectrum at each of the <em>n</em> wavelength points <em>i</em>,
<span class="math notranslate nohighlight">\(\sigma_i\)</span> is the uncertainty at each point, <span class="math notranslate nohighlight">\(P_i\)</span> is the
polynomial at each point, and <span class="math notranslate nohighlight">\(T_i\)</span> is the telluric
spectrum corresponding to the precipitable water vapor value
<span class="math notranslate nohighlight">\(\text{PWV}_j\)</span>. The telluric spectra used in the calculations are
chosen from the pre-computed library generated with ATRAN. Only the
subset of ATRAN model spectra corresponding, as close as possible, to
the observing altitude and zenith angle, are considered in the
calculation. The free parameters determined in this step are the
coefficients of the polynomial and the PWV value, which then yields
the best telluric correction spectrum. The uncertainty on the PWV
value is estimated to be about 1-2 microns.</p>
</li>
<li><p>If the spectrum of the science target has a S/N less than 10, the
closest telluric spectrum (in terms of altitude and airmass of the
target observations) with the default PWV value from the ATRAN model
is selected from the pre-computed library.</p></li>
<li><p>In order to account for any wavelength shifts between the models and
the observations, an optimal shift is estimated by minimizing the
residuals of the corrected spectrum, with respect to small relative
wavelength shifts between the observed data and the telluric
spectrum.</p></li>
<li><p>The wavelength-shifted observed spectrum is then divided by the smoothed
and re-sampled telluric model. This then yields a telluric-corrected and
flux calibrated spectrum.</p></li>
</ol>
<p>Analysis of the calibrated spectra of observed standard stars
indicates that the average RMS deviation over the G063, G227,
and G329 grism passbands between the calibrated spectra and the models
is on the order of about 5%. For the G111 grism, the average RMS deviation is
found to be on the order of about 10%; the larger deviation for this grism is
due primarily to the highly variable ozone feature at 9.6 microns, which
the ATRAN models are not able to reproduce accurately. The Level 3 data
product for any grism includes the calibrated spectrum and an error
spectrum that incorporates these RMS values. The adopted telluric
absorption model and the instrumental response functions are also
provided.</p>
<p>As for any slit spectrograph, highly accurate absolute flux levels from
FORCAST grism observations (for absolute spectrophotometry, for example)
require additional photometric observations to correct the calibrated
spectra for slit losses that can be variable (due to varying image
quality) between the spectroscopic observations of the science target
and the calibration standard.</p>
</section>
</section>
<section id="data-products">
<h2>Data products<a class="headerlink" href="#data-products" title="Link to this heading">¶</a></h2>
<section id="filenames">
<h3>Filenames<a class="headerlink" href="#filenames" title="Link to this heading">¶</a></h3>
<p>Output files from Redux are named according to the convention:</p>
<blockquote>
<div><p><em>FILENAME = F[flight]_FO_IMA|GRI_AOR-ID_SPECTEL1|SPECTEL2_Type_FN1[-FN2]</em>.fits,</p>
</div></blockquote>
<p>where flight is the SOFIA flight number, FO is the instrument
identifier, IMA or GRI specifies that it is an imaging or grism file,
AOR-ID is the AOR identifier for the observation,
SPECTEL1|SPECTEL2 is the keyword specifying the filter or grism used,
Type is three letters identifying the product type (listed in
<a class="reference internal" href="#img-data-prod"><span class="std std-numref">Table 15</span></a> and <a class="reference internal" href="#spec-data-prod"><span class="std std-numref">Table 16</span></a>, below),
FN1 is the file number corresponding to the input file.
FN1-FN2 is used if there are multiple input files for a single output
file, where FN1 is the file number of the first input file and FN2 is
the file number of the last input file.</p>
</section>
<section id="pipeline-products">
<h3>Pipeline Products<a class="headerlink" href="#pipeline-products" title="Link to this heading">¶</a></h3>
<p>The following tables list all intermediate products generated by the pipeline
for imaging and grism modes, in the order in which they are produced. <a class="footnote-reference brackets" href="#fn-pipeprod" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a>
By default, for imaging, the <em>undistorted</em>, <em>merged</em>, <em>telluric_corrected</em>,
<em>coadded</em>, <em>calibrated</em>, and <em>mosaic</em> products are saved; for grism, the <em>stacked</em>,
<em>rectified_image</em>, <em>merged_spectrum</em>, <em>calibrated_spectrum</em>, <em>coadded_spectrum</em>,
and <em>combined_spectrum</em> products are saved.</p>
<p>The final grism mode output product from the Combine Spectra or Combine Response
steps are dependent on the input data: for INSTMODE=SLITSCAN, a <em>spectral_cube</em>
product is produced instead of a <em>coadded_spectrum</em> and <em>combined_spectrum</em>;
for OBSTYPE=STANDARD_TELLURIC, the <em>instrument_response</em> is produced instead.</p>
<p>For most observation modes, the pipeline additionally produces an image in PNG
format, intended to provide a quick-look preview of the data contained in
the final product.  These auxiliary products may be distributed to observers
separately from the FITS file products.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fn-pipeprod" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id7">7</a><span class="fn-bracket">]</span></span>
<p>Earlier versions of this pipeline (before v2.0.0) produced different
sets of default products.  Refer to earlier revisions of this manual
for complete information.</p>
</aside>
</aside>
<table class="longtable docutils align-default" id="img-data-prod">
<caption><span class="caption-number">Table 15 </span><span class="caption-text">Intermediate data products for imaging reductions</span><a class="headerlink" href="#img-data-prod" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 16.9%" />
<col style="width: 11.9%" />
<col style="width: 15.3%" />
<col style="width: 15.3%" />
<col style="width: 8.5%" />
<col style="width: 10.2%" />
<col style="width: 22.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line"><strong>Step</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>Data type</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>PRODTYPE</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>PROCSTAT</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>Code</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>Saved</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>Extensions</strong></div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">Clean Images</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">cleaned</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">CLN</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Correct Droop</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">drooped</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">DRP</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Correct Nonlinearity</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">linearized</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LNZ</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Stack Chops/Nods</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">stacked</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">STK</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Undistort</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">undistorted</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">UND</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Merge</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">merged</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">MRG</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, EXPOSURE</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Register</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">registered</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">REG</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, EXPOSURE</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Telluric Correct</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">telluric_</div>
<div class="line">corrected</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">TEL</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, EXPOSURE</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Coadd</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">coadded</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">COA</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, EXPOSURE</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Flux Calibrate</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">calibrated</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_3</div>
</div>
</td>
<td><div class="line-block">
<div class="line">CAL</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, EXPOSURE</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Mosaic</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">mosaic</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_4</div>
</div>
</td>
<td><div class="line-block">
<div class="line">MOS</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, EXPOSURE</div>
</div>
</td>
</tr>
</tbody>
</table>
<table class="longtable docutils align-default" id="spec-data-prod">
<caption><span class="caption-number">Table 16 </span><span class="caption-text">Intermediate data products for spectroscopy reduction</span><a class="headerlink" href="#spec-data-prod" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 16.8%" />
<col style="width: 11.8%" />
<col style="width: 15.1%" />
<col style="width: 15.1%" />
<col style="width: 8.4%" />
<col style="width: 10.1%" />
<col style="width: 22.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line"><strong>Step</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>Data type</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>PRODTYPE</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>PROCSTAT</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>Code</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>Saved</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>Extensions</strong></div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">Clean Images</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">cleaned</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">CLN</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Correct Droop</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">drooped</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">DRP</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Correct</div>
<div class="line">Nonlinearity</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">linearized</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LNZ</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Stack Chops/Nods</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">stacked</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">STK</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Make Profiles</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">rectified_</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">RIM</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, BADMASK,</div>
<div class="line">WAVEPOS, SLITPOS,</div>
<div class="line">SPATIAL_MAP,</div>
<div class="line">SPATIAL_PROFILE</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Locate Apertures</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">apertures_</div>
<div class="line">located</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LOC</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, BADMASK,</div>
<div class="line">WAVEPOS, SLITPOS,</div>
<div class="line">SPATIAL_MAP,</div>
<div class="line">SPATIAL_PROFILE</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Trace Continuum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">continuum_</div>
<div class="line">traced</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">TRC</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, BADMASK,</div>
<div class="line">WAVEPOS, SLITPOS,</div>
<div class="line">SPATIAL_MAP,</div>
<div class="line">SPATIAL_PROFILE,</div>
<div class="line">APERTURE_TRACE</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Set Apertures</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">apertures_set</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">APS</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, BADMASK,</div>
<div class="line">WAVEPOS, SLITPOS,</div>
<div class="line">SPATIAL_MAP,</div>
<div class="line">SPATIAL_PROFILE,</div>
<div class="line">APERTURE_TRACE,</div>
<div class="line">APERTURE_MASK</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Subtract</div>
<div class="line">Background</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">background_</div>
<div class="line">subtracted</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">BGS</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, BADMASK,</div>
<div class="line">WAVEPOS, SLITPOS,</div>
<div class="line">SPATIAL_MAP,</div>
<div class="line">SPATIAL_PROFILE,</div>
<div class="line">APERTURE_TRACE,</div>
<div class="line">APERTURE_MASK</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Extract Spectra</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image;</div>
<div class="line">1D spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">spectra</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SPM</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, BADMASK,</div>
<div class="line">WAVEPOS, SLITPOS,</div>
<div class="line">SPATIAL_MAP,</div>
<div class="line">SPATIAL_PROFILE,</div>
<div class="line">APERTURE_TRACE,</div>
<div class="line">APERTURE_MASK,</div>
<div class="line">SPECTRAL_FLUX,</div>
<div class="line">SPECTRAL_ERROR,</div>
<div class="line">TRANSMISSION</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Merge Apertures</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image;</div>
<div class="line">1D spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">merged_</div>
<div class="line">spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">MGM</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, BADMASK,</div>
<div class="line">WAVEPOS, SLITPOS,</div>
<div class="line">SPATIAL_MAP,</div>
<div class="line">SPATIAL_PROFILE,</div>
<div class="line">APERTURE_TRACE,</div>
<div class="line">APERTURE_MASK,</div>
<div class="line">SPECTRAL_FLUX,</div>
<div class="line">SPECTRAL_ERROR,</div>
<div class="line">TRANSMISSION</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Calibrate Flux</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image;</div>
<div class="line">1D spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">calibrated_</div>
<div class="line">spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_3</div>
</div>
</td>
<td><div class="line-block">
<div class="line">CRM</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, BADMASK,</div>
<div class="line">WAVEPOS, SLITPOS,</div>
<div class="line">SPATIAL_MAP,</div>
<div class="line">SPATIAL_PROFILE,</div>
<div class="line">APERTURE_TRACE,</div>
<div class="line">APERTURE_MASK,</div>
<div class="line">SPECTRAL_FLUX,</div>
<div class="line">SPECTRAL_ERROR</div>
<div class="line">TRANSMISSION,</div>
<div class="line">RESPONSE,</div>
<div class="line">RESPONSE_ERROR</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Combine Spectra</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image;</div>
<div class="line">1D spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">coadded_</div>
<div class="line">spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_3</div>
</div>
</td>
<td><div class="line-block">
<div class="line">COA</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR,</div>
<div class="line">EXPOSURE, WAVEPOS,</div>
<div class="line">SPECTRAL_FLUX,</div>
<div class="line">SPECTRAL_ERROR</div>
<div class="line">TRANSMISSION,</div>
<div class="line">RESPONSE</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Combine Spectra</div>
</div>
</td>
<td><div class="line-block">
<div class="line">1D spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">combined_</div>
<div class="line">spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_3</div>
</div>
</td>
<td><div class="line-block">
<div class="line">CMB</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Combine Spectra</div>
</div>
</td>
<td><div class="line-block">
<div class="line">3D spectral</div>
<div class="line">cube</div>
</div>
</td>
<td><div class="line-block">
<div class="line">spectral_</div>
<div class="line">cube</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_4</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SCB</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR,</div>
<div class="line">EXPOSURE, WAVEPOS,</div>
<div class="line">TRANSMISSION,</div>
<div class="line">RESPONSE</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Make Response</div>
</div>
</td>
<td><div class="line-block">
<div class="line">1D response</div>
<div class="line">spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">response_</div>
<div class="line">spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_3</div>
</div>
</td>
<td><div class="line-block">
<div class="line">RSP</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Combine Response</div>
</div>
</td>
<td><div class="line-block">
<div class="line">1D response</div>
<div class="line">spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">instrument_</div>
<div class="line">response</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_4</div>
</div>
</td>
<td><div class="line-block">
<div class="line">IRS</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX</div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="data-format">
<h3>Data Format<a class="headerlink" href="#data-format" title="Link to this heading">¶</a></h3>
<p>All files produced by the pipeline are multi-extension FITS
files (except for the <em>combined_spectrum</em>, <em>response_spectrum</em>, and
<em>instrument_response</em> products: see below). <a class="footnote-reference brackets" href="#fn-dataprod" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a>
The flux image is stored in the primary
header-data unit (HDU); its associated error image is stored in extension
1, with EXTNAME=ERROR.  For the <em>spectral_cube</em> product, these extensions
contain 3D spatial/spectral cubes instead of 2D images: each plane in the cube
represents the spatial information at a wavelength slice.</p>
<p>Imaging products may additionally contain an extension with EXTNAME=EXPOSURE,
which contains the nominal exposure time at each pixel, in seconds.  This
extension has the same meaning for the spectroscopic <em>coadded_spectrum</em>
and <em>spectral_cube</em> products.</p>
<p>In spectroscopic products, the SLITPOS and WAVEPOS extensions give the
spatial (rows) and spectral (columns) coordinates, respectively, for
rectified images.  These coordinates may also be derived from the WCS
in the primary header.  WAVEPOS also indicates the wavelength coordinates
for 1D extracted spectra.</p>
<p>Intermediate spectral products may contain SPATIAL_MAP and SPATIAL_PROFILE
extensions.  These contain the spatial map and median spatial profile,
described in the <a class="reference internal" href="#rectify-image"><span class="std std-ref">Rectify spectral image</span></a> section, above.  They may also contain
APERTURE_TRACE and APERTURE_MASK extensions.  These contain the spectral aperture
definitions, as described in the <a class="reference internal" href="#set-apertures"><span class="std std-ref">Identify apertures</span></a> section.</p>
<p>Final spectral products contain SPECTRAL_FLUX and SPECTRAL_ERROR extensions:
these are the extracted 1D spectrum and associated uncertainty.  They
also contain TRANSMISSION and RESPONSE extensions, containing the atmospheric
transmission and instrumental response spectra used to calibrate the spectrum
(see the <a class="reference internal" href="#spectral-calibration"><span class="std std-ref">Calibrate flux and correct for atmospheric transmission</span></a> section).</p>
<p>The <em>combined_spectrum</em>, <em>response_spectrum</em>, and <em>instrument_response</em>
are one-dimensional spectra, stored in Spextool format, as rows of data in
the primary extension.</p>
<p>For the <em>combined_spectrum</em>, the first row is the wavelength (um), the second
is the flux (Jy), the third is the error (Jy), the fourth is
the estimated fractional atmospheric transmission spectrum, and the fifth
is the instrumental response curve used in flux calibration (Me/s/Jy).
These rows correspond directly to the WAVEPOS, SPECTRAL_FLUX, SPECTRAL_ERROR,
TRANSMISSION, and RESPONSE extensions in the <em>coadded_spectrum</em> product.</p>
<p>For the <em>response_spectrum</em>, generated from telluric standard observations,
the first row is the wavelength (um), the second is the response spectrum
(Me/s/Jy), the third is the error on the response (Me/s/Jy),
the fourth is the atmospheric transmission spectrum (unitless), and the
fifth is the standard model used to derive the response (Jy).
The <em>instrument_reponse</em> spectrum, generated from combined
<em>response_spectrum</em> files, similarly has wavelength (um), response (Me/s/Jy),
error (Me/s/Jy), and transmission (unitless) rows.</p>
<p>The final uncertainties in calibrated images and spectra contain
only the estimated statistical uncertainties due to the noise in the
image or the extracted spectrum. The systematic uncertainties due to the
calibration process are recorded in header keywords. For imaging data,
the error on the calibration factor is recorded in the keyword ERRCALF.
For grism data, the estimated overall fractional error on the flux is
recorded in the keyword CALERR. <a class="footnote-reference brackets" href="#fn-calerr" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></a></p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fn-dataprod" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">8</a><span class="fn-bracket">]</span></span>
<p>In earlier versions of this pipeline (prior to 2.0.0), all image products
were 3D arrays of data, where the first plane was the image and the
second plane was the variance associated with
each pixel in the image. The square root of the variance plane gives
the uncertainty estimate associated with each pixel in the image.
An optional third plane was the exposure map, indicating the on-source
integration time in seconds at each pixel.  All spectral products were
in the Spextool format described above for the <em>combined_spectrum</em> product.</p>
</aside>
<aside class="footnote brackets" id="fn-calerr" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">9</a><span class="fn-bracket">]</span></span>
<p>Earlier versions of this pipeline (prior to 1.2.0) may have stored the
systematic calibration error in the error spectrum or variance image,
added in quadrature with the statistical error. Check PIPEVERS and
compare the error estimates for the calibrated products to earlier
products to ensure correct interpretation of the error estimates.</p>
</aside>
</aside>
</section>
<section id="data-quality">
<h3>Data Quality<a class="headerlink" href="#data-quality" title="Link to this heading">¶</a></h3>
<p>Data quality for FORCAST is recorded in the FITS keyword DATAQUAL and
can contain the following values:</p>
<ul class="simple">
<li><p><strong>NOMINAL:</strong> No outstanding issues with processing, calibration,
or observing conditions.</p></li>
<li><p><strong>USABLE:</strong> Minor issue(s) with processing, calibration, or conditions
but should still be scientifically valid (perhaps with larger than
usual uncertainties); see HISTORY records for details.</p></li>
<li><p><strong>PROBLEM:</strong> Significant issue(s) encountered with processing,
calibration, or observing conditions; may not be scientifically
useful (depending on the application); see HISTORY records for details.
In general, these cases are addressed through manual reprocessing
before archiving and distribution.</p></li>
<li><p><strong>FAIL:</strong> Data could not be processed successfully for some reason.
These cases are rare and generally not archived or distributed to the GI.</p></li>
</ul>
<p>Any issues found in the data or during flight are recorded as QA
Comments and emailed to the GI after processing and archiving.
A permanent record of these comments are also directly recorded in
the FITS files themselves.  Check the FITS headers, near the bottom of the
HISTORY section, under such titles as “Notes from quality analysis”
or “QA COMMENTS”.</p>
<p>Other data quality keywords include CALQUAL and WCSQUAL. The CALQUAL keyword
may have the following values:</p>
<ul class="simple">
<li><p><strong>NOMINAL:</strong> Calibration is within nominal historical variability of 5-10%.</p></li>
<li><p><strong>USABLE:</strong> Issue(s) with calibration. Variability is greater than
nominal limits, but still within the maximum requirements (&lt;20%).</p></li>
<li><p><strong>PROBLEM:</strong> Significant issue(s) with calibration variability
(&gt;20%), or inability to properly calibrate. Data may not be
scientifically useful.</p></li>
</ul>
<p>The keyword WCSQUAL refers to the quality of the World Coordinate System
(WCS) for astrometry. In very early FORCAST cycles, there were many issues
with astrometry, as described in the
<a class="reference external" href="https://irsa.ipac.caltech.edu/data/SOFIA/docs/sites/default/files/USpot_DCS_DPS/Documents/DCS_Known_Issues.pdf">Known Issues</a>
document. Astrometry could, in the worst cases, be off by a full chop- or
nod-throw distance (up to hundreds of pixels/arcseconds). These issues
were resolved in Cycle 3 and 4. However, there still appears to be a slight
distortion of 1-2 pixels across the FORCAST Field of View (FOV)
(where one FORCAST pixel is 0.768 arcsec). Methodologies to reduce this
distortion are currently being worked on. In addition, cooling of the
telescope mirror system exposed to the Stratosphere over the course of a
night observing can also result in a pointing accuracy change on order
of 1-2 pixels. Thus, is it important in cases where very accurate
astrometry is required that FORCAST data be checked relative to other
observations. This can also affect large mosaics of regions of the sky
where, depending on the changing rotation angle on sky, overlapping
sources may be slightly misaligned due to the distortion across the FOV.
Due to these issues the majority of data is set to a WCSQUAL value of
UNKNOWN. Values for the WCSQUAL keyword are described below:</p>
<ul class="simple">
<li><p><strong>NOMINAL:</strong> No issues with chop/nod position miscalculation;
WCS matches requested coordinates to within accuracy limits.</p></li>
<li><p><strong>PROBLEM:</strong> The WCS reference position deviates from the
requested coordinates by more than 1 pixel.</p></li>
<li><p><strong>UNKNOWN:</strong> WCS has not been confirmed, however beginning in
Cycle 4, are expected to match requested coordinates to within
accuracy limits.</p></li>
</ul>
</section>
<section id="exposure-time">
<h3>Exposure Time<a class="headerlink" href="#exposure-time" title="Link to this heading">¶</a></h3>
<p>FORCAST has many keywords for time of integration with slightly different
interpretation, including EXPTIME, TOTINT, and DETITIME. Due to the
details of the setup for chop/nod observations in symmetric and asymmetric
modes, the various integration times may not appear to match what was
calculated using SOFIA Instrument Time Estimator (SITE). From Cycle 10
onwards, SITE will be updated so that all times use EXPTIME and the mode
(C2NC2, NMC, etc.) will be selectable for a better estimate of the observing
time required. See below for a comparison of the total time keywords by
observing mode.</p>
<table class="longtable docutils align-default" id="time-table">
<caption><span class="caption-number">Table 17 </span><span class="caption-text">Integration time keywords</span><a class="headerlink" href="#time-table" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 50.0%" />
<col style="width: 25.0%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Mode</strong></p></th>
<th class="head"><p><strong>EXPTIME</strong></p></th>
<th class="head"><p><strong>TOTINT</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>NMC (shift and add negative beams,
e.g. standards)</p></td>
<td><p>2 × DETITIME</p></td>
<td><p>2 × DETITIME</p></td>
</tr>
<tr class="row-odd"><td><p>NMC (no shift and add, only use
positive beam)</p></td>
<td><p>1 × DETITIME</p></td>
<td><p>2 × DETITIME</p></td>
</tr>
<tr class="row-even"><td><p>C2NC2/NXCAC</p></td>
<td><p>0.5 × DETITIME</p></td>
<td><p>0.5 × DETITIME</p></td>
</tr>
</tbody>
</table>
</section>
<section id="pipeline-updates">
<h3>Pipeline Updates<a class="headerlink" href="#pipeline-updates" title="Link to this heading">¶</a></h3>
<p>The FORCAST data reduction pipeline software has gone through several
updates over time and is constantly improving. In particular, the recent update
to version 2.0.0 introduced some relatively large changes to the format
of the data that may require updates to any local routines used to
analyze the data.</p>
<p>Below is a table summarizing major changes by pipeline
version. Dates refer to approximate release dates. Check the PIPEVERS key in
FITS headers to confirm the version used to process the data, as
some early data may have been reprocessed with later pipeline versions.
More detailed change notes are available in <a class="reference internal" href="#forcast-change-notes"><span class="std std-ref">Appendix D: Change notes for the FORCAST pipeline</span></a>.</p>
<table class="longtable docutils align-default" id="pipevers-table">
<caption><span class="caption-number">Table 18 </span><span class="caption-text">Pipeline change notes</span><a class="headerlink" href="#pipevers-table" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>PIPEVERS</strong></p></th>
<th class="head"><p><strong>DATE</strong></p></th>
<th class="head"><p><strong>Software/Cycle</strong></p></th>
<th class="head"><p><strong>Comments</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>&lt;1.0.3</p></td>
<td><p>01/23/15</p></td>
<td><p>IDL:Cycle 1,2</p></td>
<td><p>Earliest FORCAST data where some modes were still being
commissioned.</p></td>
</tr>
<tr class="row-odd"><td><p>1.0.5</p></td>
<td><p>05/27/15</p></td>
<td><p>IDL:Cycle 3</p></td>
<td><p>TOTINT keyword added for comparison to requested/planned
value in SITE.</p></td>
</tr>
<tr class="row-even"><td><p>1.1.3</p></td>
<td><p>09/20/16</p></td>
<td><p>IDL:Cycle 4/5</p></td>
<td><p>Update rotation of field to filter boresight rather than
center of array; previous data may have had an offset in
astrometry between different filters.</p></td>
</tr>
<tr class="row-odd"><td><p>1.2.0</p></td>
<td><p>01/25/17</p></td>
<td><p>IDL:Cycle 4/5</p></td>
<td><p>Overall improvement to calibration. Updated to include
TEL files which are similar to REG files with telluric
corrections applied to each file. Final calibrated file
CAL file is same as COA file but with calibration factor
(CALFCTR) already applied. Improved telluric correction
for FORCAST grism data.</p></td>
</tr>
<tr class="row-even"><td><p>1.3.0</p></td>
<td><p>04/24/17</p></td>
<td><p>IDL:Cycle 5</p></td>
<td><p>Pipeline begins support for FORCAST LEVEL 4 Imaging
Mosaics. EXPOSURE map is now propagated in units of time
(seconds) instead of number of exposures.</p></td>
</tr>
<tr class="row-odd"><td><p>2.0.0</p></td>
<td><p>5/07/20</p></td>
<td><p>Python:Cycle 8/9</p></td>
<td><p>File format of FITS files for imaging updated from image
cube to separate extensions. Extensions are now FLUX,
ERROR, and EXPOSURE. ERROR now represents the standard
deviation (sigma) rather than the variance (sigma^2).
Spectroscopy data formats also move to separate
extensions, with some products combining spectra and 2D
spectral images.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="grouping-level-1-data-for-processing">
<h2>Grouping LEVEL_1 data for processing<a class="headerlink" href="#grouping-level-1-data-for-processing" title="Link to this heading">¶</a></h2>
<p>In order for a group of imaging data to be reduced together usefully,
all images must have the same target object and be taken in the same
chop/nod mode. They must also have the same detector, filter, and
dichroic setting. In order to be combined together, they must also be
taken on the same mission. Optionally, it may also be useful to separate
out data files taken from different observation plans.</p>
<p>For spectroscopy, all the same rules hold, with the replacement of grism
element for filter, and with the additional requirement that the same
slit be used for all data files.</p>
<p>These requirements translate into a set of FITS header keywords that
must match in order for a set of data to be grouped together. These
keyword requirements are summarized in the tables below.</p>
<table class="docutils align-default" id="img-group">
<caption><span class="caption-number">Table 19 </span><span class="caption-text">Grouping Criteria: Imaging</span><a class="headerlink" href="#img-group" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Keyword</strong></p></th>
<th class="head"><p><strong>Data Type</strong></p></th>
<th class="head"><p><strong>Match Criterion</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>OBSTYPE</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>OBJECT</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>INSTCFG</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>DETCHAN</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>SPECTEL1 / SPECTEL2*</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>BORESITE</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>DICHROIC</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>MISSN-ID (optional)</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>PLANID (optional)</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>AOR_ID (optional)</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="spec-group">
<caption><span class="caption-number">Table 20 </span><span class="caption-text">Grouping Criteria: Spectroscopy</span><a class="headerlink" href="#spec-group" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Keyword</strong></p></th>
<th class="head"><p><strong>Data Type</strong></p></th>
<th class="head"><p><strong>Match Criterion</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>OBSTYPE</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>OBJECT</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>INSTCFG</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>DETCHAN</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>SPECTEL1 / SPECTEL2*</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>BORESITE</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>DICHROIC</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>SLIT**</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>MISSN-ID (optional)</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>PLANID (optional)</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>AOR_ID (optional)</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
</tbody>
</table>
<p>* SPECTEL1 is used if the detector is the SWC (DETCHAN=SW); SPECTEL2 is
used for LWC (DETCHAN=LW)</p>
<p>** If SLIT is in use (value != “NONE” or “UNKNOWN”), <strong>always</strong>
include group in the grism plan, regardless of INSTCFG. This ensures
that slit images get reduced with the spectroscopic data and placed in
the same preview.</p>
</section>
<section id="configuration-and-execution">
<h2>Configuration and execution<a class="headerlink" href="#configuration-and-execution" title="Link to this heading">¶</a></h2>
<section id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h3>
<p>The FORCAST pipeline is written entirely in Python.  The pipeline is
platform independent and has been tested on Linux, Mac OS X, and Windows
operating systems.  Running the pipeline requires a minimum of 16GB RAM,
or equivalent-sized swap file.</p>
<p>The pipeline is comprised of five modules within the <code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux</span></code> package:
<code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.instruments.forcast</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.pipeline</span></code>,
<code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.calibration</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.spectroscopy</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.toolkit</span></code>.
The <code class="xref py py-obj docutils literal notranslate"><span class="pre">forcast</span></code> module provides the data processing
algorithms specific to FORCAST, with supporting libraries from the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">toolkit</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">calibration</span></code>, and <code class="xref py py-obj docutils literal notranslate"><span class="pre">spectroscopy</span></code> modules.  The <code class="xref py py-obj docutils literal notranslate"><span class="pre">pipeline</span></code> module
provides interactive and batch interfaces to the pipeline algorithms.</p>
<section id="external-requirements">
<h4>External Requirements<a class="headerlink" href="#external-requirements" title="Link to this heading">¶</a></h4>
<p>To run the pipeline for any mode, Python 3.8 or
higher is required, as well as the following packages: numpy, scipy,
matplotlib, pandas, astropy, configobj, numba, bottleneck, joblib,
and photutils.
Some display functions for the graphical user interface (GUI)
additionally require the PyQt5, pyds9, and regions packages.
All required external packages are available to install via the
pip or conda package managers.  See the Anaconda environment file
(environment.yml), or the pip requirements file (requirements.txt)
distributed with <code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux</span></code> for up-to-date version requirements.</p>
<p>Running the pipeline interactively also requires an installation of
SAO DS9 for FITS image display. See <a class="reference external" href="http://ds9.si.edu/">http://ds9.si.edu/</a> for download
and installation instructions.  The <em>ds9</em> executable
must be available in the PATH environment variable for the pyds9
interface to be able to find and control it.  Please note that pyds9
is not available on the Windows platform</p>
</section>
<section id="source-code-installation">
<h4>Source Code Installation<a class="headerlink" href="#source-code-installation" title="Link to this heading">¶</a></h4>
<p>The source code for the FORCAST pipeline maintained by the SOFIA Data
Processing Systems (DPS) team can be obtained directly from the
DPS, or from the external <code class="xref py py-obj docutils literal notranslate"><span class="pre">GitHub</span> <span class="pre">repository</span></code>.
This repository contains all needed configuration
files, auxiliary files, and Python code to run the pipeline on FORCAST
data in any observation mode.</p>
<p>After obtaining the source code, install the package with
the command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>python setup.py install
</pre></div>
</div>
<p>from the top-level directory.</p>
<p>Alternately, a development installation may be performed from inside the
directory with the command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pip install -e .
</pre></div>
</div>
<p>After installation, the top-level pipeline interface commands should
be available in the PATH.  Typing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux
</pre></div>
</div>
<p>from the command line should launch the GUI interface, and:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux_pipe -h
</pre></div>
</div>
<p>should display a brief help message for the command line interface.</p>
</section>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Link to this heading">¶</a></h3>
<p>For FORCAST algorithms, default parameter values are defined by the
Redux object that interfaces to them. These values may be overridden
manually for each step, while running in interactive mode. They may also
be overridden by an input parameter file, in INI format, in either
interactive or automatic mode. See Appendix A for an example of an input
parameter file, which contains the current defaults for all parameters.</p>
</section>
<section id="input-data">
<h3>Input data<a class="headerlink" href="#input-data" title="Link to this heading">¶</a></h3>
<p>Redux takes as input raw FORCAST FITS data files, which contain image
cubes composed of 256x256 pixel image arrays. The number of frames per
raw data cube depends on the chop/nod mode used to acquire the data (see
<a class="reference internal" href="#raw-format"><span class="std std-numref">Table 21</span></a>). The FITS headers contain data acquisition and observation
parameters and, combined with the pipeline configuration files, comprise
the information necessary to complete all steps of the data reduction
process. Some critical keywords are required to be present in the raw
FITS headers in order to perform a successful grouping, reduction, and
ingestion into the SOFIA archive. See Appendix B for a description of
these keywords.</p>
<table class="docutils align-default" id="raw-format">
<caption><span class="caption-number">Table 21 </span><span class="caption-text">Contents of FORCAST raw data files by observing mode</span><a class="headerlink" href="#raw-format" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Chop/Nod Mode</strong></p></th>
<th class="head"><p><strong>Number of frames</strong></p></th>
<th class="head"><p><strong>Comments</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>C2N, NMC</p></td>
<td><p>4</p></td>
<td><p>Two-Position Chop with Nod Matched in throw and parallel to the chop direction</p>
<p>2 chop positions in each of 2 nod positions</p>
</td>
</tr>
<tr class="row-odd"><td><p>C2N, NPC</p></td>
<td><p>4</p></td>
<td><p>Two-Position Chop with Nod perpendicular to the chop direction</p>
<p>2 chop positions in each of 2 nod positions</p>
</td>
</tr>
<tr class="row-even"><td><p>C2NC2</p></td>
<td><p>4</p></td>
<td><p>Extreme asymmetric chop and telescope move to blank sky: two chop positions per sky position. Typically 5 input files corresponding to ABAABAAB pattern</p></td>
</tr>
<tr class="row-odd"><td><p>N</p></td>
<td><p>2</p></td>
<td><p>Two-position Nod only, may be used for grism spectroscopy</p></td>
</tr>
<tr class="row-even"><td><p>SLITSCAN</p></td>
<td><p>4</p></td>
<td><p>Spectral map of an extended source, most likely using C2NC2 but could use C2N</p></td>
</tr>
</tbody>
</table>
<p>It is assumed that the input data have been successfully grouped before
beginning reduction: Redux considers all input files in a reduction to
be science files that are part of a single homogeneous reduction group,
to be reduced together with the same parameters. As such, when the
pipeline reads a raw FORCAST data file, it uses the first input file to
identify the observing mode used. Given this information, it identifies
a set of auxiliary and calibration data files to be used in the
reduction (<a class="reference internal" href="#auxiliary"><span class="std std-numref">Table 22</span></a>). The default files to be used are defined in a
lookup table that reads the DATE-OBS keyword from the raw file, and then
chooses the appropriate calibrations for that date.</p>
<table class="docutils align-default" id="auxiliary">
<caption><span class="caption-number">Table 22 </span><span class="caption-text">Auxiliary files</span><a class="headerlink" href="#auxiliary" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Auxiliary data file</strong></p></th>
<th class="head"><p><strong>Data type</strong></p></th>
<th class="head"><p><strong>Comments</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Configuration file</p>
<p>(e.g. OC3_dripconf.txt)</p>
</td>
<td><p>ASCII</p></td>
<td><p>Contains initial configuration of pipeline parameters and nonlinearity coefficients</p></td>
</tr>
<tr class="row-odd"><td><p>Keyword definition file</p>
<p>(e.g. OC3_keywords.txt)</p>
</td>
<td><p>ASCII</p></td>
<td><p>Contains the definition of required keywords, with allowed value ranges</p></td>
</tr>
<tr class="row-even"><td><p>Bad pixel mask</p>
<p>(e.g. swc_badpix.fits)</p>
</td>
<td><p>FITS</p></td>
<td><p>Single 2D image containing locations of bad pixels in short wave or long wave camera</p></td>
</tr>
<tr class="row-odd"><td><p>Pinhole location table</p>
<p>(e.g. pinhole_locs.txt)</p>
</td>
<td><p>ASCII</p></td>
<td><p>Pinhole locations file for distortion correction (imaging only)</p></td>
</tr>
<tr class="row-even"><td><p>Reference flux calibration table</p>
<p>(e.g. refcalfac_20191025.txt)</p>
</td>
<td><p>ASCII</p></td>
<td><p>Flux calibration factor (imaging only)</p></td>
</tr>
<tr class="row-odd"><td><p>Spectral order definition file</p>
<p>(e.g. G063_LS24_flat.fits)</p>
</td>
<td><p>FITS</p></td>
<td><p>Image file containing header keywords that define the edges of all orders in a 2D spectral image (grism only)</p></td>
</tr>
<tr class="row-even"><td><p>Wavelength calibration map</p>
<p>(e.g. G063_wavecal_OC3.fits)</p>
</td>
<td><p>FITS</p></td>
<td><p>Two frame image associating a wavelength value and a spatial distance across the slit with each pixel (grism only)</p></td>
</tr>
<tr class="row-odd"><td><p>Atmospheric transmission curve</p>
<p>(e.g. atran_41K_45deg_4-50mum.fits)</p>
</td>
<td><p>FITS</p></td>
<td><p>A FITS image with wavelength and transmission values for a particular altitude and zenith angle (grism only)</p></td>
</tr>
<tr class="row-even"><td><p>Instrumental response curve</p>
<p>(e.g. G063_LS24_DB175_response.fits)</p>
</td>
<td><p>FITS</p></td>
<td><p>FITS image containing the response at each wavelength for a particular grism/slit mode (grism only)</p></td>
</tr>
<tr class="row-odd"><td><p>Slit function image</p>
<p>(e.g. G063_LS24_slitfn_OC2.fits)</p>
</td>
<td><p>FITS</p></td>
<td><p>FITS image containing the slit response, in rectified spectral coordinates (grism only)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="automatic-mode-execution">
<h3>Automatic Mode Execution<a class="headerlink" href="#automatic-mode-execution" title="Link to this heading">¶</a></h3>
<p>The DPS pipeline infrastructure runs a pipeline on previously-defined
reduction groups as a fully-automatic black box. To do so, it creates an
input manifest (<em>infiles.txt</em>) that contains relative paths to the input
files (one per line). The command-line interface to the
pipeline is run as:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux_pipe infiles.txt
</pre></div>
</div>
<p>The command-line interface will read in the specified input files, use
their headers to determine the observation mode, and accordingly
the steps to run and any intermediate files to save. Output files are
written to the current directory, from which the pipeline was called.
After reduction is complete, the script will generate an output manifest
(<em>outfiles.txt</em>) containing the relative paths to all output FITS files
generated by the pipeline.</p>
<p>Optionally, in place of a manifest file, file paths to input files may
be directly specified on the command line.  Input files may be raw
FITS files, or may be intermediate products previously produced
by the pipeline.  For example, this command will complete the reduction
for a set of FITS files in the current directory, previously reduced
through the calibration step of the pipeline:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux_pipe *CAL*.fits
</pre></div>
</div>
<p>To customize batch reductions from the command line, the <em>redux_pipe</em> interface
accepts a configuration file on the command line.  This file may contain
any subset of the full configuration file, specifying any non-default
parameters for pipeline steps.  An output directory for pipeline products
and the terminal log level may also be set on the command line.</p>
<p>The full set of optional command-line parameters accepted by the <em>redux_pipe</em>
interface are:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-h, --help            show this help message and exit
-c CONFIG, --configuration CONFIG
                      Path to Redux configuration file.
-o OUTDIR, --out OUTDIR
                      Path to output directory.
-l LOGLEVEL, --loglevel LOGLEVEL
                      Log level.
</pre></div>
</div>
</section>
<section id="manual-mode-execution">
<h3>Manual Mode Execution<a class="headerlink" href="#manual-mode-execution" title="Link to this heading">¶</a></h3>
<p>In manual mode, the pipeline may be run interactively, via a graphical
user interface (GUI) provided by the Redux package.  The GUI is launched by
the command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux
</pre></div>
</div>
<p>entered at the terminal prompt (<a class="reference internal" href="#forcast-startup"><span class="std std-numref">Fig. 86</span></a>).  The GUI allows
output directory specification, but it may write initial or temporary
files to the current directory, so it is recommended to start the
interface from a location to which the user has write privileges.</p>
<p>From the command line, the <em>redux</em> interface accepts an optional config file
(<em>-c</em>) or log level specification (<em>-l</em>), in the same way the <em>redux_pipe</em>
command does.  Any pipeline parameters provided to the interface in a
configuration file will be used to set default values; they will still be
editable from the GUI.</p>
<figure class="align-default" id="forcast-startup">
<img alt="Startup screen showing an outline of an airplane with an open telescope door on a blue background showing faint spiral arms and stylized stars." src="../../../_images/startup3.png" />
<figcaption>
<p><span class="caption-number">Fig. 86 </span><span class="caption-text">Redux GUI startup.</span><a class="headerlink" href="#forcast-startup" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<section id="basic-workflow">
<h4>Basic Workflow<a class="headerlink" href="#basic-workflow" title="Link to this heading">¶</a></h4>
<p>To start an interactive reduction, select a set of input files, using
the File menu (<strong>File-&gt;Open New Reduction</strong>). This will bring up a file
dialog window (see <a class="reference internal" href="#forcast-open-new"><span class="std std-numref">Fig. 87</span></a>). All files selected will be reduced
together as a single reduction set.</p>
<p>Redux will decide the appropriate reduction steps from the input files,
and load them into the GUI, as in <a class="reference internal" href="#forcast-reduction-steps"><span class="std std-numref">Fig. 88</span></a>.</p>
<figure class="align-default" id="forcast-open-new">
<img alt="File system dialog window showing selected filenames." src="../../../_images/open_new3.png" />
<figcaption>
<p><span class="caption-number">Fig. 87 </span><span class="caption-text">Open new reduction.</span><a class="headerlink" href="#forcast-open-new" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="forcast-reduction-steps">
<img alt="GUI window showing reduction steps with Edit and Run buttons. A log window is displayed with text messages from a reduction." src="../../../_images/reduction_steps3.png" />
<figcaption>
<p><span class="caption-number">Fig. 88 </span><span class="caption-text">Sample reduction steps. Log output from the pipeline is
displayed in the <strong>Log</strong> tab.</span><a class="headerlink" href="#forcast-reduction-steps" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Each reduction step has a number of parameters that can be edited
before running the step. To examine or edit these parameters,
click the <strong>Edit</strong> button next to the step name to bring up the
parameter editor for that step (<a class="reference internal" href="#forcast-parameters"><span class="std std-numref">Fig. 89</span></a>). Within the
parameter editor, all values may be edited.  Click <strong>OK</strong> to save the
edited values and close the window. Click <strong>Reset</strong> to restore any
edited values to their last saved values.  Click <strong>Restore Defaults</strong>
to reset all values to their stored defaults.
Click <strong>Cancel</strong> to discard all changes to the parameters and
close the editor window.</p>
<figure class="align-default" id="forcast-parameters">
<img alt="An Edit Parameters dialog window, showing various selection widgets." src="../../../_images/parameters3.png" />
<figcaption>
<p><span class="caption-number">Fig. 89 </span><span class="caption-text">Sample parameter editor for a pipeline step.</span><a class="headerlink" href="#forcast-parameters" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The current set of parameters can be displayed, saved to a file,
or reset all at once using the <strong>Parameters</strong> menu. A previously
saved set of parameters can also be restored for use with the
current reduction (<strong>Parameters -&gt; Load Parameters</strong>).</p>
<p>After all parameters for a step have been examined and set to the
user’s satisfaction, a processing step can be run on all loaded
files either by clicking <strong>Step</strong>, or the <strong>Run</strong> button next to the
step name. Each processing step must be run in order, but if a
processing step is selected in the <strong>Step through:</strong> widget,
then clicking <strong>Step</strong> will treat all steps up through the selected
step as a single step and run them all at once. When a step has
been completed, its buttons will be grayed out and inaccessible.
It is possible to undo one previous step by clicking <strong>Undo</strong>.
All remaining steps can be run at once by clicking <strong>Reduce</strong>.
After each step, the results of the processing may be displayed
in a data viewer. After running a pipeline step or reduction,
click <strong>Reset</strong> to restore the reduction to the initial state,
without resetting parameter values.</p>
<p>Files can be added to the reduction set (<strong>File -&gt; Add Files</strong>) or
removed from the reduction set (<strong>File -&gt; Remove Files</strong>), but
either action will reset the reduction for all loaded files.
Select the <strong>File Information</strong> tab to display a table of information
about the currently loaded files (<a class="reference internal" href="#forcast-file-info"><span class="std std-numref">Fig. 90</span></a>).</p>
<figure class="align-default" id="forcast-file-info">
<img alt="A table display showing filenames and FITS keyword values." src="../../../_images/file_info3.png" />
<figcaption>
<p><span class="caption-number">Fig. 90 </span><span class="caption-text">File information table.</span><a class="headerlink" href="#forcast-file-info" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="display-features">
<h4>Display Features<a class="headerlink" href="#display-features" title="Link to this heading">¶</a></h4>
<p>The Redux GUI displays images for quality analysis and display (QAD)
in the DS9 FITS viewer.  DS9 is a standalone image display
tool with an extensive feature set.  See the SAO DS9 site
(<a class="reference external" href="http://ds9.si.edu/">http://ds9.si.edu/</a>) for more usage information.</p>
<p>After each pipeline step completes, Redux may load the produced images
into DS9.  Some display options may be customized directly in DS9;
some commonly used options are accessible from the Redux interface, in the
<strong>Data View</strong> tab (<a class="reference internal" href="#forcast-data-view"><span class="std std-numref">Fig. 91</span></a>).</p>
<figure class="align-default" id="forcast-data-view">
<img alt="Data viewer settings with various widgets and buttons to control display parameters and analysis tools." src="../../../_images/data_view3.png" />
<figcaption>
<p><span class="caption-number">Fig. 91 </span><span class="caption-text">Data viewer settings and tools.</span><a class="headerlink" href="#forcast-data-view" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>From the Redux interface, the <strong>Display Settings</strong> can be used to:</p>
<ul class="simple">
<li><p>Set the FITS extension to display (<strong>First</strong>, or edit to enter
a specific extension), or specify that all extensions should
be displayed in a cube or in separate frames.</p></li>
<li><p>Lock individual frames together, in image or WCS coordinates.</p></li>
<li><p>Lock cube slices for separate frames together, in image or
WCS coordinates.</p></li>
<li><p>Set the image scaling scheme.</p></li>
<li><p>Set a default color map.</p></li>
<li><p>Zoom to fit image after loading.</p></li>
<li><p>Tile image frames, rather than displaying a single frame at a
time.</p></li>
</ul>
<p>Changing any of these options in the Data View tab will cause the
currently displayed data to be reloaded, with the new options.
Clicking <strong>Reset Display Settings</strong> will revert any edited options
to the last saved values.  Clicking <strong>Restore Default Display Settings</strong>
will revert all options to their default values.</p>
<p>In the <strong>QAD Tools</strong> section of the <strong>Data View</strong> tab, there are
several additional tools available.</p>
<p>Clicking the <strong>ImExam</strong> button
(scissors icon) launches an event loop in DS9.  After launching it,
bring the DS9 window forward, then use the keyboard to perform interactive
analysis tasks:</p>
<ul class="simple">
<li><p>Type ‘a’ over a source in the image to perform photometry at the
cursor location.</p></li>
<li><p>Type ‘p’ to plot a pixel-to-pixel comparison of all frames at the
cursor location.</p></li>
<li><p>Type ‘s’ to compute statistics and plot a histogram of the data
at the cursor location.</p></li>
<li><p>Type ‘c’ to clear any previous photometry results or active plots.</p></li>
<li><p>Type ‘h’ to print a help message.</p></li>
<li><p>Type ‘q’ to quit the ImExam loop.</p></li>
</ul>
<p>The photometry settings (the image window considered, the model fit,
the aperture sizes, etc.) may be customized in the <strong>Photometry Settings</strong>.
Plot settings (analysis window size, shared plot axes, etc.) may be
customized in the <strong>Plot Settings</strong>.
After modifying these settings, they will take effect only for new
apertures or plots (use ‘c’ to clear old ones first).  As for the display
settings, the reset button will revert to the last saved values
and the restore button will revert to default values.
For the pixel-to-pixel and histogram plots, if the cursor is contained within
a previously defined DS9 region (and the <code class="xref py py-obj docutils literal notranslate"><span class="pre">regions</span></code> package is installed),
the plot will consider only pixels within the region.  Otherwise, a window
around the cursor is used to generate the plot data.  Setting the window
to a blank value in the plot settings will use the entire image.</p>
<p>Clicking the <strong>Header</strong> button (magnifying glass icon) from the
<strong>QAD Tools</strong> section opens a new window that displays headers
from currently loaded FITS files in text form (<a class="reference internal" href="#forcast-headers"><span class="std std-numref">Fig. 92</span></a>).
The extensions displayed depends on the extension
setting selected (in <strong>Extension to Display</strong>).  If a particular extension is
selected, only that header will be displayed.  If all extensions
are selected (either for cube or multi-frame display), all extension
headers will be displayed.  The buttons at the bottom of the window
may be used to find or filter the header text, or generate a table
of header keywords.  For filter or table display, a comma-separated
list of keys may be entered in the text box.</p>
<p>Clicking the <strong>Save Current Settings</strong> button (disk icon) from the
<strong>QAD Tools</strong> section saves all current display and photometry
settings for the current user.  This allows the user’s settings to
persist across new Redux reductions, and to be loaded when Redux
next starts up.</p>
<figure class="align-default" id="forcast-headers">
<img alt="A dialog window showing a sample FITS header in plain text." src="../../../_images/headers3.png" />
<figcaption>
<p><span class="caption-number">Fig. 92 </span><span class="caption-text">QAD FITS header viewer.</span><a class="headerlink" href="#forcast-headers" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="forcast-reduction">
<h3>FORCAST Reduction<a class="headerlink" href="#forcast-reduction" title="Link to this heading">¶</a></h3>
<section id="imaging-reduction">
<h4>Imaging Reduction<a class="headerlink" href="#imaging-reduction" title="Link to this heading">¶</a></h4>
<p>FORCAST imaging reduction with Redux is straightforward. The
processing steps follow the flowchart of <a class="reference internal" href="#flowchart-img"><span class="std std-numref">Fig. 77</span></a>.
At each step, Redux attempts to determine automatically the correct
action, given the input data and default parameters, but each step
can be customized as needed.</p>
<section id="useful-parameters">
<h5>Useful Parameters<a class="headerlink" href="#useful-parameters" title="Link to this heading">¶</a></h5>
<p>Some key parameters to note are listed below.</p>
<p>In addition to the specified parameters, the output from each step may
be optionally saved by selecting the ‘save’ parameter.</p>
<ul>
<li><p><strong>Check Headers</strong></p>
<ul class="simple">
<li><p><em>Abort reduction for invalid headers</em>: By default, Redux will halt the
reduction if the input header keywords do not meet requirements.
Uncheck this box to attempt the reduction anyway.</p></li>
</ul>
</li>
<li><p><strong>Clean Images</strong></p>
<ul class="simple">
<li><p><em>Bad pixel map</em>: The default bad pixel mask on disk is automatically
loaded. Set blank to use no bad pixel map. Set to a
valid FITS file path to override the default bad pixel mask with a
new one.</p></li>
<li><p><em>Automatically detect readout shift</em>: If selected, the pipeline
will attempt to automatically detect and correct the readout shift
described below.</p></li>
<li><p><em>Image number to shift (if not auto)</em>: This option
allows the user to fix an occasional issue where the data array is
shifted to the right by 16 pixels. If multiple images are loaded,
but only some are affected, the images to shift may be specified
by their index in the list of input files, separated by
semi-colons. For example, to shift the first and third file, enter
‘1;3’. If all input files should be shifted, enter ‘all’. Leave
blank to leave all data unshifted (the default behavior).</p></li>
<li><p><em>Interpolate over bad pixels</em>: By default, bad pixels are propagated
as NaN values.  Set this option to interpolate over them instead.</p></li>
</ul>
</li>
<li><p><strong>Correct Droop</strong></p>
<ul class="simple">
<li><p><em>Droop fraction</em>: Lower value to decrease droop correction; set to
zero to turn off droop correction altogether. Default value is
currently 0.0035 for all data.</p></li>
</ul>
</li>
<li><p><strong>Correct Nonlinearity</strong></p>
<ul class="simple">
<li><p><em>Background section center</em>: Specify the center point of the region
used to determine the background level in integers as ‘x,y’, in pixels.</p></li>
<li><p><em>Background section size</em>: Specify the width of the background region
in integer pixels as ‘size_x,size_y’.</p></li>
</ul>
</li>
<li><p><strong>Stack Chops/Nods</strong></p>
<ul class="simple">
<li><p><em>Add all frames instead of subtracting</em>: If set, the
instrument mode will be ignored and all chops and nods will be
added.  This option may be used to generate a sky frame, for
debugging or calibration purposes.</p></li>
<li><p><em>Apply ‘jailbar’ correction</em>: If set, the 16-pixel jailbar pattern
will be removed after stacking.</p></li>
<li><p><em>Scale frames to common level</em>: If selected, images will be
corrected for a multiplicative offset in the background level.
This is not commonly used.</p></li>
<li><p><em>Subtract residual background</em>: If selected, images will be
corrected for an additive offset in the background level.
This option is off by default for C2NC2 data, but on for all other
modes.  Background differences may occasionally be overcorrected,
in which case, this option should be deselected, or the background
section modified.  Some C2NC2 data with sufficient background regions
may also benefit from turning this option on.</p></li>
<li><p><em>Background section center</em>: Specify the center point of the region
used to determine the background level in integers as ‘x,y’, in pixels.</p></li>
<li><p><em>Background section size</em>: Specify the width of the background region
in integer pixels as ‘size_x,size_y’.</p></li>
<li><p><em>Residual background statistic</em>: Select the statistic used to calculate
the background level.  Options are median or mode.</p></li>
</ul>
</li>
<li><p><strong>Correct Distortion</strong></p>
<ul class="simple">
<li><p><em>Pinhole locations</em>: The default pinhole mask table is automatically
loaded. Set to a valid text file path to override it.</p></li>
<li><p><em>Skip distortion</em>: This option allows one to skip distortion correction.</p></li>
<li><p><em>Extrapolate solution</em>: If not set, edges of the image beyond known
pinhole inputs will be set to NaN.</p></li>
</ul>
</li>
<li><p><strong>Merge Chops/Nods</strong></p>
<ul class="simple">
<li><p><em>Merging algorithm</em>: The default for flux standard observations
(OBSTYPE=STANDARD_FLUX) is to shift-and-add the data, using a
centroiding algorithm. If the centroiding algorithm fails, header
data will be used instead. The default for science data is not to
shift-and-add (‘No shift’).</p></li>
<li><p><em>Skip rotation</em>: If set, the sky angle rotation correction is not
applied to both the image and the WCS coordinate system.</p></li>
</ul>
</li>
<li><p><strong>Register Images</strong></p>
<ul class="simple">
<li><p><em>Registration algorithm</em>: The default for all data is to
use the WCS as is for registration. Centroiding is
may be useful for bright, compact objects; cross-correlation
may be useful for bright, diffuse fields. Registration via the
‘Header shifts’ method may be useful for older data, for which the
relative WCS is not very accurate. The ‘Use first WCS’ option
will treat all images as pre-registered: the data will be coadded
directly without shifts.</p></li>
<li><p><em>Override offsets for all images</em>: If registration offsets are
known a priori, they may be directly entered here. Specify
semi-colon separated offsets, as x,y. For example, for three
input images, specify ‘0,0;2,0;0,2’ to leave the first as is,
shift the second two pixels to the right in x,
and shift the third two pixels up in y.</p></li>
<li><p><em>Expected FWHM for centroiding</em>: Specify the expected FWHM in pixels,
for the centroiding algorithm.  This may be useful in registering
bright compact sources that are not point sources.</p></li>
<li><p><em>Maximum shift for cross-correlation</em>: Specify the maximum allowed
shift in pixels for the cross-correlation algorithm.  This limit is
applied for shifts in both x- and y-direction.</p></li>
</ul>
</li>
<li><p><strong>Telluric Correct</strong></p>
<ul class="simple">
<li><p><em>Use WV values</em>: If set, water vapor values from the header (WVZ_OBS)
will be used to correct for atmospheric transmission, instead of
altitude.</p></li>
</ul>
</li>
<li><p><strong>Coadd</strong></p>
<ul class="simple">
<li><p><em>Skip coaddition</em>: If selected, each input registered file will be
saved as a separate file of type ‘coadded’ rather than combined
together into a single output file.</p></li>
<li><p><em>Reference coordinate system</em>: If set to ‘First image’, all
images will be referenced to the sky position in the first image
file. If set to ‘Target position’, the
TGTRA/TGTDEC keywords in the FITS header will be used to apply
an additional offset for registering non-sidereal targets.  If
these keywords are not present, or if their value is constant,
the algorithm defaults to the ‘First image’ behavior.
‘Target position’ is on by default; ‘First image’ is recommended only
if the TGTRA/TGTDEC keywords are known to have bad values.</p></li>
<li><p><em>Combination method</em>: Median is the default; mean may also be useful
for some input data.  The resample option may project data more
accurately, and allows an additional smoothing option, but takes
much longer to complete.</p></li>
<li><p><em>Use weighted mean</em>: If set, the average of the data will be
weighted by the variance. Ignored for method=median.</p></li>
<li><p><em>Robust combination</em>: If set, data will be sigma-clipped before
combination for mean or median methods.</p></li>
<li><p><em>Outlier rejection threshold (sigma)</em>: The sigma-clipping threshold
for robust combination methods, in units of sigma (standard deviation).</p></li>
<li><p><em>Gaussian width for smoothing (pixels)</em>: If method=resample, a smoothing
may be applied to the output averages.  Specify the Gaussian width in
pixels.  Set smaller (but non-zero) for less smoothing; higher for
more smoothing.</p></li>
</ul>
</li>
<li><p><strong>Flux Calibrate</strong></p>
<ul class="simple">
<li><p><em>Re-run photometry for standards</em>: If selected, and observation is
a flux standard, photometric fits and aperture measurements on the
brightest source will be recalculated, using the input parameters
below.</p></li>
<li><p><em>Source position</em>: Enter the approximate position (x,y) of the
source to measure. If not specified, the SRCPOSX/SRCPOSY keywords
in the FITS header will be used as the first estimate of the
source position.</p></li>
<li><p><em>Photometry fit size</em>: Smaller subimages may sometimes
be necessary for faint sources and/or variable background.</p></li>
<li><p><em>Initial FWHM</em>: Specify in pixels. This parameter
should be modified only if the PSF of the source is significantly
larger or smaller than usual.</p></li>
<li><p><em>Profile type</em>: Moffat fits are the default, as they generally
give a more reliable FWHM value. However, Gaussian fits may
sometimes be more stable, and therefore preferable if the Moffat
fit fails.</p></li>
</ul>
</li>
<li><p><strong>Make Image Map</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><em>Color map</em>: Color map for the output PNG image.  Any valid Matplotlib
name may be specified.</p></li>
<li><p><em>Flux scale for image</em>: A low and high percentile value , used for
scaling the image, e.g. [0,99].</p></li>
<li><p><em>Number of contours</em>: Number of contour levels to be over-plotted on
the image.  Set to 0 to turn off contours.</p></li>
<li><p><em>Contour color</em>: Color for the contour lines.  Any valid Matplotlib
color name may be specified.</p></li>
<li><p><em>Filled contours</em>: If set, contours will be filled instead of overlaid.</p></li>
<li><p><em>Overlay grid</em>: If set, a coordinate grid will be overlaid.</p></li>
<li><p><em>Beam marker</em>: If set, a beam marker will be added to the plot.</p></li>
<li><p><em>Watermark text</em>: If set to a non-empty string, the text will be
added to the lower-right of the image as a semi-transparent watermark.</p></li>
<li><p><em>Crop NaN border</em>: If set, any remaining NaN or zero-valued border
will be cropped out of plot.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
</section>
<section id="grism-reduction">
<h4>Grism Reduction<a class="headerlink" href="#grism-reduction" title="Link to this heading">¶</a></h4>
<p>Spectral extraction with Redux is slightly more complicated than
image processing. The GUI breaks down the spectral extraction algorithms
into six separate reduction steps to give more control over the extraction
process. These steps are:</p>
<ul class="simple">
<li><p>Make Profiles: Generate a smoothed model of the relative distribution
of the flux across the slit (the spatial profile). After this step is
run, a separate display window showing a plot of the spatial profile
appears.</p></li>
<li><p>Locate Apertures: Use the spatial profile to identify spectra to extract.
By default, Redux attempts to automatically identify sources, but
they can also be manually identified by entering a guess position to
fit near, or a fixed position, in the parameters. Aperture locations
are plotted in the profile window.</p></li>
<li><p>Trace Continuum: Identify the location of the spectrum across the
array, by either fitting the continuum or fixing the location to the
aperture center.  The aperture trace is displayed as a region
overlay in DS9.</p></li>
<li><p>Set Apertures: Identify the data to extract from the spatial profile.
This is done automatically by default, but all aperture
parameters can be overridden manually in the parameters for this
step.  Aperture radii and background regions are plotted in the
profile window (see <a class="reference internal" href="#forcast-profile-plot"><span class="std std-numref">Fig. 93</span></a>).</p></li>
<li><p>Subtract Background: Residual background is fit and removed for
each column in the 2D image, using background regions specified
in the Set Apertures step.</p></li>
<li><p>Extract Spectra: Extract one-dimensional spectra from the
identified apertures. By default, Redux will perform standard
extraction for observations that are marked as extended sources
(SRCTYPE=EXTENDED_SOURCE) and will attempt optimal extraction for
any other value. The method can be overridden in the parameters for
this step.</p></li>
</ul>
<p>Extracted spectra are displayed in an interactive plot window, for
data analysis and visualization (see <a class="reference internal" href="#forcast-spectral-plot"><span class="std std-numref">Fig. 94</span></a>).</p>
<p>The spectral display tool has a number of useful features and controls.
See <a class="reference internal" href="#forcast-eye-controls-image"><span class="std std-numref">Fig. 95</span></a> and the table below for a quick summary.</p>
<table class="longtable docutils align-default" id="id56">
<caption><span class="caption-number">Table 23 </span><span class="caption-text">Spectral Viewer controls</span><a class="headerlink" href="#id56" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 30.0%" />
<col style="width: 30.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Feature</strong></p></th>
<th class="head"><p><strong>Control</strong></p></th>
<th class="head"><p><strong>Keyboard shortcut</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Load new FITS file</p></td>
<td><p><em>File Choice -&gt; Add File</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>Remove loaded FITS file</p></td>
<td><p><em>File Choice -&gt;</em>
<em>Remove File</em></p></td>
<td><p>Press <em>delete</em> in the
<em>File Choice</em> panel</p></td>
</tr>
<tr class="row-even"><td><p>Plot selected file</p></td>
<td><p><em>File Choice -&gt;</em>
<em>(double-click)</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>Add a new plot window (pane)</p></td>
<td><p><em>Panes -&gt;</em>
<em>Add Pane</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Remove a pane</p></td>
<td><p><em>Panes -&gt;</em>
<em>Remove Pane</em></p></td>
<td><p>Press <em>delete</em> in the
<em>Panes</em> panel, or in
the plot window</p></td>
</tr>
<tr class="row-odd"><td><p>Show or hide a plot</p></td>
<td><p><em>Panes -&gt; Pane # -&gt;</em>
<em>File name -&gt; Enabled</em>,
or click the <em>Hide all</em>/
<em>Show all</em> button</p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Display a different X or Y
field (e.g. spectral error,
transmission, or response)</p></td>
<td><p><em>Axis -&gt;</em>
<em>X Property</em> or
<em>Y Property</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>Overplot a different Y axis
field (e.g. spectral error,
transmission, or response)</p></td>
<td><p><em>Axis -&gt;</em>
<em>Overplot -&gt; Enabled</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Change X or Y units</p></td>
<td><p><em>Axis -&gt;</em>
<em>X Unit</em> or
<em>Y Unit</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>Change X or Y scale</p></td>
<td><p><em>Axis -&gt;</em>
<em>X Scale</em> or <em>Y Scale</em>
<em>-&gt; Linear</em> or <em>Log</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Interactive zoom</p></td>
<td><p><em>Axis -&gt; Zoom</em>:
<em>X</em>, <em>Y</em>, <em>Box</em>,
then click in the plot
to set the limits; or
<em>Reset</em> to reset the
limits to default.</p></td>
<td><p>In the plot window,
press <em>x</em>, <em>y</em>, or
<em>z</em> to start zoom mode
in x-direction,
y-direction, or box
mode, respectively.
Click twice on the
plot to set the new
limits.  Press <em>w</em>
to reset the plot
limits to defaults.</p></td>
</tr>
<tr class="row-odd"><td><p>Fit a spectral feature</p></td>
<td><p>–</p></td>
<td><p>In the plot window,
press <em>f</em> to start
the fitting mode.
Click twice on the
plot to set the data
limits to fit.</p></td>
</tr>
<tr class="row-even"><td><p>Change the feature or baseline
fit model</p></td>
<td><p><em>Analysis -&gt; Feature,</em>
<em>Background</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>Load a spectral line list for
overplot display</p></td>
<td><p><em>Analysis -&gt; Reference</em>
<em>Data: Open, Load List</em></p>
<p>Select a one- or two-
column text file
containing wavelengths in
microns and (optionally)
labels for the values.
Columns may be comma,
space, or ‘|’ separated.</p>
</td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Clear zoom or fit mode</p></td>
<td><p>–</p></td>
<td><p>In the plot window,
press <em>c</em> to clear
guides and return to
default display mode.</p></td>
</tr>
<tr class="row-odd"><td><p>Change the plot color cycle</p></td>
<td><p><em>Plot -&gt;
Color cycle -&gt;
Accessible</em>, <em>Spectral</em>
or <em>Tableau</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Change the plot type</p></td>
<td><p><em>Plot -&gt; Plot type -&gt;
Step</em>, <em>Line</em>, or
<em>Scatter</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>Change the plot display options</p></td>
<td><p><em>Plot -&gt;
Show markers</em>,
<em>Show errors</em>,
<em>Show grid</em>, or
<em>Dark mode</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Display the cursor position</p></td>
<td><p><em>Cursor panel</em> -&gt;
Check <em>Cursor Location</em>
for a quick display or
press <em>Popout</em> for full
information</p></td>
<td><p>–</p></td>
</tr>
</tbody>
</table>
<figure class="align-default" id="forcast-profile-plot">
<img alt="A display window with a profile plot and lines marking the aperture." src="../../../_images/profile_plot2.png" />
<figcaption>
<p><span class="caption-number">Fig. 93 </span><span class="caption-text">Aperture location automatically identified and over-plotted
on the spatial profile.  The cyan line indicates the aperture center.
Green lines indicate the integration aperture for optimal extraction,
dark blue lines indicate the PSF radius (the point at which the flux
goes to zero), and red lines indicate background regions.</span><a class="headerlink" href="#forcast-profile-plot" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="forcast-spectral-plot">
<img alt="A GUI window showing a spectral trace plot, in Wavepos (um) vs. Spectral_flux (Jy)." src="../../../_images/spectral_plot2.png" />
<figcaption>
<p><span class="caption-number">Fig. 94 </span><span class="caption-text">Final extracted spectrum, displayed in an interactive plot window.</span><a class="headerlink" href="#forcast-spectral-plot" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="forcast-eye-controls-image">
<img alt="A GUI window showing a spectral plot and various buttons and widgets to control the plot display." src="../../../_images/eye_controls2.png" />
<figcaption>
<p><span class="caption-number">Fig. 95 </span><span class="caption-text">Control panels for the spectral viewer are located to the left and
below the plot window.  Click the arrow icons to show or collapse
them.</span><a class="headerlink" href="#forcast-eye-controls-image" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<section id="id10">
<h5>Useful Parameters<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h5>
<p>Below are listed some key parameters for the grism processing steps.
Note that the Check Headers through Stack Chops/Nods steps are identical to
those used for the imaging data: their parameters are listed above.
In addition to the specified parameters, the output from each step may
be optionally saved by selecting the ‘save’ parameter.</p>
<ul class="simple">
<li><p><strong>Stack Dithers</strong></p>
<ul>
<li><p><em>Skip dither stacking</em>: If set, common dither positions will not be
stacked.  This is the default: dither stacking is only recommended
for faint spectra that cannot otherwise be automatically extracted.</p></li>
<li><p><em>Ignore dither information from header</em>: If set, all input files are
stacked regardless of dither position.</p></li>
<li><p><em>Combination method</em>: Mean is the default; median may also be useful
for some input data.</p></li>
<li><p><em>Use weighted mean</em>: If set, the average of the data will be
weighted by the variance. Ignored for method=median.</p></li>
<li><p><em>Robust combination</em>: If set, data will be sigma-clipped before
combination.</p></li>
<li><p><em>Outlier rejection threshold (sigma)</em>: The sigma-clipping threshold
for robust combination methods, in units of sigma (standard deviation).</p></li>
</ul>
</li>
<li><p><strong>Make Profiles</strong></p>
<ul>
<li><p><em>Wave/space calibration file</em>: The default calibration
file is automatically loaded. Set to a valid FITS file path to
override the default calibration map with a new one.</p></li>
<li><p><em>Slit correction file</em>: The default slit correction
file is automatically loaded, if available. If blank, no slit
correction will be applied. Set to a valid FITS file path to
override the default file with a new one.</p></li>
<li><p><em>Row fit order</em>: Typically a third-order polynomial fit is used
to calculate the smooth spatial profile. Occasionally, a higher or
lower order fit may give better results.</p></li>
<li><p><em>Subtract median background</em>: If set, then the
median level of the smoothed spatial profile will be subtracted
out to remove residual background from the total extracted flux.
If the SRCTYPE is EXTENDED_SOURCE or the INSTMODE is slitscan,
this option will be off by default.  For other data,
this option is appropriate as long as the slit is dominated by
background, rather than source flux. If the spatial profile dips
below zero at any point (other than for a negative spectrum), this
option should be deselected.</p></li>
<li><p><em>Atmospheric transmission threshold</em>: Transmission values below this
threshold are not considered when making the spatial profile.
Values are 0-1.</p></li>
<li><p><em>Simulate calibrations</em>: Simulate calibration values instead of using
the wave/space calibration file.  This option is primarily used for
testing.</p></li>
</ul>
</li>
<li><p><strong>Locate Apertures</strong></p>
<ul>
<li><p><em>Aperture location method</em>: If ‘auto’, the strongest Gaussian peak(s) in the
spatial profile will be selected, with an optional starting guess
(<em>Aperture position</em>, below).  If ‘fix to input’, the value in the
<em>Aperture position</em> parameter will be used without refinement.
If ‘fix to center’, the center of the slit will be used.  ‘Fix to center’
is default for EXTENDED_SOURCE and SLITSCAN; otherwise ‘auto’ is default.</p></li>
<li><p><em>Number of auto apertures</em>: Set this parameter
to 1 to automatically find the single brightest source, or 2 to find the
two brightest sources, etc. Sources may be positive or negative.</p></li>
<li><p><em>Aperture position</em>: Enter a guess value for the aperture to use as a
starting point for method = ‘auto’, or a fixed value to use as the
aperture center for method = ‘fix to input’. Values are in arcseconds
up the slit (refer to the spatial profile). Separate multiple
apertures for a single file by commas;
separate values for multiple files by semi-colons. For example,
<em>3,8;2,7</em> will look for two apertures in each of two files, near
3” and 8” in the first image and 2” and 7” in the second image. If
there are multiple files loaded, but only one aperture list is
given, the aperture parameters will be used for all images.</p></li>
<li><p><em>Expected aperture FWHM (arcsec)</em>: Gaussian FWHM estimate for spatial
profile fits, to determine peaks.</p></li>
</ul>
</li>
<li><p><strong>Trace Continuum</strong></p>
<ul>
<li><p><em>Trace method</em>: If ‘fit to continuum’ is selected, points along the
continuum will be fit with a Gaussian to determine the trace
center at each location, and then the positions will be fit with a
low-order polynomial. If ‘fix to aperture position’ is selected,
no fit will be attempted, and the default slit curvature defined
by the edge definition file will be used as the aperture location.
By default, the trace will be fixed for EXTENDED_SOURCE and SLITSCAN,
but a fit will be attempted for all other data types.</p></li>
<li><p><em>Trace fit order</em>: Polynomial fit order for the aperture center,
along the spectral dimension.</p></li>
</ul>
</li>
<li><p><strong>Set Apertures</strong></p>
<ul>
<li><p><em>Extract the full slit</em>: If set, all other parameters are ignored,
and the PSF radius will be set to include the full slit.</p></li>
<li><p><em>Refit apertures for FWHM</em>: The spatial FWHM for the aperture is used
to determine the aperture and PSF radii, unless they are directly
specified.  If this parameter is set, the profile will be re-fit with
a Gaussian to determine the FWHM.  If it is not set, the value
determined or set in the Locate Apertures step is used (stored
as APFWHM01 in the FITS header).</p></li>
<li><p><em>Aperture sign</em>: Enter either 1 or -1 to skip the
automatic determination of the aperture sign from the spatial
profile. If the value is -1, the spectrum will be multiplied by
-1. Separate multiple apertures by commas; separate values for
multiple files by semi-colons. If a single value is specified,
it will be applied to all apertures.</p></li>
<li><p><em>Aperture radius</em>: Enter a radius in arcsec to skip the
automatic determination of the aperture radius from the profile
FWHM. Separate multiple apertures by commas; separate values for
multiple files by semi-colons. If a single value is specified,
it will be applied to all apertures.</p></li>
<li><p><em>PSF radius</em>: Enter a radius in arcsec to skip the
automatic determination of the PSF radius from the profile
FWHM. Separate multiple apertures by commas; separate values for
multiple files by semi-colons. If a single value is specified,
it will be applied to all apertures.</p></li>
<li><p><em>Background regions</em>: Enter a range in arcsec to use as the
background region, skipping automatic background determination.
For example, <em>0-1,8-10</em> will use the regions
between 0” and 1” and between 8” and 10” to determine the
background level to subtract in extraction. Values are for the
full image, rather than for a particular aperture.  Separate
values for multiple files with semi-colons.</p></li>
</ul>
</li>
<li><p><strong>Subtract Background</strong></p>
<ul>
<li><p><em>Skip background subtraction</em>: Set to skip calculating and removing
residual background. If no background regions were set, background
subtraction will be automatically skipped.</p></li>
<li><p><em>Background fit order</em>: Set to a number greater than or equal to
zero for the polynomial order of the fit to the background
regions.</p></li>
</ul>
</li>
<li><p><strong>Extract Spectra</strong></p>
<ul>
<li><p><em>Save extracted 1D spectra</em>: If set, the extracted spectra will
be saved to disk in Spextool format.  This option is normally used only
for diagnostic purposes.</p></li>
<li><p><em>Extraction method</em>: The default is to use
standard extraction for EXTENDED_SOURCE and SLITSCAN and optimal
extraction otherwise. Standard extraction may be necessary for
some faint sources.</p></li>
<li><p><em>Use median profile instead of spatial map</em>: By default, the pipeline uses a
wavelength-dependent spatial map for extraction, but this
method may give poor results, if the signal-to-noise
in the profile is low. Set this option to use the median spatial
profile across all wavelengths instead.</p></li>
<li><p><em>Use spatial profile to fix bad pixels</em>: The pipeline usually
uses the spatial profile to attempt to fix bad pixels during
standard extraction, and in the 2D image for either extraction
method. Occasionally, this results in a failed extraction.
Unset this options to extract the spectra without bad pixel correction.</p></li>
<li><p><em>Bad pixel threshold</em>: Enter a value for the threshold for a pixel
to be considered a bad pixel. This value is multiplied by the
standard deviation of all good pixels in the aperture at each
wavelength bin.</p></li>
</ul>
</li>
<li><p><strong>Merge Apertures</strong></p>
<ul>
<li><p><em>Save uncalibrated 1D spectra</em>: If set, the merged spectra will
be saved to disk in Spextool format.  This option is normally used only
for diagnostic purposes.</p></li>
<li><p><em>Combination method</em>: Mean is the default; median may also be useful
for some input data.</p></li>
<li><p><em>Use weighted mean</em>: If set, the average of the data will be
weighted by the variance. Ignored for method=median.</p></li>
</ul>
</li>
<li><p><strong>Flux Calibrate</strong></p>
<ul>
<li><p>General Parameters</p>
<ul>
<li><p><em>Save calibrated 1D spectra</em>: If set, the calibrated spectra will
be saved to disk in Spextool format.  This option is normally used only
for diagnostic purposes.</p></li>
<li><p><em>Skip flux calibration</em>: If set, no telluric correction or flux
calibration will be applied.</p></li>
<li><p><em>Response file</em>: The default instrumental response file on disk
is automatically loaded. If blank, no response correction will
be applied, but transmission correction will still occur. Set to a
valid FITS file path to override the default response file with a
new one.</p></li>
<li><p><em>Spectral resolution</em>: Expected resolution for the grism mode, used
to smooth the ATRAN model.  This value should match that of the
response file, and should only need modification if the response
file is modified from the default.</p></li>
</ul>
</li>
<li><p>Telluric Correction Parameters</p>
<ul>
<li><p><em>Optimize ATRAN correction</em>: If set, the pipeline will use a
library of ATRAN files to attempt to automatically select the best
telluric correction. This option requires that the external
library location be identified in the <em>ATRAN directory</em> parameter. The
procedure may take some time to complete, and may not complete
successfully for faint spectra, or spectra with significant
emission features. Optimization will not be attempted for the
FOR_G111 grism, or for spectra with mean S/N less than the specified
threshold.</p></li>
<li><p><em>ATRAN directory</em>: This parameter specifies the location of the
library of ATRAN FITS files to use.  If blank, the default files
provided with the pipeline will be used.  If optimization is desired,
this library must contain files parameterized by PWV.</p></li>
<li><p><em>ATRAN file</em>: This parameter is used to override the ATRAN file
to use for telluric correction. If blank, the default ATRAN
file on disk will be used. Set to a valid FITS file path to override the
default ATRAN file with a new one.</p></li>
<li><p><em>Use WV values</em>: If set, and optimize is not set, water vapor values
from the header (WVZ_OBS) will be used to choose the correct
ATRAN file.</p></li>
<li><p><em>S/N threshold for optimization</em>: If the median S/N for a spectrum
is below this threshold, optimization will not be attempted.  Automatic
wavelength shifts will also not be attempted.</p></li>
</ul>
</li>
<li><p>Wavelength Shift Parameters</p>
<ul>
<li><p><em>Auto shift wavelength to telluric spectrum</em>: If set, the data will be
shifted to match the telluric spectrum.  The optimum shift chosen
is the one that minimizes residuals in the corrected spectrum,
when fit with a low order polynomial. All values within the range
of the maximum shift are tested, at a resolution of 0.1 pixels.
Auto shift will not be attempted for the FOR_G111 grism.</p></li>
<li><p><em>Maximum auto wavelength shift to apply</em>: The maximum shift allowable
for auto-shifts, in pixels.</p></li>
<li><p><em>Wavelength shift to apply</em>: Set to specify a manual shift in pixels
along the wavelength axis to apply to the science spectrum. If
non-zero, the auto-shift parameter will be ignored.</p></li>
<li><p><em>Polynomial order for continuum</em>: The fit order for the spectrum,
used to determine the optimum wavelength shift.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Combine Spectra</strong></p>
<ul>
<li><p>General Parameters</p>
<ul>
<li><p><em>Registration method</em>: If set to ‘Use WCS as is’, all
images will be referenced to the sky position in the first image
file. If set to ‘Correct to target position’, the
TGTRA/TGTDEC keywords in the FITS header will be used to apply
an additional offset for registering non-sidereal targets.  If
these keywords are not present, or if their value is constant,
the algorithm defaults to the ‘Use WCS as is’ behavior.
‘Correct to target position’ is on by default; the other options
are recommended only if the TGTRA/TGTDEC or WCS keywords are known to
have bad values. In that case, set to ‘Use header offsets’ for
non-sidereal targets or files with known bad WCS parameters;
otherwise use ‘Use WCS as is’.</p></li>
<li><p><em>Combination method</em>: Mean is the default for all data not marked
SLITSCAN; median may also be useful for some input data.  For
SLITSCAN, the default is ‘spectral cube’.  If this option is set,
the input data will be resampled into a 3D spatial/spectral cube
instead of coadding 1D spectra and 2D images.</p></li>
<li><p><em>Weight by errors</em>: If set, the average of the data will be
weighted by the errors. Ignored for method=median.</p></li>
</ul>
</li>
<li><p>1-2D Combination Parameters</p>
<ul>
<li><p><em>Robust combination</em>: If set, data will be sigma-clipped before
combination for mean or median methods.</p></li>
<li><p><em>Outlier rejection threshold (sigma)</em>: The sigma-clipping threshold
for robust combination methods, in units of sigma (standard deviation).</p></li>
</ul>
</li>
<li><p>3D Resample Parameters</p>
<ul>
<li><p><em>Spatial surface fit order</em>: This parameter controls the polynomial
order of the surface fit to the data at each grid point. Higher
orders give more fine-scale detail, but are more likely to be
unstable. Set to zero to do a weighted mean of the nearby data.</p></li>
<li><p><em>Spatial fit window</em>: Spatial window (pixels) for consideration in local
data fits.  Set higher to fit to more pixels.</p></li>
<li><p><em>Spatial smoothing radius</em>: Gaussian width (pixels) for smoothing radius in
distance weights for local data fits.  Set higher to smooth over
more pixels.</p></li>
<li><p><em>Spatial edge threshold</em>: A value between 0 and 1 that determines how
much of the image edge is set to NaN.  Set higher to set more pixels
to NaN.</p></li>
<li><p><em>Adaptive smoothing algorithm</em>: If ‘scaled’, the size of the smoothing
kernel is allowed to vary, in order to optimize reconstruction of
sharply peaked sources. If ‘shaped’, the kernel shape and rotation
may also vary. If ‘none’, the kernel will not vary.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Make Spectral Map</strong></p>
<ul>
<li><p><em>Color map</em>: Color map for the output PNG image.  Any valid Matplotlib
name may be specified.</p></li>
<li><p><em>Flux scale for image</em>: A low and high percentile value , used for
scaling the spectral image, e.g. [0,99].</p></li>
<li><p><em>Number of contours</em>: Number of contour levels to be over-plotted on
the image.  Set to 0 to turn off contours.</p></li>
<li><p><em>Contour color</em>: Color for the contour lines.  Any valid Matplotlib
color name may be specified.</p></li>
<li><p><em>Filled contours</em>: If set, contours will be filled instead of overlaid.</p></li>
<li><p><em>Overlay grid</em>: If set, a coordinate grid will be overlaid.</p></li>
<li><p><em>Watermark text</em>: If set to a non-empty string, the text will be
added to the lower-right of the image as a semi-transparent watermark.</p></li>
<li><p><em>Fraction of outer wavelengths to ignore</em>:  Used to block edge effects
for noisy spectral orders. Set to 0 to include all wavelengths in
the plot.</p></li>
<li><p><em>Overplot transmission</em>: If set, the atmospheric transmission spectrum
will be displayed in the spectral plot.</p></li>
<li><p><em>Flux scale for spectral plot</em>: Specify a low and high percentile value
for the spectral flux scale, e.g. [0,99].  If set to [0, 100],
Matplotlib defaults are used.</p></li>
<li><p><em>Override wavelength slice for spectral cube</em>: Manually specify the
wavelength slice (zero-indexed) for the image.  Otherwise, the
peak voxel in the cube is used to identify the spectral slice.</p></li>
<li><p><em>Override spatial point for spectral cube</em>: Manually specify the
spatial index for the spectrum, as ‘x,y’, zero-indexed.  Otherwise, the
peak voxel in the cube is used to identify the spatial point.</p></li>
</ul>
</li>
<li><p><strong>Make Response</strong></p>
<ul>
<li><p><em>Standard model file</em>: If blank, a model file will be searched for
in the default data directory.  Set to a valid FITS file to override.</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>
</section>
<section id="data-quality-assessment">
<h2>Data Quality Assessment<a class="headerlink" href="#data-quality-assessment" title="Link to this heading">¶</a></h2>
<p>After the pipeline has been run on a set of input data, the output
products should be checked to ensure that the data has been properly
reduced.  Data quality and quirks can vary widely across individual
observations, but the following general guideline gives some strategies
for approaching quality assessment (QA) for FORCAST data.</p>
<ul class="simple">
<li><p>Check for QA comments in the FITS header HISTORY.  These comments may
make suggestions for files to exclude from final reductions, or
for non-default parameters to set for optimal reductions.</p></li>
<li><p>Check the output to the log file (usually called
<em>redux_[date]_[time].log</em>), written to the same directory as the
output files. Look for messages marked ERROR or WARNING. The log will
also list every parameter used in the pipeline steps, which may help
disambiguate the parameters as actually-run for the pipeline.</p></li>
<li><p>Check that the expected files were written to disk: there should, at
a minimum, be a calibrated file (<em>CAL</em>) for imaging data and a combined
spectrum (<em>CMB</em>) for grism data. Check the data product
tables (<a class="reference internal" href="#img-data-prod"><span class="std std-numref">Table 15</span></a> and <a class="reference internal" href="#spec-data-prod"><span class="std std-numref">Table 16</span></a>)
for other expected data products for each mode.</p></li>
<li><p>For imaging:</p>
<ul>
<li><p>If shifting-and-adding was performed at the merge step, display
all undistorted (<em>UND</em>) and merged (<em>MRG</em>) files. Check that the
pattern of positive and negative sources looks right for the
observation mode. Also check that the FWHM of the source is not
worse in the merged files than it was in the undistorted files. If
the pattern does not look right, or the FWHM is too large, the
merge may have failed.</p></li>
<li><p>Display all registered and telluric-corrected (<em>TEL</em>) files at
once and check that any visible sources appear at the same WCS
coordinates in all files.</p></li>
<li><p>Display the final coadded (<em>COA</em>) or calibrated (<em>CAL</em>) file and check
that the FWHM is not worse than it is in the registered files,
which might indicate poor registration. Check for any unusual
artifacts, such as variable background regions, or detector
pattern noise.</p></li>
<li><p>Compare the calculated reference calibration factors for all flux
standards to the last known series average. Major deviations may
indicate that the photometry failed for that observation.</p></li>
</ul>
</li>
<li><p>For grism:</p>
<ul>
<li><p>Display the spatial profile with apertures overlaid. Verify that
apertures look well placed and the spatial profile does not dip
below zero (except for negative spectral traces).</p></li>
<li><p>Display the rectified image, and overlay the locations of the
extracted apertures. Verify that the apertures lie on top of any
visible spectral traces.</p></li>
<li><p>Display the final spectrum (<em>CMB</em>) and overplot the expected atmospheric
transmission. Check that the calibrated spectrum does not include
residual artifacts from the telluric absorption features. If it
does, the assumed resolution for the grism, or the wavelength
calibration of the observation, may need updating.</p></li>
<li><p>Overlay a model spectrum on the calibrated spectra of flux
standards. Verify that the observed spectrum matches the
theoretical spectrum, within the error bars of the observation. If
it does not, the instrumental response file may need updating.</p></li>
</ul>
</li>
</ul>
</section>
<section id="appendix-a-sample-configuration-files">
<h2>Appendix A: Sample configuration files<a class="headerlink" href="#appendix-a-sample-configuration-files" title="Link to this heading">¶</a></h2>
<p>Below are sample FORCAST Redux parameter override files in INI format.
If present, the parameter value overrides the
default defined by the FORCAST reduction object. If not present, the
default value will be used.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Redux parameters for FORCAST instrument in Imaging mode
# Pipeline: FORCAST_REDUX v2_3_0
[1: checkhead]
    abort = True
[2: clean]
    save = False
    badfile = lwc_badpix_OC7D.fits
    autoshift = True
    shiftfile = &quot;&quot;
    interpolate = False
[3: droop]
    save = False
    fracdroop = 0.0035
[4: nonlin]
    save = False
    secctr = &quot;128,128&quot;
    secsize = &quot;190,190&quot;
[5: stack]
    save = False
    add_frames = False
    jbclean = True
    bgscale = False
    bgsub = True
    secctr = &quot;128,128&quot;
    secsize = &quot;190,190&quot;
    bgstat = median
[6: undistort]
    save = True
    pinfile = pinhole_locs_LWC_20190629.txt
    transform_type = polynomial
    extrapolate = True
[7: merge]
    save = True
    cormerge = Centroid
[8: register]
    save = False
    corcoadd = Use WCS as is
    offsets = &quot;&quot;
    mfwhm = 4.5
    xyshift = 40.0
[9: tellcor]
    save = True
[10: coadd]
    save = True
    skip_coadd = False
    reference = Target position
    method = median
    weighted = True
    robust = True
    threshold = 8.0
    maxiters = 5
    smoothing = 1.0
[11: fluxcal]
    save = True
    rerun_phot = False
    srcpos = &quot;&quot;
    fitsize = 138
    fwhm = 5.0
    profile = Moffat
[12: imgmap]
    colormap = plasma
    scale = 0.25, 99.9
    n_contour = 0
    contour_color = gray
    fill_contours = False
    grid = False
    beam = True
    watermark = &quot;&quot;
    crop_border = True
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Redux parameters for FORCAST instrument in Spectroscopy mode
# Pipeline: FORCAST_REDUX v2_3_0
[1: checkhead]
    abort = True
[2: clean]
    save = False
    badfile = swc_badpix_OC2.fits
    autoshift = True
    shiftfile = &quot;&quot;
    interpolate = False
[3: droop]
    save = False
    fracdroop = 0.0035
[4: nonlin]
    save = False
    secctr = &quot;128,128&quot;
    secsize = &quot;190,190&quot;
[5: stack]
    save = True
    add_frames = False
    jbclean = True
    bgscale = False
    bgsub = False
    secctr = &quot;128,128&quot;
    secsize = &quot;190,190&quot;
    bgstat = median
[6: stack_dithers]
    save = True
    skip_stack = True
    ignore_dither = False
    method = mean
    weighted = True
    robust = True
    threshold = 8.0
    maxiters = 5
[7: make_profiles]
    save = True
    wavefile = G063_wavecal_OC2.fits
    slitfile = G063_LS24_slitfn_OC2.fits
    fit_order = 3
    bg_sub = True
    atmosthresh = 0.0
    simwavecal = False
[8: locate_apertures]
    save = False
    method = auto
    num_aps = 1
    input_position = &quot;&quot;
    fwhm = 3.0
[9: trace_continuum]
    save = False
    method = fit to continuum
    fit_order = 2
[10: set_apertures]
    save = False
    full_slit = False
    refit = True
    apsign = &quot;&quot;
    aprad = &quot;&quot;
    psfrad = &quot;&quot;
    bgr = &quot;&quot;
[11: subtract_background]
    save = False
    skip_bg = False
    bg_fit_order = 0
[12: extract_spectra]
    save = False
    save_1d = False
    method = optimal
    use_profile = False
    fix_bad = True
    threshold = 10.0
[13: merge_apertures]
    save = True
    save_1d = False
    method = mean
    weighted = True
[14: flux_calibrate]
    save = True
    save_1d = False
    skip_cal = False
    respfile = G063_LS24_DB175_response.fits
    resolution = 180.0
    optimize_atran = True
    atrandir = $DPS_SHARE/calibrations/ATRAN/fits
    atranfile = &quot;&quot;
    sn_threshold = 10.0
    auto_shift = True
    auto_shift_limit = 2.0
    waveshift = 0.0
    model_order = 1
[15: combine_spectra]
    save = True
    registration = Correct to target position
    method = mean
    weighted = True
    robust = True
    threshold = 8.0
    maxiters = 5
    fit_order = 2
    fit_window = 7.0
    smoothing = 2.0
    edge_threshold = 0.7
    adaptive_algorithm = none
[16: specmap]
    colormap = plasma
    scale = 0.25, 99.9
    n_contour = 0
    contour_color = gray
    fill_contours = False
    grid = False
    watermark = &quot;&quot;
    ignore_outer = 0.0
    atran_plot = True
    spec_scale = 0, 100
    override_slice = &quot;&quot;
    override_point = &quot;&quot;
</pre></div>
</div>
</section>
<section id="appendix-b-required-input-keywords">
<h2>Appendix B: Required input keywords<a class="headerlink" href="#appendix-b-required-input-keywords" title="Link to this heading">¶</a></h2>
<p>This table describes the type and expected value for all FITS keywords
used by the FORCAST pipeline.</p>
<table class="longtable docutils align-default" id="id57">
<caption><span class="caption-number">Table 24 </span><span class="caption-text">Required input keywords</span><a class="headerlink" href="#id57" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 15.0%" />
<col style="width: 15.0%" />
<col style="width: 70.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Keyword</strong></p></td>
<td><p><strong>Type</strong></p></td>
<td><p><strong>Expected value</strong></p></td>
</tr>
<tr class="row-even"><td><p>ALTI_STA</p></td>
<td><p>float</p></td>
<td><p>0-60000.</p></td>
</tr>
<tr class="row-odd"><td><p>ALTI_END</p></td>
<td><p>float</p></td>
<td><p>0-60000.</p></td>
</tr>
<tr class="row-even"><td><p>AOR_ID</p></td>
<td><p>string</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>DATASRC</p></td>
<td><p>string</p></td>
<td><p>ASTRO, CALIBRATION, LAB, TEST, OTHER, FIRSTPOINT</p></td>
</tr>
<tr class="row-even"><td><p>DATE-OBS</p></td>
<td><p>string</p></td>
<td><p>yyyy-mm-ddThh:mm:ss[.sss]</p></td>
</tr>
<tr class="row-odd"><td><p>DETCHAN</p></td>
<td><p>string</p></td>
<td><p>SW, LW</p></td>
</tr>
<tr class="row-even"><td><p>DETECTOR</p></td>
<td><p>string</p></td>
<td><p>As-010, Sb-083</p></td>
</tr>
<tr class="row-odd"><td><p>DETITIME</p></td>
<td><p>float</p></td>
<td><p>&gt; 0</p></td>
</tr>
<tr class="row-even"><td><p>EPERADU</p></td>
<td><p>float</p></td>
<td><p>&gt; 1</p></td>
</tr>
<tr class="row-odd"><td><p>FRMRATE</p></td>
<td><p>float</p></td>
<td><p>&gt; 0</p></td>
</tr>
<tr class="row-even"><td><p>ILOWCAP</p></td>
<td><p>bool</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>INSTCFG</p></td>
<td><p>string</p></td>
<td><p>IMAGING_SWC, IMAGING_LWC, IMAGING_DUAL, GRISM_XD,
GRISM_SWC, GRISM_LWC, GRISM_DUAL, GRISM_XD-LSV,
GRISM-SSV, GRISM-LSV</p></td>
</tr>
<tr class="row-even"><td><p>INSTMODE</p></td>
<td><p>string</p></td>
<td><p>C2, C2N, C2NC2, N, SLITSCAN, NXCAC</p></td>
</tr>
<tr class="row-odd"><td><p>INSTRUME</p></td>
<td><p>string</p></td>
<td><p>FORCAST</p></td>
</tr>
<tr class="row-even"><td><p>INTTIME</p></td>
<td><p>float</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>MISSN_ID</p></td>
<td><p>string</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>NAXIS1</p></td>
<td><p>int</p></td>
<td><p>256</p></td>
</tr>
<tr class="row-odd"><td><p>NAXIS2</p></td>
<td><p>int</p></td>
<td><p>256</p></td>
</tr>
<tr class="row-even"><td><p>OBJECT</p></td>
<td><p>string</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>OBS_ID</p></td>
<td><p>string</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>OBSTYPE</p></td>
<td><p>string</p></td>
<td><p>OBJECT, STANDARD_FLUX, STANDARD_TELLURIC, LAMP,
FLAT, DARK, BIAS, SKY, BB, GASCELL, LASER, FOCUS_LOOP</p></td>
</tr>
<tr class="row-odd"><td><p>OTMODE</p></td>
<td><p>string</p></td>
<td><p>AD, SUR</p></td>
</tr>
<tr class="row-even"><td><p>OTSTACKS</p></td>
<td><p>int</p></td>
<td><p>&gt;0</p></td>
</tr>
<tr class="row-odd"><td><p>SPECTEL1</p></td>
<td><p>string</p></td>
<td><p>NONE, FOR_F054, FOR_F064, FOR_F066, FOR_F077,
FOR_F111, FOR_F113, FOR_F197, FOR_F253,
FOR_XG063, FOR_XG111, FOR_G063, FOR_G111</p></td>
</tr>
<tr class="row-even"><td><p>SPECTEL2</p></td>
<td><p>string</p></td>
<td><p>NONE, FOR_F086, FOR_F113, FOR_F118, FOR_F254,
FOR_F315, FOR_F336, FOR_F348, FOR_F371, FOR_F242,
FOR_G227, FOR_G329</p></td>
</tr>
<tr class="row-odd"><td><p>TELESCOP</p></td>
<td><p>string</p></td>
<td><p>SOFIA</p></td>
</tr>
<tr class="row-even"><td><p>TIME-OBS</p></td>
<td><p>string</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>UTCSTART</p></td>
<td><p>string</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>WAVELNTH</p></td>
<td><p>float</p></td>
<td><p>0-40.</p></td>
</tr>
<tr class="row-odd"><td><p>ZA_START</p></td>
<td><p>float</p></td>
<td><p>0-90.</p></td>
</tr>
<tr class="row-even"><td><p>ZA_END</p></td>
<td><p>float</p></td>
<td><p>0-90.</p></td>
</tr>
<tr class="row-odd"><td><p>DITHER</p></td>
<td><p>bool</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>DTHCRSYS</p></td>
<td><p>string</p></td>
<td><p>SIRF, ERF</p></td>
</tr>
<tr class="row-odd"><td><p>DTHINDEX</p></td>
<td><p>int</p></td>
<td><p>&gt; 0</p></td>
</tr>
<tr class="row-even"><td><p>DITHERX</p></td>
<td><p>float</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>DITHERY</p></td>
<td><p>float</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>CHOPPING</p></td>
<td><p>bool</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>CHPCRSYS</p></td>
<td><p>string</p></td>
<td><p>SIRF, ERF</p></td>
</tr>
<tr class="row-even"><td><p>CHPAMP1</p></td>
<td><p>float</p></td>
<td><p><span class="math notranslate nohighlight">\(geq\)</span> 0</p></td>
</tr>
<tr class="row-odd"><td><p>CHPANGLR</p></td>
<td><p>float</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>CHPANGLE</p></td>
<td><p>float</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>CHPNPOS</p></td>
<td><p>int</p></td>
<td><p>&gt; 0</p></td>
</tr>
<tr class="row-even"><td><p>NODDING</p></td>
<td><p>bool</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>NODCRSYS</p></td>
<td><p>string</p></td>
<td><p>SIRF, ERF</p></td>
</tr>
<tr class="row-even"><td><p>NODAMP</p></td>
<td><p>float</p></td>
<td><p><span class="math notranslate nohighlight">\(geq\)</span> 0</p></td>
</tr>
<tr class="row-odd"><td><p>NODANGLR</p></td>
<td><p>float</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>NODANGLE</p></td>
<td><p>float</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>NODBEAM</p></td>
<td><p>string</p></td>
<td><p>A, B</p></td>
</tr>
<tr class="row-even"><td><p>SKY_ANGL</p></td>
<td><p>float</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>SKYMODE</p></td>
<td><p>string</p></td>
<td><p>C2NC2, NMC, NPC, NPCNAS, NPCCAS, SLITSCAN, NOD, NXCAC</p></td>
</tr>
<tr class="row-even"><td><p>SRCTYPE</p></td>
<td><p>string</p></td>
<td><p>POINT_SOURCE, EXTENDED_SOURCE, OTHER, UNKNOWN</p></td>
</tr>
<tr class="row-odd"><td><p>SLIT</p></td>
<td><p>string</p></td>
<td><p>FOR_SS24, FOR_LS24, FOR_LS47, NONE</p></td>
</tr>
</tbody>
</table>
</section>
<section id="appendix-c-calibration-data-generation">
<h2>Appendix C: Calibration Data Generation<a class="headerlink" href="#appendix-c-calibration-data-generation" title="Link to this heading">¶</a></h2>
<p>The FORCAST Redux pipeline requires several kinds of auxiliary reference
calibration files, listed in <a class="reference internal" href="#auxiliary"><span class="std std-numref">Table 22</span></a>.  Some of these are produced
by tools packaged with the pipeline.  This section describes the procedures
used to produce these auxiliary files.</p>
<section id="instrumental-response-curve">
<h3>Instrumental Response Curve<a class="headerlink" href="#instrumental-response-curve" title="Link to this heading">¶</a></h3>
<p>As described above, instrumental response
curves are automatically produced for each spectrum with
OBSTYPE = STANDARD_TELLURIC.  For use in calibrating science spectra,
response curves from multiple observations must be combined together.</p>
<p>For appropriate combination, input response curves must share the same
grism, slit, and detector bias setting.</p>
<p>Matching response curves may be scaled, to account for variations in slit
loss or model accuracy, then are generally combined together with a robust
weighted mean statistic.  The combined curve is smoothed with a Gaussian
of width 2 pixels, to reduce artificial artifacts.  Averaged response curves
for each grism and slit combination are usually produced for each
flight series, and stored for pipeline use in the standard location for
the instrument package (<em>data/grism/response</em>).</p>
<p>The scaling, combination, and smoothing of instrument response curves is
implemented as a final step in the pipeline for grism standards.
After individual <em>response_spectrum</em> files (*RSP*.fits) are grouped
appropriately, the final step in the pipeline can be run on each group to
produce the average <em>instrument_response</em> file (*IRS*.fits).</p>
<section id="id11">
<h4>Useful Parameters<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h4>
<p>Below are some useful parameters for combining response spectra.</p>
<ul>
<li><p><strong>Combine Response</strong></p>
<blockquote>
<div><ul>
<li><p>Scaling Parameters</p>
<blockquote>
<div><ul class="simple">
<li><p><em>Scaling method</em>: If ‘median’, all spectra are scaled to the median
of the flux stack.  If ‘highest’, all spectra are scaled to the
spectrum with the highest median value.  If ‘lowest’, all spectra
are scaled to the spectrum with the lowest median value.  If
‘index’, all spectra are scaled to the spectrum indicated in the
<em>Index</em> parameter, below.  If ‘none’, no scaling is applied before
combination.</p></li>
<li><p><em>Index of spectrum to scale to</em>: If <em>Scaling method</em> is ‘index’, set
this value to the index of the spectrum to scale.  Indices start
at zero and refer to the position in the input file list.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Combination Parameters</p>
<blockquote>
<div><ul class="simple">
<li><p><em>Combine apertures</em>: For multi-aperture data, it may be useful
to produce a separate response curve for each aperture.  Select
this option to combine them into a single reponse curve instead.</p></li>
<li><p><em>Combination method</em>: Mean is default; median may also be useful
for some input data.</p></li>
<li><p><em>Weight by errors</em>: If set, the average of the data will be
weighted by the variance. Ignored for method=median.</p></li>
<li><p><em>Robust combination</em>: If set, data will be sigma-clipped before
combination for mean or median methods.</p></li>
<li><p><em>Outlier rejection threshold (sigma)</em>: The sigma-clipping threshold
for robust combination methods, in units of sigma (standard deviation).</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Smoothing Parameters</p>
<ul class="simple">
<li><p><em>Smoothing Gaussian FWHM</em>: Full-width-half-max for the Gaussian
kernel used for smoothing the final response spectrum, specified
in pixels.</p></li>
</ul>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
</section>
<section id="wavelength-calibration-map">
<h3>Wavelength Calibration Map<a class="headerlink" href="#wavelength-calibration-map" title="Link to this heading">¶</a></h3>
<section id="calibration-principles">
<h4>Calibration Principles<a class="headerlink" href="#calibration-principles" title="Link to this heading">¶</a></h4>
<p>Grism wavelength and spatial calibrations are stored together in a
single image extension in a FITS file, where the first plane is the wavelength
calibration and the second is the spatial calibration.  The images should match
the dimensions of the raw data arrays, assigning a wavelength value in um
and a slit position in arcsec to every raw pixel.</p>
<p>These calibration files are generally derived from specialized calibration
data.  Wavelength calibration is best derived from images for which strong
emission or absorption lines fill the whole image, from top to bottom, and
evenly spaced from left to right.  Sky data may be used for this purpose
for some of the grism passbands; lab data may be more appropriate for others.
Raw data should be cleaned and averaged or summed to produce an image with as
high a signal-to-noise ratio in the spectroscopic lines as possible.</p>
<p>After preprocessing, the spectroscopic lines must be identified with specific
wavelengths from a priori knowledge, then they must be re-identified with a
centroiding algorithm at as many places across the array as possible.  The
identified positions can then be fit with a smooth 2D surface, which provides
the wavelength value in microns at any pixel, accounting for any optical
distortions as needed.</p>
<p>In principle, the spatial calibration proceeds similarly.  Spatial
calibrations are best derived from identifiable spectral continuua that
fill the whole array from left to right, evenly spaced from top to bottom.
Most commonly, special observations of a spectroscopic standard are taken,
placing the source at multiple locations in the slit.  These spectroscopic
traces are identified then re-fit across the array.  The identified positions
are again fit with a smooth 2D surface to provide the spatial position in
arcseconds up the slit at any pixel.  This calibration can then be used to
correct for spatial distortions, in the same way that the wavelength
calibration is used to rectify distortions along the wavelength axis.</p>
</section>
<section id="pipeline-interface">
<h4>Pipeline Interface<a class="headerlink" href="#pipeline-interface" title="Link to this heading">¶</a></h4>
<p>The input data for calibration tasks is generally raw FITS
files, containing spectroscopic data.  In order to perform calibration steps
instead of the standard spectroscopic pipeline, the pipeline interface
requires a user-provided flag, either in an input configuration file, or
on the command line, as for example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux_pipe -c wavecal=True /path/to/fits/files
</pre></div>
</div>
<p>for a wavelength calibration reduction or:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux_pipe -c spatcal=True /path/to/fits/files
</pre></div>
</div>
<p>for a spatial calibration reduction.</p>
<p>The first steps in either reduction mode are the same pre-processing steps
used in the standard pipeline reduction.
The stacking steps have optional parameters that allow for
the input data to be summed instead of subtracted (for calibration from
sky lines), or to be summed instead of averaged (for combining multiple
spectral traces into a single image).</p>
<p>Thereafter, the <em>wavecal</em> reduction performs the following steps.  Each step
has a number of tunable parameters; see below for parameter descriptions.</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Make Profiles</strong>: a spatial profile is generated from the
unrectified input image.</p></li>
<li><p><strong>Extract First Spectrum</strong>: an initial spectrum is extracted from
a single aperture, via a simple sum over a specified number of rows.</p></li>
<li><p><strong>Identify Lines</strong>: spectrosopic lines specified in an input list are
identified in the extracted spectrum, via Gaussian fits near guess
positions derived from user input or previous wavelength calibrations.</p></li>
<li><p><strong>Reidentify Lines</strong>: new spectra are extracted from the image at
locations across the array, and lines successfully identified in the
initial spectrum are attempted to be re-identified in each new spectrum.</p></li>
<li><p><strong>Fit Lines</strong>: all input line positions and their assumed wavelength
values are fit with a low-order polynomial surface.  The fit surface
is saved to disk as the wavelength calibration file.</p></li>
<li><p><strong>Verify Rectification</strong>: the derived wavelength calibration is applied
to the input image, to verify that correctly rectifies the spectral
image.</p></li>
</ul>
</div></blockquote>
<p>After preprocessing, the <em>spatcal</em> reduction performs similar steps:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Make Profiles</strong>: a spatial profile is generated from the
unrectified input image.</p></li>
<li><p><strong>Locate Apertures</strong>: spectral apertures are identified from the spatial
profile, either manually or automatically.</p></li>
<li><p><strong>Trace Continuum</strong>: spectrosopic continuuum positions are fit in
steps across the array, for each identified aperture.</p></li>
<li><p><strong>Fit Traces</strong>: all aperture trace positions are fit with a low-order
polynomial surface.  The fit surface is saved to disk as the spatial
calibration file.</p></li>
<li><p><strong>Verify Rectification</strong>: the derived spatial calibration is applied
to the input image, to verify that correctly rectifies the spectral
image.</p></li>
</ul>
</div></blockquote>
<p>Intermediate data can also be saved after any of these steps, and can be
later loaded and used as a starting point for subsequent steps, just as in
the standard spectroscopic pipeline.  Parameter settings can also be saved
in a configuration file, for later re-use or batch processing.</p>
<p>Wavelength and spatial calibrations generally require different pre-processing
steps, or different input data altogether, so they cannot be generated at the
same time.  The pipeline interface will allow a previously generated wavelength
or spatial calibration file to be combined together with the new one in the
final input.  Optional previous spatial calibration input is provided to the
<em>wavecal</em> process in the <strong>Fit Lines</strong> step; optional previous wavelength
calibration input is provided to the  <em>spatcal</em> process in the <strong>Fit Traces</strong>
step.  If a previously generated file is not provided, the output file will
contain simulated data in the spatial or wavelength plane, as appropriate.</p>
</section>
<section id="reference-data">
<h4>Reference Data<a class="headerlink" href="#reference-data" title="Link to this heading">¶</a></h4>
<p>Line lists for wavelength calibration are stored in the standard reference
data directory for the instrument package
(<em>data/grism/line_lists</em>).  In these lists,
commented lines (beginning with ‘#’) are used for display only; uncommented
lines are attempted to be fit.  Initial guesses for the pixel position of
the line may be taken from a previous wavelength calibration, or from a
low-order fit to wavelength/position pairs input by the user.  Default
wavelength calibration files and line lists may be set by date, in the usual
way (see <em>data/grism/caldefault.txt</em>).</p>
<p>Spatial calibration uses only the assumed slit height in pixels and arcsec
as input data, as stored in the reference files in
<em>data/grism/order_mask</em>.  These values are not expected to change over time.</p>
</section>
<section id="display-tools">
<h4>Display Tools<a class="headerlink" href="#display-tools" title="Link to this heading">¶</a></h4>
<p>The pipeline incorporates several display tools for diagnostic purposes.
In addition to the DS9 display of the input and intermediate FITS files,
spatial profiles and extracted spectra are displayed in separate windows,
as in the standard spectroscopic pipeline. Identified lines for <em>wavecal</em>
are marked in the spectral display window (<a class="reference internal" href="#forcast-wavecal-plots"><span class="std std-numref">Fig. 96</span></a>);
identified apertures for <em>spatcal</em> are marked in the spatial profile window
(<a class="reference internal" href="#forcast-spatcal-plots"><span class="std std-numref">Fig. 97</span></a>).  Fit positions
and lines of constant wavelength or spatial position are displayed as
DS9 regions.  These region files are
also saved to disk, for later analysis.  Finally, after the line or trace
positions have been fit, a plot of the residuals, against X and Y position
is displayed in a separate window (<a class="reference internal" href="#forcast-wavecal-residuals"><span class="std std-numref">Fig. 98</span></a>
and <a class="reference internal" href="#forcast-spatcal-residuals"><span class="std std-numref">Fig. 99</span></a>). This plot is also saved to disk,
as a PNG file.</p>
</section>
<section id="id12">
<h4>Useful Parameters<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h4>
<p>Some key parameters used specifically for the calibration modes are listed
below.  See above for descriptions of parameters for the steps shared with
the standard pipeline.</p>
<section id="wavecal-mode">
<h5>Wavecal Mode<a class="headerlink" href="#wavecal-mode" title="Link to this heading">¶</a></h5>
<ul>
<li><p><strong>Stack Dithers</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><em>Ignore dither information from header</em>: This option allows all
input dithers to be combined together, regardless of the dither
information in the header.  This option may be useful in generating
a high signal-to-noise image for wavelength identification.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Extract First Spectrum</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><em>Save extracted 1D spectra</em>: If set, a 1D spectrum is saved to disk
in Spextool format.  This may be useful for identifying line locations
in external interactive tools like xvspec (in the IDL Spextool package).</p></li>
<li><p><em>Aperture location method</em>: If ‘auto’, the most significant peak
in the spatial profile is selected as the initial spectrum region,
and the aperture radius is determined from the FWHM of the peak.
If ‘fix to center’, the center pixel of the slit is used as the
aperture location.  If ‘fix to input’, the value specified as the
aperture position is used as the aperture location.</p></li>
<li><p><em>Polynomial order for spectrum detrend</em>: If set to an integer 0
or higher, the extracted spectrum will be fit with a low order
polynomial, and this fit will be subtracted from the spectrum.  This
option may be useful to flatten a spectrum with a a strong trend,
which can otherwise interfere with line fits.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Identify Lines</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><em>Wave/space calibration file</em>: A previously generated wavelength
calibration file, to use for generating initial guesses of line
positions.  If a significant shift is expected from the last wavelength
calibration, the ‘Guess’ parameters below should be used instead.</p></li>
<li><p><em>Line list</em>: List of wavelengths to fit in the extracted spectrum.
Wavelengths should be listed, one per line, in microns.  If commented
out with a ‘#’, the line will be displayed in the spectrum as a dotted
line, but a fit to it will not be attempted.</p></li>
<li><p><em>Line type</em>: If ‘absorption’, only concave lines will be expected.  If
‘emission’, only convex lines are expected.  If ‘either’, concave and
convex lines may be fit.  Fit results for faint lines are generally
better if either ‘absorption’ or ‘emission’ can be specified.</p></li>
<li><p><em>Fit window</em>: Window (in pixels) around the guess position used as the
fitting data.  Smaller windows may result in more robust fits for faint
lines, if the guess positions are sufficiently accurate.</p></li>
<li><p><em>Expected line width (pixel)</em>: FWHM expected for the fit lines.</p></li>
<li><p><em>Guess wavelengths</em>: Comma-separated list of wavelengths for known
lines in the extracted spectrum.  If specified, must match the list
provided for <em>Guess wavelength position</em>, and the <em>Wave/space calibration
file</em> will be ignored.  If two values are provided, they will be fit with
a first-order polynomial to provide wavelength position guesses for
fitting. Three or more values will be fit with a second-order polynomial.</p></li>
<li><p><em>Guess wavelength position</em>: Comma-separated list of pixel positions for
known lines in the image.  Must match the provided <em>Guess wavelengths</em>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Reidentify Lines</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><em>Save extracted 1D spectra</em>: If set, all extracted spectra are saved to
disk in Spextool format, for more detailed inspection and analysis.</p></li>
<li><p><em>Aperture location method</em>: If ‘step up slit’, apertures will be placed
at regular intervals up the slit, with step size specified in <em>Step size</em>
and radius specified in <em>Aperture radius</em>.  If ‘fix to input’, then
apertures will be at the locations specified by <em>Aperture position</em>
and radius specified in <em>Aperture radius</em>.  If ‘auto’, apertures will
be automatically determined from the spatial profile.</p></li>
<li><p><em>Number of auto apertures</em>: If <em>Aperture location method</em> is ‘auto’,
this many apertures will be automatically located.</p></li>
<li><p><em>Aperture position</em>: Comma-separated list of aperture positions in pixels.
Apertures in multiple input files may also be specified, using
semi-colons to separate file input.
If <em>Aperture location method</em> is ‘auto’, these will be used as starting
points.  If ‘fix to input’, they will be used directly.</p></li>
<li><p><em>Aperture radius</em>: Width of the extracted aperture, in pixels.  The
radius may be larger than the step, allowing for overlapping spectra.
This may help get higher S/N for extracted spectra in sky frames.</p></li>
<li><p><em>Polynomial order for spectrum detrend</em>: As for the Extract First Spectrum
step, setting this parameter to an integer 0 or higher will detrend
it.  If detrending is used for the earlier step, it is recommended
for this one as well.</p></li>
<li><p><em>Fit window</em>: Window (in pixels) around the guess position used as the
fitting data.  The guess position used is the position in the initial
spectrum, so this window must be wide enough to allow for any curvature
in the line.</p></li>
<li><p><em>Signal-to-noise requirement</em>: Spectral S/N value in sigma, below
which a fit will not be attempted at that line position in that
extracted spectrum.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Fit Lines</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><em>Fit order for X</em>: Polynomial surface fit order in the X direction.
Orders 2-4 are recommended.</p></li>
<li><p><em>Fit order for Y</em>: Polynomial surface fit order in the Y direction.
Orders 2-4 are recommended.</p></li>
<li><p><em>Weight by line height</em>: If set, the surface fit will be weighted
by the height of the line at the fit position.  This can be useful
if there is a good mix of strong and weak lines across the array.
If there is an imbalance of strong and weak lines across the array,
this option may throw the fit off at the edges.</p></li>
<li><p><em>Spatial calibration file</em>: If provided, the spatial calibration plane
in the specified file will be combined with the wavelength fit to
produce the output calibration file (*WCL*.fits).  The default is the
wavelength calibration file from the previous series.  If not provided,
a simulated flat spatial calibration will be produced and attached to
the output calibration file.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="spatcal-mode">
<h5>Spatcal Mode<a class="headerlink" href="#spatcal-mode" title="Link to this heading">¶</a></h5>
<p>Aperture location and continuum tracing follow the standard spectroscopic
method, with the exception that units are all in pixels rather than
arcseconds.  See above for descriptions of the parameters for the
Locate Apertures and Trace Continuum steps.</p>
<p>See the <em>wavecal</em> mode descriptions, above, for useful parameters for
the Stack and Stack Dithers steps.</p>
<ul>
<li><p><strong>Fit Trace Positions</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><em>Fit order for X</em>: Polynomial surface fit order in the X direction.
Orders 2-4 are recommended.</p></li>
<li><p><em>Fit order for Y</em>: Polynomial surface fit order in the Y direction.
Orders 2-4 are recommended.</p></li>
<li><p><em>Weight by profile height</em>: If set, the surface fit will be weighted
by the height of the aperture in the spatial map at the fit position.</p></li>
<li><p><em>Wavelength calibration file</em>: If provided, the wavelength calibration
plane in the specified file will be combined with the spatial fit to
produce the output calibration file (*SCL*.fits).  The default is the
wavelength calibration file from the previous series.  If not provided,
pixel positions will be stored in the wavelength calibration plane in
the output file.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
</section>
</section>
<section id="slit-correction-image">
<h3>Slit Correction Image<a class="headerlink" href="#slit-correction-image" title="Link to this heading">¶</a></h3>
<p>The response spectra used to flux-calibrate spectroscopic
data encode variations in instrument response in the spectral dimension,
but do not account for variations in response in the spatial dimension. For
compact sources, spatial response variations have minimal impact on the
extracted 1D spectrum, but for extended targets or SLITSCAN observations, they
should be corrected for.</p>
<p>To do so, the pipeline divides out a flat field, called a slit correction
image, that contains normalized variations in response in the spatial
dimension only.</p>
<p>These slit correction images can be derived from wavelength-rectified
sky frames, as follows:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Median spectra are extracted at regular positions across the frame.</p></li>
<li><p>All spectra are divided by the spectrum nearest the center of
the slit.</p></li>
<li><p>The normalized spectra are fit with a low-order polynomial to derive
smooth average response variations across the full array.</p></li>
</ol>
</div></blockquote>
<p>The fit surface is the slit correction image.  It is stored as a single
extension FITS image, and can be provided to the standard spectroscopic
pipeline at the Make Profiles step.  These images should be regenerated
whenever the wavelength and spatial calibrations are updated, since the slit
correction image matches the rectified dimensions of the spectral data,
not the raw dimensions.</p>
<section id="id13">
<h4>Pipeline Interface<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h4>
<p>Similar to the <em>wavecal</em> and <em>spatcal</em> modes described above, the pipeline
provides a <em>slitcorr</em> mode to produce slit correction images starting from
raw FITS files.  This mode can be invoked with a configuration flag:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux_pipe -c slitcorr=True /path/to/fits/files
</pre></div>
</div>
<p>The pre-processing steps in <em>slitcorr</em> reduction mode are the same as in the
standard pipeline reduction, except that the default for the stacking steps
is to add all chop/nod frames and average all input files, to produce a
high-quality sky frame.  Rectification and spatial profile generation also
proceeds as usual, using the latest available wavelength calibration file.</p>
<p>Thereafter, the <em>slitcorr</em> reduction performs the following steps.  Each step
has a number of tunable parameters; see below for parameter descriptions.</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Locate Apertures</strong>: a number of apertures are spaced evenly
across the slit.</p></li>
<li><p><strong>Extract Median Spectra</strong>: flux data is median-combined at each
wavelength position for each aperture.</p></li>
<li><p><strong>Normalize Response</strong>: median spectra are divided by the spectrum
nearest the center of the slit.  The 2D flux image is similarly
normalized, for reference.</p></li>
<li><p><strong>Make Slit Correction</strong>: the normalized spectra are fit with a
low-order polynomial to produce a smooth slit correction surface
that matches the rectified data dimensions.</p></li>
</ul>
</div></blockquote>
<p>Intermediate data can also be saved after any of these steps, and can be
later loaded and used as a starting point for subsequent steps, just as in
the standard spectroscopic pipeline.  Parameter settings can also be saved
in a configuration file, for later re-use or batch processing.</p>
</section>
<section id="id14">
<h4>Useful Parameters<a class="headerlink" href="#id14" title="Link to this heading">¶</a></h4>
<p>Some key parameters used specifically for the <em>slitcorr</em> mode are listed
below.  See above for descriptions of parameters for the steps shared with
the standard pipeline.</p>
<ul>
<li><p><strong>Locate Apertures</strong></p>
<ul class="simple">
<li><p><em>Number of apertures</em>: For this mode, apertures are evenly spaced
across the array.  Specify the desired number of apertures. The
radius for each aperture is automatically assigned to not overlap
with its neighbors.</p></li>
</ul>
</li>
<li><p><strong>Extract Median Spectra</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><em>Save extracted 1D spectra</em>: If set, all extracted spectra are saved to
disk in a FITS file in Spextool format, for inspection.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Normalize Response</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><em>Save extracted 1D spectra</em>: Save normalized spectra to disk in
Spextool format.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Make Slit Correction</strong></p>
<blockquote>
<div><ul>
<li><p>General Parameters</p>
<blockquote>
<div><ul class="simple">
<li><p><em>Fit method</em>: If ‘2D’, a single surface is fit to all the normalized
spectral data, producing a smooth low-order polynomial surface.  If
‘1D’, polynomial fits are performed in the y-direction only, at
each wavelength position, then are smoothed in the x-direction
with a uniform (boxcar) filter.  The 1D option may preserve
higher-order response variations in the x-direction; the 2D option
will produce a smoother surface.</p></li>
<li><p><em>Weight by spectral error</em>: If set, the polynomial fits will be
weighted by the error propagated for the normalized median spectra.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Parameters for 2D fit</p>
<blockquote>
<div><ul class="simple">
<li><p><em>Fit order for X</em>: Polynomial surface fit order in the X direction.
Orders 2-4 are recommended.</p></li>
<li><p><em>Fit order for Y</em>: Polynomial surface fit order in the Y direction.
Orders 2-4 are recommended.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Parameters for 1D fit</p>
<blockquote>
<div><ul class="simple">
<li><p><em>Fit order for Y</em>: Polynomial fit order in the Y direction.
Orders 2-4 are recommended.</p></li>
<li><p><em>Smoothing window for X</em>: Boxcar width for smoothing in X direction,
in pixels.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<figure class="align-default" id="forcast-wavecal-plots">
<img alt="The Redux GUI window, several spectral plot displays with lines marked, and a DS9 window showing a spectral image." src="../../../_images/wavecal_plots1.png" />
<figcaption>
<p><span class="caption-number">Fig. 96 </span><span class="caption-text">Wavecal mode reduction and diagnostic plots.</span><a class="headerlink" href="#forcast-wavecal-plots" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="forcast-spatcal-plots">
<img alt="GUI window, spatial profile plot display, and a DS9 window with a spectral image." src="../../../_images/spatcal_plots1.png" />
<figcaption>
<p><span class="caption-number">Fig. 97 </span><span class="caption-text">Spatcal mode reduction and diagnostic plots.</span><a class="headerlink" href="#forcast-spatcal-plots" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="forcast-wavecal-residuals">
<img alt="An image marked with positions and vertical fit lines and a plot window showing fit residuals in X and Y." src="../../../_images/wavecal_residuals1.png" />
<figcaption>
<p><span class="caption-number">Fig. 98 </span><span class="caption-text">Wavecal mode fit surface and residuals.</span><a class="headerlink" href="#forcast-wavecal-residuals" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="forcast-spatcal-residuals">
<img alt="An image marked with positions and horizontal fit lines and a plot window showing fit residuals in X and Y." src="../../../_images/spatcal_residuals1.png" />
<figcaption>
<p><span class="caption-number">Fig. 99 </span><span class="caption-text">Spatcal mode fit surface and residuals.</span><a class="headerlink" href="#forcast-spatcal-residuals" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>
</section>
<section id="appendix-d-change-notes-for-the-forcast-pipeline">
<span id="forcast-change-notes"></span><h2>Appendix D: Change notes for the FORCAST pipeline<a class="headerlink" href="#appendix-d-change-notes-for-the-forcast-pipeline" title="Link to this heading">¶</a></h2>
<section id="significant-changes">
<h3>Significant changes<a class="headerlink" href="#significant-changes" title="Link to this heading">¶</a></h3>
<p>Below are listed the most significant changes for the FORCAST pipeline
over its history, highlighting impacts to science data products.
See the data handbooks or user manuals associated with each release
for more information.</p>
<p>All pipeline versions prior to v2.0.0 were implemented in IDL;
v2.0.0 and later were implemented in Python.  An early predecessor to the
FORCAST Redux pipeline, called DRIP/FG, was also released for FORCAST
reductions in 2013, but no data in the SOFIA archive remains that was
processed with this pipeline.</p>
<p>For previously processed data, check the PIPEVERS keyword in the
FITS header to determine the pipeline version used.</p>
<section id="forcast-redux-v2-7-0-2022-12-13">
<h4>FORCAST Redux v2.7.0 (2022-12-13)<a class="headerlink" href="#forcast-redux-v2-7-0-2022-12-13" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. M</em></p>
<section id="imaging">
<h5>Imaging<a class="headerlink" href="#imaging" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Add option to use measured water vapor values from the header (WVZ_OBS)
for calibration reference.</p></li>
</ul>
</section>
<section id="spectroscopy">
<h5>Spectroscopy<a class="headerlink" href="#spectroscopy" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Add option to use measured water vapor values from the header (WVZ_OBS)
for selecting the atmospheric model used for telluric correction.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v2-6-0-2022-09-12">
<h4>FORCAST Redux v2.6.0 (2022-09-12)<a class="headerlink" href="#forcast-redux-v2-6-0-2022-09-12" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. L</em></p>
<section id="id15">
<h5>Imaging<a class="headerlink" href="#id15" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Add options to allow diagnostic reductions in the detector coordinate frame,
skipping distortion correction and rotation by the sky angle.</p></li>
</ul>
</section>
<section id="id16">
<h5>Spectroscopy<a class="headerlink" href="#id16" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Fix a bug in water vapor optimization, causing the pipeline to return
too-low PWV values for observations with strong sky lines and significant
wavelength shifts.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v2-5-0-2022-05-25">
<h4>FORCAST Redux v2.5.0 (2022-05-25)<a class="headerlink" href="#forcast-redux-v2-5-0-2022-05-25" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. K</em></p>
<section id="id17">
<h5>Spectroscopy<a class="headerlink" href="#id17" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Accommodate slit scan data with asymmetric nods (SKYMODE=SLITSCAN_NXCAC).</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v2-4-0-2022-04-06">
<h4>FORCAST Redux v2.4.0 (2022-04-06)<a class="headerlink" href="#forcast-redux-v2-4-0-2022-04-06" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. K</em></p>
<section id="id18">
<h5>Imaging<a class="headerlink" href="#id18" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Replace the scikit-image dependency with local implementations of warping
and image interpolation algorithms.</p></li>
</ul>
</section>
<section id="id19">
<h5>Spectroscopy<a class="headerlink" href="#id19" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Add a line list overplot feature to the spectral viewer for interactive
pipeline reductions.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v2-3-0-2021-06-14">
<h4>FORCAST Redux v2.3.0 (2021-06-14)<a class="headerlink" href="#forcast-redux-v2-3-0-2021-06-14" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. J</em></p>
<section id="id20">
<h5>Spectroscopy<a class="headerlink" href="#id20" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Improve the automatic wavelength shifting algorithm in the flux
calibration step to be more reliable across a larger range of
wavelength shifts.</p></li>
<li><p>Additional features for the spectral viewer: reference overplots
and enhanced feature fitting options.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v2-2-1-2021-04-14">
<h4>FORCAST Redux v2.2.1 (2021-04-14)<a class="headerlink" href="#forcast-redux-v2-2-1-2021-04-14" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. H</em></p>
<section id="id21">
<h5>Imaging<a class="headerlink" href="#id21" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Fix NaN handling in peak-finding algorithm for centroid registration.</p></li>
<li><p>Fix expected units for TGTRA keyword, used for non-sidereal target
registration.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v2-2-0-2021-03-10">
<h4>FORCAST Redux v2.2.0 (2021-03-10)<a class="headerlink" href="#forcast-redux-v2-2-0-2021-03-10" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. H</em></p>
<section id="all-modes">
<h5>All modes<a class="headerlink" href="#all-modes" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Add preview images (*.png files) for all final data products.</p></li>
</ul>
</section>
<section id="id22">
<h5>Spectroscopy<a class="headerlink" href="#id22" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>In GUI mode, replace static spectral plots with an interactive viewer.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v2-1-0-2020-09-01">
<h4>FORCAST Redux v2.1.0 (2020-09-01)<a class="headerlink" href="#forcast-redux-v2-1-0-2020-09-01" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. G</em></p>
<section id="id23">
<h5>Imaging<a class="headerlink" href="#id23" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Add BUNIT keys for all extensions.</p></li>
<li><p>Fix for NaN handling with some image combination methods.</p></li>
</ul>
</section>
<section id="id24">
<h5>Spectroscopy<a class="headerlink" href="#id24" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Fix WAVEPOS extension in spectral cube (SCB) to match wavelengths
of the cube slices.</p></li>
<li><p>Fix for wavelength shift optimization occasionally reporting spurious
shifts.</p></li>
<li><p>Add support for wavelength/spatial calibration file generation
to the pipeline.  The output product is a WCL file (PRODTYPE=wavecal);
it may be used in the Make Profiles step in the pipeline to update or
customize the wavelength calibration.</p></li>
<li><p>Add support for combining and smoothing response files generated
from standards (RSP files).</p></li>
<li><p>Add support for generating slit correction images to the pipeline.
The output product is a SCR file (PRODTYPE=slit_correction). It
may be used in the Make Profiles step to correct for slit response.</p></li>
<li><p>Add SPECSYS=TOPOCENT keyword to FITS headers to indicate that wavelengths
have not been corrected for barycentric velocity shifts.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v2-0-0-2020-05-07">
<h4>FORCAST Redux v2.0.0 (2020-05-07)<a class="headerlink" href="#forcast-redux-v2-0-0-2020-05-07" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. F</em></p>
<section id="id25">
<h5>All modes<a class="headerlink" href="#id25" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Full reimplementation of the IDL pipeline into Python 3.</p></li>
<li><p>Images and spectral cubes now have the option of registering to
a non-sidereal target position, rather than to the sidereal
WCS.</p></li>
</ul>
</section>
<section id="id26">
<h5>Imaging<a class="headerlink" href="#id26" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Data formats change significantly.  Imaging products now separate
flux, error, and exposure map into separate FITS image extensions,
rather than storing them as a 3D cube in the primary extension.
Note that the error (standard deviation) is now stored instead of
variance.</p></li>
</ul>
</section>
<section id="id27">
<h5>Spectroscopy<a class="headerlink" href="#id27" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Data formats change significantly.  Images and spectra are stored
in the same FITS file, under separate extensions.  Final 1D spectra
(CMB files, PRODTYPE=combined_spectrum) are still stored in the
same format as before; the spectrum corresponds to the SPECTRAL_FLUX
extension in the COA (PRODTYPE=coadded_spectrum) file.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v1-5-0-2019-07-24">
<h4>FORCAST Redux v1.5.0 (2019-07-24)<a class="headerlink" href="#forcast-redux-v1-5-0-2019-07-24" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. E</em></p>
<section id="id28">
<h5>Imaging<a class="headerlink" href="#id28" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Incorporate new pinhole masks for distortion correction. Allow
different masks by date.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v1-4-0-2019-02-21">
<h4>FORCAST Redux v1.4.0 (2019-02-21)<a class="headerlink" href="#forcast-redux-v1-4-0-2019-02-21" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. E</em></p>
<section id="id29">
<h5>Spectroscopy<a class="headerlink" href="#id29" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Introduce support for slit-scan observations.  The output product
is a spatial-spectral cube (file code SCB, PRODTYPE=speccube,
PROCSTAT=LEVEL_4).</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v1-3-2-2018-09-06">
<h4>FORCAST Redux v1.3.2 (2018-09-06)<a class="headerlink" href="#forcast-redux-v1-3-2-2018-09-06" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. D</em></p>
<section id="id30">
<h5>All modes<a class="headerlink" href="#id30" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Fix input manifest handling to not expect the number of files at
the top of the list.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v1-3-1-2018-03-08">
<h4>FORCAST Redux v1.3.1 (2018-03-08)<a class="headerlink" href="#forcast-redux-v1-3-1-2018-03-08" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. D</em></p>
<section id="id31">
<h5>All modes<a class="headerlink" href="#id31" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Added ASSC-MSN key to track all input MISSN-ID values, for mosaic
support.  Also added ASSC-OBS keys to track all input OBS_ID values.</p></li>
</ul>
</section>
<section id="id32">
<h5>Imaging<a class="headerlink" href="#id32" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Fix for registration error in mosaics with non-empty COADX/Y0 keys.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v1-3-0-2017-04-24">
<h4>FORCAST Redux v1.3.0 (2017-04-24)<a class="headerlink" href="#forcast-redux-v1-3-0-2017-04-24" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. D</em></p>
<section id="id33">
<h5>Imaging<a class="headerlink" href="#id33" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Exposure map is now stored in units of seconds, instead of
number of exposures.</p></li>
<li><p>Support for multi-field mosaics is introduced. The Level 4 product
type is a MOS file (PRODTYPE=mosaic).</p></li>
<li><p>Extra NaN borders are stripped from images after the merge step.</p></li>
<li><p>Default registration method is now WCS comparison, rather than
header shifts from dither keywords.</p></li>
</ul>
</section>
<section id="id34">
<h5>Spectroscopy<a class="headerlink" href="#id34" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Incorporated process for generating instrumental response curves
into the pipeline.  The output product is a response file (RSP)
for each telluric standard observation.  RSP files can be combined
together with a separate tool to generate a master response spectrum.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v1-2-0-2017-01-25">
<h4>FORCAST Redux v1.2.0 (2017-01-25)<a class="headerlink" href="#forcast-redux-v1-2-0-2017-01-25" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. C</em></p>
<section id="id35">
<h5>Imaging<a class="headerlink" href="#id35" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Flux calibration procedure revised to separate telluric correction
from flux calibration.  Telluric correction is now performed on a
file-by-file basis, for better accuracy, after registration.  The
REG file is no longer saved by default; it is replaced by a TEL file
which is telluric-corrected but not flux calibration.  The final
calibration factor is still applied at the end of the pipeline, making
a single CAL file.  The CALFCTR stored in the header is now the
calibration factor at the reference altitude and zenith angle; it no
longer includes the telluric correction factor.  The latter value is
stored in the new keyword TELCORR.</p></li>
</ul>
</section>
<section id="id36">
<h5>Spectroscopy<a class="headerlink" href="#id36" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Introduced telluric correction optimization, using a library of
ATRAN files at various water vapor values, and using the one that
best corrects the data. Derived WV values are stored in the FITPWV
keyword.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v1-1-3-2016-09-20">
<h4>FORCAST Redux v1.1.3 (2016-09-20)<a class="headerlink" href="#forcast-redux-v1-1-3-2016-09-20" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. B</em></p>
<section id="id37">
<h5>Imaging<a class="headerlink" href="#id37" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Rotation in the merge step is now performed around the CRPIX
(boresight center) rather than the image center.  This fixed small
misalignments among images of fields taken at multiple rotation values.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v1-1-2-2016-07-29">
<h4>FORCAST Redux v1.1.2 (2016-07-29)<a class="headerlink" href="#forcast-redux-v1-1-2-2016-07-29" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. B</em></p>
<section id="id38">
<h5>Imaging<a class="headerlink" href="#id38" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Fix for flux calibration procedure to distinguish between
Barr2 and Barr3 dichroics.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v1-1-1-2016-06-09">
<h4>FORCAST Redux v1.1.1 (2016-06-09)<a class="headerlink" href="#forcast-redux-v1-1-1-2016-06-09" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. B</em></p>
<section id="id39">
<h5>Imaging<a class="headerlink" href="#id39" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Fix for bad NaN handling, leaving small artifacts in merged image.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v1-1-0-2016-01-28">
<h4>FORCAST Redux v1.1.0 (2016-01-28)<a class="headerlink" href="#forcast-redux-v1-1-0-2016-01-28" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. B</em></p>
<section id="id40">
<h5>Imaging<a class="headerlink" href="#id40" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Flux calibration factors are now applied to data arrays to
convert them to physical units (Jy).  The calibrated data product
has file code CAL (PRODTYPE=calibrated).  COA files are no longer
designated Level 3, even if their headers contain calibration
factors.</p></li>
<li><p>Border-padding around valid imaging data now has NaN value instead
of 0.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v1-0-8-2015-10-06">
<h4>FORCAST Redux v1.0.8 (2015-10-06)<a class="headerlink" href="#forcast-redux-v1-0-8-2015-10-06" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. A</em></p>
<section id="id41">
<h5>Spectroscopy<a class="headerlink" href="#id41" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Bug fix for plot generation in headless mode.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v1-0-7-2015-09-03">
<h4>FORCAST Redux v1.0.7 (2015-09-03)<a class="headerlink" href="#forcast-redux-v1-0-7-2015-09-03" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. A</em></p>
<section id="id42">
<h5>All modes<a class="headerlink" href="#id42" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Handle DETCHAN keyword set to SW/LW instead of 0/1.</p></li>
</ul>
</section>
<section id="id43">
<h5>Imaging<a class="headerlink" href="#id43" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Apply average calibration factors to standards, instead of derived
value from photometry</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v1-0-6-2015-06-26">
<h4>FORCAST Redux v1.0.6 (2015-06-26)<a class="headerlink" href="#forcast-redux-v1-0-6-2015-06-26" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. A</em></p>
<section id="id44">
<h5>Imaging<a class="headerlink" href="#id44" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Fix for negative values in variance plane.</p></li>
<li><p>Stop re-doing photometry for standards when applyin calibration factors.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v1-0-5-2015-05-27">
<h4>FORCAST Redux v1.0.5 (2015-05-27)<a class="headerlink" href="#forcast-redux-v1-0-5-2015-05-27" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. A</em></p>
<section id="id45">
<h5>All modes<a class="headerlink" href="#id45" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Introduced the TOTINT keyword, to track the total integration time,
as it would be requested in SITE, for more direct comparison with
proposals.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v1-0-4-2015-05-14">
<h4>FORCAST Redux v1.0.4 (2015-05-14)<a class="headerlink" href="#forcast-redux-v1-0-4-2015-05-14" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. A</em></p>
<section id="id46">
<h5>All modes<a class="headerlink" href="#id46" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Total nominal on-source exposure time now tracked in the EXPTIME keyword.</p></li>
<li><p>Introduced the ASSC_AOR key to track all input AOR-IDs for each reduction.</p></li>
</ul>
</section>
<section id="id47">
<h5>Imaging<a class="headerlink" href="#id47" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Flux calibration is now integrated into the pipeline, rather than applied
after the fact by a separate package.  Flux calibration factors are
stored in keywords in the Level 3 data files; they are not directly
applied to the data.</p></li>
<li><p>Photometry is automatically performed on flux standard observations,
with values stored in FITS keywords.</p></li>
</ul>
</section>
<section id="id48">
<h5>Spectroscopy<a class="headerlink" href="#id48" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Introduced spatial correction maps for improved rectified images.</p></li>
<li><p>Introduced slit response functions for detector response correction
in the spatial direction.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v1-0-3-2015-01-23">
<h4>FORCAST Redux v1.0.3 (2015-01-23)<a class="headerlink" href="#forcast-redux-v1-0-3-2015-01-23" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. A</em></p>
<section id="id49">
<h5>All modes<a class="headerlink" href="#id49" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Nonlinearity correction modified for High/Low capacitance distinction.</p></li>
<li><p>Output filename convention updated to include flight number.</p></li>
<li><p>Introduced date-handling for calibration parameters.</p></li>
</ul>
</section>
<section id="id50">
<h5>Imaging<a class="headerlink" href="#id50" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Source positions for standards recorded and propagated in SRCPOSX/Y
keywords.</p></li>
</ul>
</section>
<section id="id51">
<h5>Spectroscopy<a class="headerlink" href="#id51" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Modifications to default spectral extraction parameters to support
extended sources.</p></li>
<li><p>Scale spectra before merging to account for slit loss.</p></li>
<li><p>Introduced option to turn off subtraction of median level from spatial
profiles, to support extended sources and short slits.</p></li>
<li><p>Introduced telluric correction and flux calibration.</p></li>
<li><p>ITOT and NEXP keywords introduced to track total integration time.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v1-0-2-2014-07-08">
<h4>FORCAST Redux v1.0.2 (2014-07-08)<a class="headerlink" href="#forcast-redux-v1-0-2-2014-07-08" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. A</em></p>
<section id="id52">
<h5>Spectroscopy<a class="headerlink" href="#id52" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>G2xG1 wavelength calibration update.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v1-0-1-2014-06-17">
<h4>FORCAST Redux v1.0.1 (2014-06-17)<a class="headerlink" href="#forcast-redux-v1-0-1-2014-06-17" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. A</em></p>
<section id="id53">
<h5>Imaging<a class="headerlink" href="#id53" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Flux calibration package (pipecal) integration and improvements.</p></li>
</ul>
</section>
<section id="id54">
<h5>Spectroscopy<a class="headerlink" href="#id54" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Wavelength calibration updates.</p></li>
</ul>
</section>
</section>
<section id="forcast-redux-v1-0-0-2013-12-30">
<h4>FORCAST Redux v1.0.0 (2013-12-30)<a class="headerlink" href="#forcast-redux-v1-0-0-2013-12-30" title="Link to this heading">¶</a></h4>
<p><em>User manual: Rev. -</em></p>
<section id="id55">
<h5>All modes<a class="headerlink" href="#id55" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>Integrated FORCAST imaging algorithms (DRIP) with Spextool spectral
extraction algorithms, in a standard pipeline interface (Redux).</p></li>
</ul>
</section>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">FORCAST Redux User’s Manual</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#si-observing-modes-supported">SI Observing Modes Supported</a><ul>
<li><a class="reference internal" href="#forcast-observing-techniques">FORCAST observing techniques</a></li>
<li><a class="reference internal" href="#available-chopping-modes">Available chopping modes</a><ul>
<li><a class="reference internal" href="#symmetric-chopping-modes-c2n-and-c2nd">Symmetric chopping modes: C2N and C2ND</a><ul>
<li><a class="reference internal" href="#c2n-nod-match-chop-nmc">C2N: Nod Match Chop (NMC)</a></li>
<li><a class="reference internal" href="#c2n-nod-perpendicular-to-chop-npc">C2N: Nod Perpendicular to Chop (NPC)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#asymmetrical-chopping-modes-c2nc2-and-nxcac">Asymmetrical chopping modes: C2NC2 and NXCAC</a></li>
<li><a class="reference internal" href="#spectral-imaging-mode-slitscan">Spectral imaging mode: SLITSCAN</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#algorithm-description">Algorithm Description</a><ul>
<li><a class="reference internal" href="#overview-of-data-reduction-steps">Overview of data reduction steps</a></li>
<li><a class="reference internal" href="#reduction-algorithms">Reduction algorithms</a><ul>
<li><a class="reference internal" href="#steps-common-to-imaging-and-spectroscopy-modes">Steps common to imaging and spectroscopy modes</a><ul>
<li><a class="reference internal" href="#identify-bad-pixels">Identify bad pixels</a></li>
<li><a class="reference internal" href="#correct-droop-effect">Correct droop effect</a></li>
<li><a class="reference internal" href="#correct-for-detector-nonlinearity">Correct for detector nonlinearity</a></li>
<li><a class="reference internal" href="#subtract-background-stack-chops-nods">Subtract background (stack chops/nods)</a></li>
<li><a class="reference internal" href="#remove-jailbars-correct-for-crosstalk">Remove jailbars (correct for crosstalk)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#imaging-specific-steps">Imaging-specific steps</a><ul>
<li><a class="reference internal" href="#correct-for-optical-distortion">Correct for optical distortion</a></li>
<li><a class="reference internal" href="#merge-chopped-nodded-images">Merge chopped/nodded images</a></li>
<li><a class="reference internal" href="#register-images">Register images</a></li>
<li><a class="reference internal" href="#correct-for-atmospheric-transmission">Correct for atmospheric transmission</a></li>
<li><a class="reference internal" href="#coadd-multiple-observations">Coadd multiple observations</a></li>
<li><a class="reference internal" href="#calibrate-flux">Calibrate flux</a></li>
<li><a class="reference internal" href="#mosaic">Mosaic</a></li>
</ul>
</li>
<li><a class="reference internal" href="#spectroscopy-specific-steps">Spectroscopy-specific steps</a><ul>
<li><a class="reference internal" href="#stack-common-dithers">Stack common dithers</a></li>
<li><a class="reference internal" href="#rectify-spectral-image">Rectify spectral image</a></li>
<li><a class="reference internal" href="#set-apertures">Identify apertures</a></li>
<li><a class="reference internal" href="#spectral-extraction-and-merging">Spectral extraction and merging</a></li>
<li><a class="reference internal" href="#calibrate-flux-and-correct-for-atmospheric-transmission">Calibrate flux and correct for atmospheric transmission</a></li>
<li><a class="reference internal" href="#combine-multiple-observations">Combine multiple observations</a></li>
<li><a class="reference internal" href="#response-spectra">Response spectra</a></li>
<li><a class="reference internal" href="#spectral-cubes">Spectral cubes</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#uncertainties">Uncertainties</a></li>
<li><a class="reference internal" href="#other-resources">Other Resources</a></li>
</ul>
</li>
<li><a class="reference internal" href="#flux-calibration">Flux calibration</a><ul>
<li><a class="reference internal" href="#imaging-flux-calibration">Imaging Flux Calibration</a><ul>
<li><a class="reference internal" href="#reduction-steps">Reduction steps</a></li>
<li><a class="reference internal" href="#color-corrections">Color corrections</a></li>
</ul>
</li>
<li><a class="reference internal" href="#spectrophotometric-flux-calibration">Spectrophotometric Flux Calibration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-products">Data products</a><ul>
<li><a class="reference internal" href="#filenames">Filenames</a></li>
<li><a class="reference internal" href="#pipeline-products">Pipeline Products</a></li>
<li><a class="reference internal" href="#data-format">Data Format</a></li>
<li><a class="reference internal" href="#data-quality">Data Quality</a></li>
<li><a class="reference internal" href="#exposure-time">Exposure Time</a></li>
<li><a class="reference internal" href="#pipeline-updates">Pipeline Updates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#grouping-level-1-data-for-processing">Grouping LEVEL_1 data for processing</a></li>
<li><a class="reference internal" href="#configuration-and-execution">Configuration and execution</a><ul>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#external-requirements">External Requirements</a></li>
<li><a class="reference internal" href="#source-code-installation">Source Code Installation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#input-data">Input data</a></li>
<li><a class="reference internal" href="#automatic-mode-execution">Automatic Mode Execution</a></li>
<li><a class="reference internal" href="#manual-mode-execution">Manual Mode Execution</a><ul>
<li><a class="reference internal" href="#basic-workflow">Basic Workflow</a></li>
<li><a class="reference internal" href="#display-features">Display Features</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-reduction">FORCAST Reduction</a><ul>
<li><a class="reference internal" href="#imaging-reduction">Imaging Reduction</a><ul>
<li><a class="reference internal" href="#useful-parameters">Useful Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#grism-reduction">Grism Reduction</a><ul>
<li><a class="reference internal" href="#id10">Useful Parameters</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#data-quality-assessment">Data Quality Assessment</a></li>
<li><a class="reference internal" href="#appendix-a-sample-configuration-files">Appendix A: Sample configuration files</a></li>
<li><a class="reference internal" href="#appendix-b-required-input-keywords">Appendix B: Required input keywords</a></li>
<li><a class="reference internal" href="#appendix-c-calibration-data-generation">Appendix C: Calibration Data Generation</a><ul>
<li><a class="reference internal" href="#instrumental-response-curve">Instrumental Response Curve</a><ul>
<li><a class="reference internal" href="#id11">Useful Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#wavelength-calibration-map">Wavelength Calibration Map</a><ul>
<li><a class="reference internal" href="#calibration-principles">Calibration Principles</a></li>
<li><a class="reference internal" href="#pipeline-interface">Pipeline Interface</a></li>
<li><a class="reference internal" href="#reference-data">Reference Data</a></li>
<li><a class="reference internal" href="#display-tools">Display Tools</a></li>
<li><a class="reference internal" href="#id12">Useful Parameters</a><ul>
<li><a class="reference internal" href="#wavecal-mode">Wavecal Mode</a></li>
<li><a class="reference internal" href="#spatcal-mode">Spatcal Mode</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#slit-correction-image">Slit Correction Image</a><ul>
<li><a class="reference internal" href="#id13">Pipeline Interface</a></li>
<li><a class="reference internal" href="#id14">Useful Parameters</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#appendix-d-change-notes-for-the-forcast-pipeline">Appendix D: Change notes for the FORCAST pipeline</a><ul>
<li><a class="reference internal" href="#significant-changes">Significant changes</a><ul>
<li><a class="reference internal" href="#forcast-redux-v2-7-0-2022-12-13">FORCAST Redux v2.7.0 (2022-12-13)</a><ul>
<li><a class="reference internal" href="#imaging">Imaging</a></li>
<li><a class="reference internal" href="#spectroscopy">Spectroscopy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v2-6-0-2022-09-12">FORCAST Redux v2.6.0 (2022-09-12)</a><ul>
<li><a class="reference internal" href="#id15">Imaging</a></li>
<li><a class="reference internal" href="#id16">Spectroscopy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v2-5-0-2022-05-25">FORCAST Redux v2.5.0 (2022-05-25)</a><ul>
<li><a class="reference internal" href="#id17">Spectroscopy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v2-4-0-2022-04-06">FORCAST Redux v2.4.0 (2022-04-06)</a><ul>
<li><a class="reference internal" href="#id18">Imaging</a></li>
<li><a class="reference internal" href="#id19">Spectroscopy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v2-3-0-2021-06-14">FORCAST Redux v2.3.0 (2021-06-14)</a><ul>
<li><a class="reference internal" href="#id20">Spectroscopy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v2-2-1-2021-04-14">FORCAST Redux v2.2.1 (2021-04-14)</a><ul>
<li><a class="reference internal" href="#id21">Imaging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v2-2-0-2021-03-10">FORCAST Redux v2.2.0 (2021-03-10)</a><ul>
<li><a class="reference internal" href="#all-modes">All modes</a></li>
<li><a class="reference internal" href="#id22">Spectroscopy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v2-1-0-2020-09-01">FORCAST Redux v2.1.0 (2020-09-01)</a><ul>
<li><a class="reference internal" href="#id23">Imaging</a></li>
<li><a class="reference internal" href="#id24">Spectroscopy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v2-0-0-2020-05-07">FORCAST Redux v2.0.0 (2020-05-07)</a><ul>
<li><a class="reference internal" href="#id25">All modes</a></li>
<li><a class="reference internal" href="#id26">Imaging</a></li>
<li><a class="reference internal" href="#id27">Spectroscopy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v1-5-0-2019-07-24">FORCAST Redux v1.5.0 (2019-07-24)</a><ul>
<li><a class="reference internal" href="#id28">Imaging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v1-4-0-2019-02-21">FORCAST Redux v1.4.0 (2019-02-21)</a><ul>
<li><a class="reference internal" href="#id29">Spectroscopy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v1-3-2-2018-09-06">FORCAST Redux v1.3.2 (2018-09-06)</a><ul>
<li><a class="reference internal" href="#id30">All modes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v1-3-1-2018-03-08">FORCAST Redux v1.3.1 (2018-03-08)</a><ul>
<li><a class="reference internal" href="#id31">All modes</a></li>
<li><a class="reference internal" href="#id32">Imaging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v1-3-0-2017-04-24">FORCAST Redux v1.3.0 (2017-04-24)</a><ul>
<li><a class="reference internal" href="#id33">Imaging</a></li>
<li><a class="reference internal" href="#id34">Spectroscopy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v1-2-0-2017-01-25">FORCAST Redux v1.2.0 (2017-01-25)</a><ul>
<li><a class="reference internal" href="#id35">Imaging</a></li>
<li><a class="reference internal" href="#id36">Spectroscopy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v1-1-3-2016-09-20">FORCAST Redux v1.1.3 (2016-09-20)</a><ul>
<li><a class="reference internal" href="#id37">Imaging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v1-1-2-2016-07-29">FORCAST Redux v1.1.2 (2016-07-29)</a><ul>
<li><a class="reference internal" href="#id38">Imaging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v1-1-1-2016-06-09">FORCAST Redux v1.1.1 (2016-06-09)</a><ul>
<li><a class="reference internal" href="#id39">Imaging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v1-1-0-2016-01-28">FORCAST Redux v1.1.0 (2016-01-28)</a><ul>
<li><a class="reference internal" href="#id40">Imaging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v1-0-8-2015-10-06">FORCAST Redux v1.0.8 (2015-10-06)</a><ul>
<li><a class="reference internal" href="#id41">Spectroscopy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v1-0-7-2015-09-03">FORCAST Redux v1.0.7 (2015-09-03)</a><ul>
<li><a class="reference internal" href="#id42">All modes</a></li>
<li><a class="reference internal" href="#id43">Imaging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v1-0-6-2015-06-26">FORCAST Redux v1.0.6 (2015-06-26)</a><ul>
<li><a class="reference internal" href="#id44">Imaging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v1-0-5-2015-05-27">FORCAST Redux v1.0.5 (2015-05-27)</a><ul>
<li><a class="reference internal" href="#id45">All modes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v1-0-4-2015-05-14">FORCAST Redux v1.0.4 (2015-05-14)</a><ul>
<li><a class="reference internal" href="#id46">All modes</a></li>
<li><a class="reference internal" href="#id47">Imaging</a></li>
<li><a class="reference internal" href="#id48">Spectroscopy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v1-0-3-2015-01-23">FORCAST Redux v1.0.3 (2015-01-23)</a><ul>
<li><a class="reference internal" href="#id49">All modes</a></li>
<li><a class="reference internal" href="#id50">Imaging</a></li>
<li><a class="reference internal" href="#id51">Spectroscopy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v1-0-2-2014-07-08">FORCAST Redux v1.0.2 (2014-07-08)</a><ul>
<li><a class="reference internal" href="#id52">Spectroscopy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v1-0-1-2014-06-17">FORCAST Redux v1.0.1 (2014-06-17)</a><ul>
<li><a class="reference internal" href="#id53">Imaging</a></li>
<li><a class="reference internal" href="#id54">Spectroscopy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcast-redux-v1-0-0-2013-12-30">FORCAST Redux v1.0.0 (2013-12-30)</a><ul>
<li><a class="reference internal" href="#id55">All modes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../../../_sources/manuals/forcast/users/users.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2024, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.2.6. &nbsp;
    Last built 05 Feb 2024. <br/>
  </p>
</footer>
  </body>
</html>