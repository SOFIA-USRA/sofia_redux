<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>extspec &#8212; sofia_redux v1.3.4.dev38+g92ea2f4</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    
    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=6aa39468"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="icon" href="../_static/redux.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="find_apertures" href="sofia_redux.spectroscopy.findapertures.find_apertures.html" />
    <link rel="prev" title="col_subbg" href="sofia_redux.spectroscopy.extspec.col_subbg.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://irsa.ipac.caltech.edu/Missions/sofia.html"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="sofia_redux.spectroscopy.findapertures.find_apertures.html" title="find_apertures">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="sofia_redux.spectroscopy.extspec.col_subbg.html" title="col_subbg">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">sofia_redux v1.3.4.dev38+g92ea2f4</a>
	 &#187;
      </li>
      <li><a href="../sofia_redux/index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../manuals/exes/developers/developers.html" accesskey="U">EXES Redux Developer’s Manual</a> &#187;</li>
      
      <li>extspec</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="extspec">
<h1>extspec<a class="headerlink" href="#extspec" title="Link to this heading">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="sofia_redux.spectroscopy.extspec.extspec">
<span class="sig-prename descclassname"><span class="pre">sofia_redux.spectroscopy.extspec.</span></span><span class="sig-name descname"><span class="pre">extspec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rectimg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">profile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spatial_map</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sub_background</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fix_bad</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bgorder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sum_function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/spectroscopy/extspec.html#extspec"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.spectroscopy.extspec.extspec" title="Link to this definition">¶</a></dt>
<dd><p>Extracts spectra from a rectified spectral image.</p>
<p>For each column (wavelength) in each order:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>(optional) Remove background using spatial regions
identified in the aperture mask.</p></li>
<li><p>(optional) Use the spatial model in spatial_map or profile to
remove bad pixels.</p></li>
<li><p>Extract the spectral value for that column using either
the standard or optimal extraction algorithm.</p></li>
</ol>
</div></blockquote>
<p>Standard Extraction:
If bad pixels were identified via the spatial model, they are
replaced by the value of the spatial model at that wavelength.
The spectral value for a given aperture is then taken as the sum
of all pixels lying on the aperture.</p>
<p>Optimal Extraction:
The spectral value for each aperture is taken by taking a mean of
the column weighted by the spatial model, for pixels identified as
the aperture radius in the aperture mask.  Bad pixels are ignored.</p>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl>
<dt><strong>rectimg</strong><span class="classifier">dict</span></dt><dd><p>Rectified image data with aperture definitions.  The aperture
mask is as produced by the <a class="reference internal" href="../sofia_redux/spectroscopy/index.html#module-sofia_redux.spectroscopy.mkapmask" title="sofia_redux.spectroscopy.mkapmask"><code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.spectroscopy.mkapmask</span></code></a>
function.</p>
<dl class="simple">
<dt>Structure is:</dt><dd><dl class="simple">
<dt>order (int) -&gt; dict</dt><dd><dl class="simple">
<dt>image -&gt; numpy.ndarray (ns, nw)</dt><dd><p>Rectified order image.</p>
</dd>
<dt>variance -&gt; numpy.ndarray (ns, nw)</dt><dd><p>Rectified variance for image.</p>
</dd>
<dt>wave -&gt; numpy.ndarray (nw,)</dt><dd><p>Wavelength coordinates.</p>
</dd>
<dt>spatial -&gt; numpy.ndarray (ns,)</dt><dd><p>Spatial coordinates.</p>
</dd>
<dt>mask -&gt; numpy.ndarray (ns, nw)</dt><dd><p>Boolean bad pixel mask (True = good).</p>
</dd>
<dt>bitmask -&gt; numpy.ndarray (ns, nw)</dt><dd><p>Bit-set mask. 1=nonlinear pixel.</p>
</dd>
<dt>apmask -&gt; numpy.ndarray (ns, nw)</dt><dd><p>Aperture mask.</p>
</dd>
<dt>apsign -&gt; list of {1, -1}, optional</dt><dd><p>Aperture signs for each aperture.  Must match the
number of apertures in the aperture mask if provided.
All aperture signs are assumed positive if not provided.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt><strong>profile</strong><span class="classifier">dict, optional</span></dt><dd><p>Median spatial profile for each order.</p>
<dl class="simple">
<dt>Structure is:</dt><dd><p>order (int) -&gt; numpy.ndarray (ns,)</p>
</dd>
</dl>
</dd>
<dt><strong>spatial_map</strong><span class="classifier">dict, optional</span></dt><dd><p>2D spatial map for each order.  If provided, <a class="reference external" href="https://docs.python.org/3/library/profile.html#module-profile" title="(in Python v3.12)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">profile</span></code></a> is ignored.</p>
<dl class="simple">
<dt>Structure is:</dt><dd><p>order (int) -&gt; numpy.ndarray (ns, nw)</p>
</dd>
</dl>
</dd>
<dt><strong>optimal</strong><span class="classifier">bool, optional</span></dt><dd><p>If set, optimal extraction is used.</p>
</dd>
<dt><strong>sub_background</strong><span class="classifier">bool, optional</span></dt><dd><p>If set, background regions identified in the aperture mask
are fit and subtracted from each column.  If set, <a class="reference external" href="https://docs.python.org/3/library/profile.html#module-profile" title="(in Python v3.12)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">profile</span></code></a>
or <code class="xref py py-obj docutils literal notranslate"><span class="pre">spatial_map</span></code> must be provided.</p>
</dd>
<dt><strong>fix_bad</strong><span class="classifier">bool, optional</span></dt><dd><p>If set, bad pixels will be fixed in the 2D spectral image.
For standard extraction, the fixed pixels will be used to calculate
the extracted flux.  For optimal extraction, the fixed pixels
will be ignored.</p>
</dd>
<dt><strong>bgorder</strong><span class="classifier">int, optional</span></dt><dd><p>Background fitting order.</p>
</dd>
<dt><strong>threshold</strong><span class="classifier">float, optional</span></dt><dd><p>Robust threshold for background fits, in number of sigma.</p>
</dd>
<dt><strong>sum_function</strong><span class="classifier">function, optional</span></dt><dd><p>Function to use as sum over aperture, when optimal=False.
Default is np.nansum(flux * weights). The provided function
should accept one two array arguments (flux and weights).</p>
</dd>
<dt><strong>error_function</strong><span class="classifier">function, optional</span></dt><dd><p>Function to use for error propagation, given variance input,
when optimal=False.  Default is np.sqrt(np.nansum(flux * weights)).
The provided function should accept two array arguments
(variance and weights).</p>
</dd>
<dt><strong>verbose</strong><span class="classifier">bool, optional</span></dt><dd><p>If set, columns that fail background fit or optimal extraction
will generate warnings for the log.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>spectra</strong><span class="classifier">dict</span></dt><dd><dl class="simple">
<dt>order (int) -&gt; dict</dt><dd><dl class="simple">
<dt>spectra<span class="classifier">numpy.ndarray of float (n_apertures, 4, n_spec)</span></dt><dd><dl class="simple">
<dt>Each order contains a single array where:</dt><dd><p>array[aperture, 0] = wavelength
array[aperture, 1] = flux
array[aperture, 2] = error
array[aperture, 3] = bit-set mask</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">extspec</a><ul>
<li><a class="reference internal" href="#sofia_redux.spectroscopy.extspec.extspec"><code class="docutils literal notranslate"><span class="pre">extspec()</span></code></a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/api/sofia_redux.spectroscopy.extspec.extspec.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2024, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.2.6. &nbsp;
    Last built 05 Feb 2024. <br/>
  </p>
</footer>
  </body>
</html>