<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Models &#8212; sofia_redux v1.3.4.dev38+g92ea2f4</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    
    <script src="../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../_static/documentation_options.js?v=6aa39468"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <link rel="icon" href="../../_static/redux.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Fitting Curves to Data" href="fitting.html" />
    <link rel="prev" title="Design Philosophy" href="structure.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://irsa.ipac.caltech.edu/Missions/sofia.html"></a></li>
    <li><a title="General Index" href="../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="fitting.html" title="Fitting Curves to Data">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="structure.html" title="Design Philosophy">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../../index.html">sofia_redux v1.3.4.dev38+g92ea2f4</a>
	 &#187;
      </li>
      <li><a href="../index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="index.html" accesskey="U">sofia_redux.visualization: The Eye of SOFIA</a> &#187;</li>
      
      <li>Models</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="models">
<span id="id1"></span><h1>Models<a class="headerlink" href="#models" title="Link to this heading">¶</a></h1>
<section id="overview">
<span id="models-overview"></span><h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>The <a class="reference internal" href="../../api/sofia_redux.visualization.models.model.Model.html#sofia_redux.visualization.models.model.Model" title="sofia_redux.visualization.models.model.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> classes are
used to store the contents of data sets (FITS files and non-FITS) read into the
Eye. The
Eye is intended to display any data generated by SOFIA, including grism data,
spectral cubes, images, and multi-order spectra.
Currently only the spectra viewer is available, so only spectral models are
used. Spectral cubes are not yet supported. Currently, all data products from
FORCAST and EXES are being supported. We also support data in non-FITS format
using <code class="xref py py-meth docutils literal notranslate"><span class="pre">General</span></code>.</p>
<p>While all data sets are packaged in FITS files, the details of how the data
is structured can vary wildly. To simplify the task of plotting, all data sets
are read into a collection of <code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code> classes. The method
<code class="xref py py-meth docutils literal notranslate"><span class="pre">General()</span></code> converts a non-FITS dataset into HDU format so it can be
dealt with in the same manner as a FITS file.
There are three levels of
<code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code> classes corresponding to more minute details of the data set. The
Eye itself only interacts with the top level <code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code> class, which allows
for a single uniform interface for the Eye to access any part of the dataset
without needing to know the details of how the FITS file was structured.</p>
</section>
<section id="diagram">
<span id="model-uml"></span><h2>Diagram<a class="headerlink" href="#diagram" title="Link to this heading">¶</a></h2>
<a class="reference internal image-reference" href="../../_images/model_uml.png"><img alt="Class diagram for models." src="../../_images/model_uml.png" style="width: 1200px;" /></a>
</section>
<section id="model-levels">
<span id="id2"></span><h2>Model Levels<a class="headerlink" href="#model-levels" title="Link to this heading">¶</a></h2>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code> classes are split into three layers:</p>
<ul class="simple">
<li><p>High Model: Describes a single FITS file</p></li>
<li><p>Mid Model: Describes a single observation</p></li>
<li><p>Low Model: Describes a single measurement</p></li>
</ul>
<p>For example, a calibrated coadded grism file from FORCAST will be loaded into:</p>
<ul class="simple">
<li><p>One high model
(<a class="reference internal" href="../../api/sofia_redux.visualization.models.high_model.Grism.html#sofia_redux.visualization.models.high_model.Grism" title="sofia_redux.visualization.models.high_model.Grism"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grism</span></code></a>)</p></li>
<li><dl class="simple">
<dt>Two mid models:</dt><dd><ul>
<li><p>One for image
(<a class="reference internal" href="../../api/sofia_redux.visualization.models.mid_model.Book.html#sofia_redux.visualization.models.mid_model.Book" title="sofia_redux.visualization.models.mid_model.Book"><code class="xref py py-class docutils literal notranslate"><span class="pre">Book</span></code></a>)</p></li>
<li><p>One for spectrum
(<a class="reference internal" href="../../api/sofia_redux.visualization.models.mid_model.Order.html#sofia_redux.visualization.models.mid_model.Order" title="sofia_redux.visualization.models.mid_model.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a>)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Eight low models:</dt><dd><ul>
<li><p>FLUX
(<a class="reference internal" href="../../api/sofia_redux.visualization.models.low_model.Image.html#sofia_redux.visualization.models.low_model.Image" title="sofia_redux.visualization.models.low_model.Image"><code class="xref py py-class docutils literal notranslate"><span class="pre">Image</span></code></a>)</p></li>
<li><p>ERROR
(<a class="reference internal" href="../../api/sofia_redux.visualization.models.low_model.Image.html#sofia_redux.visualization.models.low_model.Image" title="sofia_redux.visualization.models.low_model.Image"><code class="xref py py-class docutils literal notranslate"><span class="pre">Image</span></code></a>)</p></li>
<li><p>EXPOSURE
(<a class="reference internal" href="../../api/sofia_redux.visualization.models.low_model.Image.html#sofia_redux.visualization.models.low_model.Image" title="sofia_redux.visualization.models.low_model.Image"><code class="xref py py-class docutils literal notranslate"><span class="pre">Image</span></code></a>)</p></li>
<li><p>WAVEPOS
(<a class="reference internal" href="../../api/sofia_redux.visualization.models.low_model.Spectrum.html#sofia_redux.visualization.models.low_model.Spectrum" title="sofia_redux.visualization.models.low_model.Spectrum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Spectrum</span></code></a>)</p></li>
<li><p>SPECTRAL_FLUX
(<a class="reference internal" href="../../api/sofia_redux.visualization.models.low_model.Spectrum.html#sofia_redux.visualization.models.low_model.Spectrum" title="sofia_redux.visualization.models.low_model.Spectrum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Spectrum</span></code></a>)</p></li>
<li><p>SPECTRAL_ERROR
(<a class="reference internal" href="../../api/sofia_redux.visualization.models.low_model.Spectrum.html#sofia_redux.visualization.models.low_model.Spectrum" title="sofia_redux.visualization.models.low_model.Spectrum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Spectrum</span></code></a>)</p></li>
<li><p>TRANSMISSION
(<a class="reference internal" href="../../api/sofia_redux.visualization.models.low_model.Spectrum.html#sofia_redux.visualization.models.low_model.Spectrum" title="sofia_redux.visualization.models.low_model.Spectrum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Spectrum</span></code></a>)</p></li>
<li><p>RESPONSE
(<a class="reference internal" href="../../api/sofia_redux.visualization.models.low_model.Spectrum.html#sofia_redux.visualization.models.low_model.Spectrum" title="sofia_redux.visualization.models.low_model.Spectrum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Spectrum</span></code></a>)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Each layer is defined by an abstract class
(<a class="reference internal" href="../../api/sofia_redux.visualization.models.high_model.HighModel.html#sofia_redux.visualization.models.high_model.HighModel" title="sofia_redux.visualization.models.high_model.HighModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">HighModel</span></code></a>,
<a class="reference internal" href="../../api/sofia_redux.visualization.models.mid_model.MidModel.html#sofia_redux.visualization.models.mid_model.MidModel" title="sofia_redux.visualization.models.mid_model.MidModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">MidModel</span></code></a>, and
<a class="reference internal" href="../../api/sofia_redux.visualization.models.low_model.LowModel.html#sofia_redux.visualization.models.low_model.LowModel" title="sofia_redux.visualization.models.low_model.LowModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">LowModel</span></code></a>)
that is implemented by a variety of subclasses. The details of
each subclass are defined below.</p>
<section id="high-models">
<span id="high-model"></span><h3>High Models<a class="headerlink" href="#high-models" title="Link to this heading">¶</a></h3>
<p>High models describe a single FITS file. They are uniquely defined by their
<code class="docutils literal notranslate"><span class="pre">id</span></code>, which is the same os their filename. Currently the <code class="xref py py-class docutils literal notranslate"><span class="pre">HighModel</span></code>
abstract class is implemented in two subclasses:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../api/sofia_redux.visualization.models.high_model.Grism.html#sofia_redux.visualization.models.high_model.Grism" title="sofia_redux.visualization.models.high_model.Grism"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grism</span></code></a>: The
grism describes a FITS file that contains both a single
image and a single spectrum. Any data product from FORCAST is read
into a Grism class.</p></li>
<li><p><a class="reference internal" href="../../api/sofia_redux.visualization.models.high_model.MultiOrder.html#sofia_redux.visualization.models.high_model.MultiOrder" title="sofia_redux.visualization.models.high_model.MultiOrder"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiOrder</span></code></a>:
The multiorder class describes a FITS file that contains
multiple spectra and no images. This is primarily used for EXES data
products.</p></li>
</ul>
</section>
<section id="mid-models">
<span id="mid-model"></span><h3>Mid Models<a class="headerlink" href="#mid-models" title="Link to this heading">¶</a></h3>
<p>Mid models describe a singe observation. This means all the data contained in
a mid model are related to each other and describe different aspects a single
piece of data. There are two <code class="xref py py-class docutils literal notranslate"><span class="pre">MidModel</span></code> subclasses:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../api/sofia_redux.visualization.models.mid_model.Book.html#sofia_redux.visualization.models.mid_model.Book" title="sofia_redux.visualization.models.mid_model.Book"><code class="xref py py-class docutils literal notranslate"><span class="pre">Book</span></code></a>: For two
dimensional datasets (ie images).</p></li>
<li><p><a class="reference internal" href="../../api/sofia_redux.visualization.models.mid_model.Order.html#sofia_redux.visualization.models.mid_model.Order" title="sofia_redux.visualization.models.mid_model.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a>: For one
dimensional datasets (ie spectra)</p></li>
</ul>
</section>
<section id="low-models">
<span id="low-model"></span><h3>Low Models<a class="headerlink" href="#low-models" title="Link to this heading">¶</a></h3>
<p>Low models describe a single measurement, or quantity. Here is where the
actual data resides, as well as everything needed to describe the data. This
includes the kind of data it is (e.g. flux or time), the data’s units, and
the data’s name (e.g. “flux” or “exposure”). There are two
<code class="xref py py-class docutils literal notranslate"><span class="pre">LowModel</span></code> subclasses:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../api/sofia_redux.visualization.models.low_model.Image.html#sofia_redux.visualization.models.low_model.Image" title="sofia_redux.visualization.models.low_model.Image"><code class="xref py py-class docutils literal notranslate"><span class="pre">Image</span></code></a>: For
a two dimensional data array.</p></li>
<li><p><a class="reference internal" href="../../api/sofia_redux.visualization.models.low_model.Spectrum.html#sofia_redux.visualization.models.low_model.Spectrum" title="sofia_redux.visualization.models.low_model.Spectrum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Spectrum</span></code></a>:
For a one dimensional data array</p></li>
</ul>
</section>
</section>
<section id="interaction-between-levels">
<h2>Interaction Between Levels<a class="headerlink" href="#interaction-between-levels" title="Link to this heading">¶</a></h2>
<p>Interactions between the model levels is tightly controlled and abstracted as
much as possible. The goal is to have a model system that is as flexible as
possible, so adding new datasets to the Eye’s capabilities is as painless as
possible. As such each layer knows nothing about the layer above it and very
little about the contents of the layer below it. They are largely
self-contained. Additionally the interactions are kept generic, so the same
function calls work regardless of the nature of the data.</p>
<p>The best example of this philosophy in action is the retrieve method. For
example, to plot a spectrum data on an axis, the <code class="docutils literal notranslate"><span class="pre">Pane</span></code> object needs to get
the raw data describing the flux and the wavelengths for a specific order of
a specific grism object. Rather than accessing the data directly through
a series of complicated chained indexing, each model layer implements a
“retrieve” method. Using this, the <code class="docutils literal notranslate"><span class="pre">Pane</span></code> object requests the raw data
(level = “raw”) of the field (“spectral_flux”) from an order (“0”) of the
<code class="docutils literal notranslate"><span class="pre">Grism</span></code>. The <code class="docutils literal notranslate"><span class="pre">Grism</span></code> find the correct <code class="docutils literal notranslate"><span class="pre">Order</span></code> and asks for the raw
spectral_flux data. The <code class="docutils literal notranslate"><span class="pre">Order</span></code> finds the <code class="docutils literal notranslate"><span class="pre">Spectrum</span></code> with the the
“spectral_flux” name and asks for its raw data. The <code class="docutils literal notranslate"><span class="pre">Spectrum</span></code> returns
the numpy array containing the raw data back up the chain until the <code class="docutils literal notranslate"><span class="pre">Pane</span></code>
gets. The same process happens for the “wavepos” data and now <code class="docutils literal notranslate"><span class="pre">Pane</span></code> can
plot a spectrum.  This seemingly convoluted process exists so the inner
relations between the model layers are free to change at any point in the
future and only the “retrieve” method will need to be updated. The <code class="docutils literal notranslate"><span class="pre">Pane</span></code>
class has no need to know how the models are structured, only how to ask the
<code class="docutils literal notranslate"><span class="pre">Grism</span></code> for data. This process also allows for proper error checking to
ensure only valid data is returned and invalid requests do not crash the Eye.</p>
</section>
<section id="reading-in-data">
<span id="reading-data"></span><h2>Reading in Data<a class="headerlink" href="#reading-in-data" title="Link to this heading">¶</a></h2>
<section id="loading-high-model">
<h3>Loading High Model<a class="headerlink" href="#loading-high-model" title="Link to this heading">¶</a></h3>
<p>Initializing a HighModel and populating it with data is initialized by the
interface contained in the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code> class.
The interface has only one method <code class="xref py py-mod docutils literal notranslate"><span class="pre">add_model</span></code>, which accepts either a
filename or a FITS header data unit list (HDUL). If a filename is given, the
file is opened to obtain an HDUL. Based on the instrument name contained the
in “INSTRUME” keyword of the header, the correct <code class="xref py py-class docutils literal notranslate"><span class="pre">HighModel</span></code>
subclass is
instantiated with the full HDUL following the logic in
<a class="reference internal" href="#high-model-selection"><span class="std std-ref">Selection Rules for HighModel Subclasses</span></a>.</p>
<table class="docutils align-default" id="high-model-selection">
<caption><span class="caption-number">Table 37 </span><span class="caption-text">Selection Rules for <code class="xref py py-obj docutils literal notranslate"><span class="pre">HighModel</span></code> Subclasses</span><a class="headerlink" href="#high-model-selection" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Instrument</p></th>
<th class="head"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">HighModel</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>FORCAST</p></td>
<td><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Grism</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>EXES</p></td>
<td><p><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiOrder</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="loading-mid-model">
<h3>Loading Mid Model<a class="headerlink" href="#loading-mid-model" title="Link to this heading">¶</a></h3>
<p>The HDUL is passed to the <code class="xref py py-obj docutils literal notranslate"><span class="pre">load_data</span></code> method of the appropriate
<code class="xref py py-class docutils literal notranslate"><span class="pre">HighModel</span></code>.
The next step is simple for a <code class="xref py py-class docutils literal notranslate"><span class="pre">MultiOrder</span></code> object. A number of
<a class="reference internal" href="../../api/sofia_redux.visualization.models.mid_model.Order.html#sofia_redux.visualization.models.mid_model.Order" title="sofia_redux.visualization.models.mid_model.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a> objects are
created equal to the number of orders in the
HDUL header keyword “NORDERS”. A <code class="xref py py-class docutils literal notranslate"><span class="pre">Grism</span></code> object must first determine
the correct mixture of
<a class="reference internal" href="../../api/sofia_redux.visualization.models.mid_model.Order.html#sofia_redux.visualization.models.mid_model.Order" title="sofia_redux.visualization.models.mid_model.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Book</span></code></a> and
<code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code> objects that are
required to accurate encapsulate the data (there can be either one or zero of
each kind, in any combination). Currently this is decided by examining the
file description contained in the file name, as summarized in
<a class="reference internal" href="#grism-loading"><span class="std std-ref">Selection Rules for Grism Contents</span></a>. This is not reliable, however, and will be improved in
future releases.</p>
<table class="docutils align-default" id="grism-loading">
<caption><span class="caption-number">Table 38 </span><span class="caption-text">Selection Rules for <code class="xref py py-obj docutils literal notranslate"><span class="pre">Grism</span></code> Contents</span><a class="headerlink" href="#grism-loading" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Grism Structure</p></th>
<th class="head"><p>File Codes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Contains no spectra</p></td>
<td><p>APS, BGS, CLN, DRP,
LNZ, LOC, STK, TRC</p></td>
</tr>
<tr class="row-odd"><td><p>Contains no images</p></td>
<td><p>CAL, CMB, IRS,
MRG, RSP, SPC</p></td>
</tr>
<tr class="row-even"><td><p>Contains both</p></td>
<td><p>COA,</p></td>
</tr>
</tbody>
</table>
<p>An order is loaded in by passing the HDUL, the filename, and the order’s
number to <code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code>. Different data products lay out the spectral
data across the HDUL in two different formats: split and combined. For an
order to be valid, for each pixel in the spectrum it must contain the
corresponding wavelength, the measured flux, and the associated flux error.
An order can have the instruments response and the atmospheric
transmission for each pixel as well. A split order will have each parameter
in a separate extension of the HDUL, while a combined order will have all
data in a single extension. The split format is the standard for calibrated
FORCAST products, but EXES and earlier FORCAST products will use the combined.
The <code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code> initialization determines what format to use based on the
dimensions of the HDUl. If the HDUL contains only one extension, then it must
be a combined order. Otherwise, it is assumed to be a split order. Since this
is based on the total size of the HDUl and not just the spectral parts, it
will assume that all grism data sets with an associated image use the split
format.</p>
<p>Loading a combined order requires assumptions about how the dataset has been
written. All parameters are combined into a single two dimensional numpy
array where each row corresponds to a measured parameter and each column
corresponds to a pixel in the spectrum. However what parameter is in each row
is not contained anywhere in the HDUL, so it must be assumed using the
pattern in <a class="reference internal" href="#combined-order"><span class="std std-ref">Layout of Combined Order</span></a>.</p>
<table class="docutils align-default" id="combined-order">
<caption><span class="caption-number">Table 39 </span><span class="caption-text">Layout of Combined Order</span><a class="headerlink" href="#combined-order" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Row</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Label</p></th>
<th class="head"><p>Unit Keyword</p></th>
<th class="head"><p>Kind</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Wavelength</p></td>
<td><p>wavepos</p></td>
<td><p>XUNITS</p></td>
<td><p>wavelength</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Flux</p></td>
<td><p>spectral_flux</p></td>
<td><p>YUNITS</p></td>
<td><p>flux</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Flux Error</p></td>
<td><p>spectral_error</p></td>
<td><p>YUNITS</p></td>
<td><p>flux</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>Total Transmission</p></td>
<td><p>transmission</p></td>
<td><p>None</p></td>
<td><p>scale</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>Instrument Response</p></td>
<td><p>response</p></td>
<td><p>None</p></td>
<td><p>scale</p></td>
</tr>
</tbody>
</table>
<p>Each row in the HDUL’s data is split off and passed to the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Spectrum</span></code>
initializer with the name of the “Label” column and
the kind of the “Kind” column. The name used is the same as the extension
name for the same parameter in split orders, and the kind is used to define
what unit conversions are possible for the data. Not all combined orders have
all the parameters listed, so the loading process iterates through the rows
available, assuming they all follow this same structure.</p>
<p>Loading a split order is easier as fewer assumptions are made. Each parameter
has been assigned its own extension in the HDUL, so to load the order merely
requires passing each extension to the <code class="xref py py-class docutils literal notranslate"><span class="pre">Spectrum</span></code> initializer. The
name is the same as the extension’s name so no assumptions are made.
There are no assumptions as to the order of the each parameter, either in
relation to each other or in the HDUL as a whole, as the entire HDUL is
parsed. This means any extensions that actually represent images are also
checked here. To prevent attempts to parse an image into a spectrum, the
shape of the extension’s data array is checked. Only arrays with one
dimension are parsed into a <code class="xref py py-class docutils literal notranslate"><span class="pre">Spectrum</span></code> object while arrays with two
dimensions are passed.</p>
<p>The image version of an <code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code> is the
<a class="reference internal" href="../../api/sofia_redux.visualization.models.mid_model.Book.html#sofia_redux.visualization.models.mid_model.Book" title="sofia_redux.visualization.models.mid_model.Book"><code class="xref py py-class docutils literal notranslate"><span class="pre">Book</span></code></a> class. It
follows much of
the same structure as the <code class="xref py py-class docutils literal notranslate"><span class="pre">Order`</span></code> class in that it instantiate a
series of
<a class="reference internal" href="../../api/sofia_redux.visualization.models.low_model.Image.html#sofia_redux.visualization.models.low_model.Image" title="sofia_redux.visualization.models.low_model.Image"><code class="xref py py-class docutils literal notranslate"><span class="pre">Image</span></code></a>
objects for each parameter contained in the FITS file.
The data for each parameter is a two dimensional numpy array.  The parameters
might be split across several extensions in the HDUL or they might be
combined into a single extension whose data is a three dimensional array. In
the case of a combined HDUL the data is split off into the corresponding
parameters and passed into an individual <code class="xref py py-class docutils literal notranslate"><span class="pre">Image</span></code> object. This requires
assumptions about the structure of the data cube which have not been
implemented yet as image viewing is not a feature of the Eye.</p>
</section>
<section id="loading-low-model">
<h3>Loading Low Model<a class="headerlink" href="#loading-low-model" title="Link to this heading">¶</a></h3>
<p>The low models available are
<a class="reference internal" href="../../api/sofia_redux.visualization.models.low_model.Image.html#sofia_redux.visualization.models.low_model.Image" title="sofia_redux.visualization.models.low_model.Image"><code class="xref py py-class docutils literal notranslate"><span class="pre">Image</span></code></a> and
<a class="reference internal" href="../../api/sofia_redux.visualization.models.low_model.Spectrum.html#sofia_redux.visualization.models.low_model.Spectrum" title="sofia_redux.visualization.models.low_model.Spectrum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Image</span></code></a>.
A particular <code class="xref py py-class docutils literal notranslate"><span class="pre">LowModel`</span></code> instance is unique defined by the HUDL’s
filename and
a “name” (either pulled from the extension or given by the parent
<code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code>). An additional important parameter is “kind”, which
describes what type of data the model will hold. If the “kind” is not
passed in when the <code class="xref py py-class docutils literal notranslate"><span class="pre">LowModel</span></code> is initialized then it is determined from
the “name”, following the pattern in <a class="reference internal" href="#kind-types"><span class="std std-ref">Available Kinds of Low Models</span></a>.</p>
<table class="docutils align-default" id="kind-types">
<caption><span class="caption-number">Table 40 </span><span class="caption-text">Available Kinds of Low Models</span><a class="headerlink" href="#kind-types" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Low Model</p></th>
<th class="head"><p>Kind</p></th>
<th class="head"><p>Matching Names</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="9"><p>Image</p></td>
<td><p>scale</p></td>
<td><p>transmission</p></td>
</tr>
<tr class="row-odd"><td><p>position</p></td>
<td><p>aperture_trace</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>unitless</p></td>
<td><p>badmask</p></td>
</tr>
<tr class="row-odd"><td><p>spatial_map</p></td>
</tr>
<tr class="row-even"><td rowspan="4"><p>flux</p></td>
<td><p>flux</p></td>
</tr>
<tr class="row-odd"><td><p>error</p></td>
</tr>
<tr class="row-even"><td><p>spectral_flux</p></td>
</tr>
<tr class="row-odd"><td><p>spectral_error</p></td>
</tr>
<tr class="row-even"><td><p>time</p></td>
<td><p>exposure</p></td>
</tr>
<tr class="row-odd"><td rowspan="9"><p>Spectrum</p></td>
<td rowspan="3"><p>scale</p></td>
<td><p>transmission</p></td>
</tr>
<tr class="row-even"><td><p>response</p></td>
</tr>
<tr class="row-odd"><td><p>response_error</p></td>
</tr>
<tr class="row-even"><td><p>unitless</p></td>
<td><p>spatial_profile</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>flux</p></td>
<td><p>spectral_flux</p></td>
</tr>
<tr class="row-even"><td><p>spectral_error</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>wavelength</p></td>
<td><p>wavepos</p></td>
</tr>
<tr class="row-even"><td><p>slitpos</p></td>
</tr>
<tr class="row-odd"><td><p>position</p></td>
<td><p>slitpos</p></td>
</tr>
</tbody>
</table>
<p>The “kind” is important as it determines what units are valid for each
<code class="xref py py-class docutils literal notranslate"><span class="pre">LowModel</span></code>, as well as determining if a dataset can be added to a plot
with exiting data on it (only matching kinds can be plotted against each other
without utilizing overplots). Aside from the different available “kind”s
and the data shape, the <code class="xref py py-class docutils literal notranslate"><span class="pre">Spectrum</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">Image</span></code> classes are very
similar.</p>
<p>In addition to characterizing the type of data, low models oversee unit
conversions. The actual conversion is done in by making calls to the
<a class="reference internal" href="index.html#module-sofia_redux.visualization.utils.unit_conversion" title="sofia_redux.visualization.utils.unit_conversion"><code class="xref py py-class docutils literal notranslate"><span class="pre">unit_conversion</span></code></a>
module, but the low models configure the calls. The <code class="xref py py-class docutils literal notranslate"><span class="pre">unit_conversion</span></code>
module utilizes the <code class="xref py py-class docutils literal notranslate"><span class="pre">astropy.units</span></code> package to handle the details the
actual conversion.</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Models</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#diagram">Diagram</a></li>
<li><a class="reference internal" href="#model-levels">Model Levels</a><ul>
<li><a class="reference internal" href="#high-models">High Models</a></li>
<li><a class="reference internal" href="#mid-models">Mid Models</a></li>
<li><a class="reference internal" href="#low-models">Low Models</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interaction-between-levels">Interaction Between Levels</a></li>
<li><a class="reference internal" href="#reading-in-data">Reading in Data</a><ul>
<li><a class="reference internal" href="#loading-high-model">Loading High Model</a></li>
<li><a class="reference internal" href="#loading-mid-model">Loading Mid Model</a></li>
<li><a class="reference internal" href="#loading-low-model">Loading Low Model</a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../../_sources/sofia_redux/visualization/models.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2024, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.2.6. &nbsp;
    Last built 05 Feb 2024. <br/>
  </p>
</footer>
  </body>
</html>